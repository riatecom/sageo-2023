<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.475">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Timoth√©e Giraud, Nicolas Lambert, Matthieu Viry, Ronan Ysebaert (UAR RIATE, CNRS, Universit√© Paris Cit√©)">

<title>Articulation de diff√©rents langages (R, JavaScript et Python) pour la g√©ovisualisation avec Quarto</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="python_files/libs/clipboard/clipboard.min.js"></script>
<script src="python_files/libs/quarto-html/quarto.js"></script>
<script src="python_files/libs/quarto-html/popper.min.js"></script>
<script src="python_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="python_files/libs/quarto-html/anchor.min.js"></script>
<link href="python_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="python_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="python_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="python_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="python_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table des mati√®res</h2>
   
  <ul class="collapse">
  <li><a href="#python" id="toc-python" class="nav-link active" data-scroll-target="#python">Python</a>
  <ul class="collapse">
  <li><a href="#le-langage-python" id="toc-le-langage-python" class="nav-link" data-scroll-target="#le-langage-python">Le langage Python</a></li>
  <li><a href="#√©cosyst√®me-pour-le-g√©ospatial" id="toc-√©cosyst√®me-pour-le-g√©ospatial" class="nav-link" data-scroll-target="#√©cosyst√®me-pour-le-g√©ospatial">√âcosyst√®me pour le g√©ospatial</a></li>
  <li><a href="#donn√©es-vectorielles" id="toc-donn√©es-vectorielles" class="nav-link" data-scroll-target="#donn√©es-vectorielles">Donn√©es vectorielles</a></li>
  <li><a href="#le-package-geopandas" id="toc-le-package-geopandas" class="nav-link" data-scroll-target="#le-package-geopandas">Le package <em>GeoPandas</em></a></li>
  <li><a href="#donn√©es-raster" id="toc-donn√©es-raster" class="nav-link" data-scroll-target="#donn√©es-raster">Donn√©es raster</a></li>
  <li><a href="#le-package-rasterio" id="toc-le-package-rasterio" class="nav-link" data-scroll-target="#le-package-rasterio">Le package <em>Rasterio</em></a></li>
  <li><a href="#les-package-xarray-et-rioxarray" id="toc-les-package-xarray-et-rioxarray" class="nav-link" data-scroll-target="#les-package-xarray-et-rioxarray">Les package <em>xarray</em> et <em>rioxarray</em></a></li>
  <li><a href="#analyse-spatiale" id="toc-analyse-spatiale" class="nav-link" data-scroll-target="#analyse-spatiale">Analyse spatiale</a></li>
  <li><a href="#autres-packages-utiles" id="toc-autres-packages-utiles" class="nav-link" data-scroll-target="#autres-packages-utiles">Autres packages utiles ‚Ä¶</a></li>
  <li><a href="#ressources-python-g√©ospatial" id="toc-ressources-python-g√©ospatial" class="nav-link" data-scroll-target="#ressources-python-g√©ospatial">Ressources Python G√©ospatial</a></li>
  <li><a href="#interaction-r-python-dans-quarto" id="toc-interaction-r-python-dans-quarto" class="nav-link" data-scroll-target="#interaction-r-python-dans-quarto">Interaction R ‚áÑ Python dans Quarto</a></li>
  <li><a href="#interaction-r-python-dans-quarto-suite" id="toc-interaction-r-python-dans-quarto-suite" class="nav-link" data-scroll-target="#interaction-r-python-dans-quarto-suite">Interaction R ‚áÑ Python dans Quarto (suite)</a></li>
  <li><a href="#interaction-r-python-dans-quarto-suite-1" id="toc-interaction-r-python-dans-quarto-suite-1" class="nav-link" data-scroll-target="#interaction-r-python-dans-quarto-suite-1">Interaction R ‚áÑ Python dans Quarto (suite)</a></li>
  <li><a href="#python-quarto-et-interactivit√©" id="toc-python-quarto-et-interactivit√©" class="nav-link" data-scroll-target="#python-quarto-et-interactivit√©">Python, Quarto et interactivit√©</a></li>
  <li><a href="#exemples-danalyse-sur-les-donn√©es-du-qu√©bec" id="toc-exemples-danalyse-sur-les-donn√©es-du-qu√©bec" class="nav-link" data-scroll-target="#exemples-danalyse-sur-les-donn√©es-du-qu√©bec">Exemples d‚Äôanalyse sur les donn√©es du Qu√©bec</a></li>
  <li><a href="#a-vous-de-jouer" id="toc-a-vous-de-jouer" class="nav-link" data-scroll-target="#a-vous-de-jouer">A vous de jouer üöÄ</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Articulation de diff√©rents langages (R, JavaScript et Python) pour la g√©ovisualisation avec Quarto</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
<p class="subtitle lead">Atelier Sageo, Qu√©bec, Juin 2023</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Auteur¬∑rice</div>
    <div class="quarto-title-meta-contents">
             <p>Timoth√©e Giraud, Nicolas Lambert, Matthieu Viry, Ronan Ysebaert (UAR RIATE, CNRS, Universit√© Paris Cit√©) </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<div class="cell">

</div>
<div class="cell">

</div>
<section id="python" class="level1">
<h1>Python</h1>
<section id="le-langage-python" class="level2">
<h2 class="anchored" data-anchor-id="le-langage-python">Le langage Python</h2>
<div class="columns">
<div class="column" style="width:70%;">
<ul>
<li><p><strong>Python</strong> : un langage <em>polyvalent</em>, <em>interpr√©t√©</em> et <em>multi-paradigme</em></p></li>
<li><p>De plus en plus utilis√© pour la <em>science des donn√©es</em></p></li>
</ul>
<div class="fragment">
<ul>
<li>Un √©cosyst√®me robuste pour diff√©rents domaines d‚Äôapplication scientifiques</li>
</ul>
<p><img src="./fig/python-stack.png" class="img-fluid"></p>
</div>
</div><div class="column" style="width:30%;">
<p><img src="./fig/logo-python.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="√©cosyst√®me-pour-le-g√©ospatial" class="level2">
<h2 class="anchored" data-anchor-id="√©cosyst√®me-pour-le-g√©ospatial">√âcosyst√®me pour le g√©ospatial</h2>
</section>
<section id="donn√©es-vectorielles" class="level2">
<h2 class="anchored" data-anchor-id="donn√©es-vectorielles">Donn√©es vectorielles</h2>
<ul>
<li><a href="https://gdal.org/api/python_bindings.html"><strong>Bindings Python de GDAL/OGR</strong></a> <span class="citation" data-cites="GDAL">(<a href="#ref-GDAL" role="doc-biblioref">GDAL/OGR contributors, 2022</a>)</span></li>
<li><a href="https://fiona.readthedocs.io/en/stable/"><strong>Fiona</strong></a> <span class="citation" data-cites="fiona">(<a href="#ref-fiona" role="doc-biblioref">Gillies, Buffat, et al., 2023</a>)</span> - I/O (<em>wrapper</em> de haut niveau autour d‚ÄôOGR)</li>
<li><a href="https://shapely.readthedocs.io/"><strong>Shapely</strong></a> <span class="citation" data-cites="sgillies_2023">(<a href="#ref-sgillies_2023" role="doc-biblioref">Gillies, Wel, et al., 2023</a>)</span> - bindings Python de <a href="https://github.com/libgeos/geos">GEOS</a> <span class="citation" data-cites="GEOS">(<a href="#ref-GEOS" role="doc-biblioref">GEOS contributors, 2021</a>)</span></li>
<li><a href="https://pyproj4.github.io/pyproj"><strong>Pyproj</strong></a> <span class="citation" data-cites="pyproj">(<a href="#ref-pyproj" role="doc-biblioref">Snow, Whitaker, et al., 2023</a>)</span> - bindings Python de <a href="https://proj.org/">PROJ</a> <span class="citation" data-cites="PROJ">(<a href="#ref-PROJ" role="doc-biblioref">PROJ contributors, 2021</a>)</span></li>
<li><a href="https://geopandas.org/"><strong>Geopandas</strong></a> <span class="citation" data-cites="kelsey_jordahl_2020_3946761">(<a href="#ref-kelsey_jordahl_2020_3946761" role="doc-biblioref">Jordahl et al., 2020</a>)</span> - √âtend les <code>DataFrame</code>s de <a href="https://pandas.pydata.org/">pandas</a> <span class="citation" data-cites="pandas">(<a href="#ref-pandas" role="doc-biblioref">The pandas development team, s. d.</a>)</span></li>
</ul>
<p><img src="./fig/logo-pandas.svg" class="img-fluid"></p>
<p><img src="./fig/logo_geopandas.svg" class="img-fluid"></p>
</section>
<section id="le-package-geopandas" class="level2">
<h2 class="anchored" data-anchor-id="le-package-geopandas">Le package <em>GeoPandas</em></h2>
<p>Un projet open source pour faciliter le travail avec des donn√©es g√©ospatiales vectorielles en Python. GeoPandas √©tend Pandas pour permettre de disposer d‚Äôun type de colonne g√©om√©trique et pour permettre d‚Äôeffectuer des op√©rations spatiales. Les op√©rations g√©om√©triques sont r√©alis√©es avec <code>shapely</code>, les acc√®s en lecture / √©criture aux fichiers utilisent <code>fiona</code> et la visualisation utilise <code>matplotlib</code>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./fig/geopandas-table.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Format des GeoDataFrame</figcaption><p></p>
</figure>
</div>
<ul>
<li>Utilisation :</li>
</ul>
<div class="panel-tabset custom-tab">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" href="">Import et lecture</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false" href="">Affichage</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false" href="">SCR</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" role="tab" aria-controls="tabset-1-4" aria-selected="false" href="">Affichage avec fond de carte</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-5" role="tab" aria-controls="tabset-1-5" aria-selected="false" href="">Centroide</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-6" role="tab" aria-controls="tabset-1-6" aria-selected="false" href="">Boundary</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-7-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-7" role="tab" aria-controls="tabset-1-7" aria-selected="false" href="">Zone tampon</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-8-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-8" role="tab" aria-controls="tabset-1-8" aria-selected="false" href="">Aggr√©gation</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-9-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-9" role="tab" aria-controls="tabset-1-9" aria-selected="false" href="">Intersection</a></li></ul>
<div class="tab-content custom-tab">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">

</div>
<p>Avec la fonction <code>read_file</code> :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>nybb <span class="op">=</span> gpd.read_file(file_path)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p>Avec la m√©thode <code>plot</code> des <code>GeoDataFrame</code> :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>nybb.plot()</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="python_files/figure-html/gpd-tuto-plot-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<p>Affichage :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(nybb.crs)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>epsg:2263</code></pre>
</div>
</div>
<p>Transformation :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>nybb_geo <span class="op">=</span> nybb.to_crs(<span class="st">'EPSG:4326'</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-4-tab">
<p>En utilisant la biblioth√®que <code>contextily</code> :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> contextily <span class="im">as</span> cx</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> nybb.to_crs(<span class="st">'EPSG:3857'</span>).plot()</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>cx.add_basemap(ax, source<span class="op">=</span><span class="st">'https://</span><span class="sc">{s}</span><span class="st">.tile.openstreetmap.fr/osmfr/</span><span class="sc">{z}</span><span class="st">/</span><span class="sc">{x}</span><span class="st">/</span><span class="sc">{y}</span><span class="st">.png'</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>ax</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="python_files/figure-html/gpd-tuto-contextily-3.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-1-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-5-tab">
<p>Simplement en utilisant l‚Äôattribut <code>centroid</code> des <code>GeoDataFrame</code> :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>nybb.centroid.plot()</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="python_files/figure-html/gpd-tuto-centroid-5.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-1-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-6-tab">
<p>Simplement en utilisant l‚Äôattribut <code>boundary</code> des <code>GeoDataFrame</code> :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>nybb.boundary.plot()</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="python_files/figure-html/gpd-tuto-boundary-7.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-1-7" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-7-tab">
<p>En utilisant la m√©thode <code>buffer</code> des <code>GeoDataFrame</code> :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>buff_nybb <span class="op">=</span> nybb.<span class="bu">buffer</span>(<span class="dv">3000</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> buff_nybb.plot(color<span class="op">=</span><span class="st">"red"</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>nybb.plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">"aliceblue"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="python_files/figure-html/gpd-tuto-buffer-2-9.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-1-8" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-8-tab">
<p>En utilisant la m√©thode <code>dissolve</code> des <code>GeoDataFrame</code> :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On peut utiliser dissolve(by="nom_colonne") si on veut aggr√©ger selon les valeurs d'une colonne</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>agg <span class="op">=</span> nybb.dissolve()</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>agg.plot()</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="python_files/figure-html/gpd-tuto-agg-11.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-1-9" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-9-tab">
<p>En utilisant la m√©thode <code>intersection</code> des <code>GeoDataFrame</code> :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely <span class="im">import</span> wkt</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>point <span class="op">=</span> wkt.loads(<span class="st">'Point(998769.1146889535 174169.7607268664)'</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>intersecting <span class="op">=</span> nybb.intersection(point.<span class="bu">buffer</span>(<span class="dv">35000</span>))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>/home/mthh/env-quarto/lib/python3.10/site-packages/shapely/set_operations.py:133: RuntimeWarning: invalid value encountered in intersection
  return lib.intersection(a, b, **kwargs)</code></pre>
</div>
</div>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> nybb.plot()</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> intersecting.plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">"red"</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>ax</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="python_files/figure-html/gpd-tuto-intersectiob-2-13.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="donn√©es-raster" class="level2">
<h2 class="anchored" data-anchor-id="donn√©es-raster">Donn√©es raster</h2>
<ul>
<li><a href="https://rasterio.readthedocs.io/"><strong>Rasterio</strong></a> <span class="citation" data-cites="gillies_2019">(<a href="#ref-gillies_2019" role="doc-biblioref">Gillies et al., 2013</a>)</span> :
<ul>
<li>lecture / √©criture de raster (<em>wrapper</em> de haut niveau autour de GDAL)</li>
<li>donn√©es repr√©sent√©es sous forme d‚Äô<code>array</code> NumPy</li>
<li>reprojection</li>
<li><em>resampling</em></li>
<li><em>virtual files</em></li>
<li>etc.</li>
</ul></li>
<li><a href="https://pythonhosted.org/rasterstats/"><strong>Rasterstats</strong></a> :
<ul>
<li>r√©sumer des donn√©es raster sur la base de g√©om√©tries vectorielles</li>
<li>extraction de valeurs √† un point pr√©cis</li>
</ul></li>
<li><a href="https://docs.xarray.dev/en/stable/"><strong>xarray</strong></a> <span class="citation" data-cites="xarray">(<a href="#ref-xarray" role="doc-biblioref">Hoyer et al., s. d.</a>)</span> et <a href="https://corteva.github.io/rioxarray/"><strong>rioxarray</strong></a> <span class="citation" data-cites="rioxarray">(<a href="#ref-rioxarray" role="doc-biblioref">Snow, Brochart, et al., 2023</a>)</span>:
<ul>
<li><em>xarray</em> pour travailler avec des tableaux multidimensionnels √©tiquet√©s</li>
<li><em>rioxarray</em> pour ouvrir des jeux des donn√©es raster avec <em>rasterio</em>, les stocker dans le format de <em>xarray</em>, et avoir acc√®s √† diff√©rentes fonctionnalit√©s de <em>rasterio</em></li>
<li>moins ‚Äúrustique‚Äù que d‚Äôutiliser rasterio seul / d√©pend de l‚Äôusage souhait√©</li>
</ul></li>
</ul>
</section>
<section id="le-package-rasterio" class="level2">
<h2 class="anchored" data-anchor-id="le-package-rasterio">Le package <em>Rasterio</em></h2>
<p>Exemple d‚Äôutilisation :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterio <span class="im">as</span> rio</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rio.<span class="bu">open</span>(<span class="st">'data/MODIS_ARRAY.nc'</span>) <span class="im">as</span> f:</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># M√©tadonn√©es :</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    metadata <span class="op">=</span> f.meta</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Lire toutes les bandes :</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> f.read()</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ou f.read(1) pour lire seulement la premi√®re bande</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Un dictionnaire de m√©ta-donn√©es + un tableau NumPy contenant la (ou les) bande(s) :</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(metadata)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{'driver': 'netCDF', 'dtype': 'int16', 'nodata': -28672.0, 'width': 200, 'height': 200, 'count': 1, 'crs': CRS.from_wkt('PROJCS["unknown",GEOGCS["unknown",DATUM["unknown",SPHEROID["unknown",6371007.181,0]],PRIMEM["Greenwich",0,AUTHORITY["EPSG","8901"]],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]]],PROJECTION["Sinusoidal"],PARAMETER["longitude_of_center",0],PARAMETER["false_easting",0],PARAMETER["false_northing",0],UNIT["metre",1,AUTHORITY["EPSG","9001"]],AXIS["Easting",EAST],AXIS["Northing",NORTH]]'), 'transform': Affine(231.6563582639561, 0.0, -7274009.649486291,
       0.0, -231.65635826375018, 5050108.61015275)}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(data)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[[-28672 -28672 -28672 ...    656    656    554]
  [-28672 -28672 -28672 ...    694    694    642]
  [-28672 -28672 -28672 ...    456    575    642]
  ...
  [   993    817    817 ...    471    479    498]
  [   893    893    816 ...    479    479    469]
  [   816    816    832 ...    515    469    485]]]</code></pre>
</div>
</div>
</section>
<section id="les-package-xarray-et-rioxarray" class="level2">
<h2 class="anchored" data-anchor-id="les-package-xarray-et-rioxarray">Les package <em>xarray</em> et <em>rioxarray</em></h2>
<p>Exemple d‚Äôutilisation :</p>
<div class="panel-tabset custom-tab">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true" href="">Import et lecture</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false" href="">Compl√©tion des valeurs manquantes</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false" href="">Affichage</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-4" role="tab" aria-controls="tabset-2-4" aria-selected="false" href="">SCR</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-5" role="tab" aria-controls="tabset-2-5" aria-selected="false" href="">D√©coupage</a></li></ul>
<div class="tab-content custom-tab">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rioxarray</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xarray</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>xds <span class="op">=</span> xarray.open_dataarray(<span class="st">"./data/MODIS_ARRAY.nc"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Un objet de type <code>xarray.DataArray</code> ou <code>xarray.Dataset</code> qui contient les diff√©rentes m√©ta-donn√©es et les donn√©es :</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>xds</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewbox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewbox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '‚ñ∫';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '‚ñº';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class="xr-text-repr-fallback">&lt;xarray.DataArray (y: 200, x: 200)&gt;
[40000 values with dtype=float32]
Coordinates:
  * y        (y) float64 5.05e+06 5.05e+06 5.05e+06 ... 5.004e+06 5.004e+06
  * x        (x) float64 -7.274e+06 -7.274e+06 ... -7.228e+06 -7.228e+06
Attributes:
    crs:        +a=6371007.181 +b=6371007.181 +lon_0=0 +no_defs +proj=sinu +u...
    res:        [231.65635826 231.65635826]
    is_tiled:   0
    nodata:     -28672.0
    transform:  [ 2.31656358e+02  0.00000000e+00 -7.27400965e+06  0.00000000e...</pre><div class="xr-wrap" style="display:none"><div class="xr-header"><div class="xr-obj-type">xarray.DataArray</div><div class="xr-array-name"></div><ul class="xr-dim-list"><li><span class="xr-has-index">y</span>: 200</li><li><span class="xr-has-index">x</span>: 200</li></ul></div><ul class="xr-sections"><li class="xr-section-item"><div class="xr-array-wrap"><input id="section-467962bc-45fc-41bd-981c-0c87090dfad8" class="xr-array-in" type="checkbox" checked=""><label for="section-467962bc-45fc-41bd-981c-0c87090dfad8" title="Show/hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-array-preview xr-preview"><span>...</span></div><div class="xr-array-data"><pre>[40000 values with dtype=float32]</pre></div></div></li><li class="xr-section-item"><input id="section-5987ae9c-3284-45c4-ad78-38d4a69e399a" class="xr-section-summary-in" type="checkbox" checked=""><label for="section-5987ae9c-3284-45c4-ad78-38d4a69e399a" class="xr-section-summary">Coordinates: <span>(2)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><ul class="xr-var-list"><li class="xr-var-item"><div class="xr-var-name"><span class="xr-has-index">y</span></div><div class="xr-var-dims">(y)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">5.05e+06 5.05e+06 ... 5.004e+06</div><input id="attrs-93f50fd5-5d52-44d7-9f47-b410d356edf6" class="xr-var-attrs-in" type="checkbox"><label for="attrs-93f50fd5-5d52-44d7-9f47-b410d356edf6" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-b1bfdd42-c3b1-4c61-831e-68a320aec23d" class="xr-var-data-in" type="checkbox"><label for="data-b1bfdd42-c3b1-4c61-831e-68a320aec23d" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>axis :</span></dt><dd>Y</dd><dt><span>long_name :</span></dt><dd>y coordinate of projection</dd><dt><span>standard_name :</span></dt><dd>projection_y_coordinate</dd><dt><span>units :</span></dt><dd>metre</dd></dl></div><div class="xr-var-data"><pre>array([5049992.781974, 5049761.125615, 5049529.469257, 5049297.812899,
       5049066.156541, 5048834.500182, 5048602.843824, 5048371.187466,
       5048139.531108, 5047907.874749, 5047676.218391, 5047444.562033,
       5047212.905674, 5046981.249316, 5046749.592958, 5046517.9366  ,
       5046286.280241, 5046054.623883, 5045822.967525, 5045591.311167,
       5045359.654808, 5045127.99845 , 5044896.342092, 5044664.685734,
       5044433.029375, 5044201.373017, 5043969.716659, 5043738.0603  ,
       5043506.403942, 5043274.747584, 5043043.091226, 5042811.434867,
       5042579.778509, 5042348.122151, 5042116.465793, 5041884.809434,
       5041653.153076, 5041421.496718, 5041189.84036 , 5040958.184001,
       5040726.527643, 5040494.871285, 5040263.214927, 5040031.558568,
       5039799.90221 , 5039568.245852, 5039336.589493, 5039104.933135,
       5038873.276777, 5038641.620419, 5038409.96406 , 5038178.307702,
       5037946.651344, 5037714.994986, 5037483.338627, 5037251.682269,
       5037020.025911, 5036788.369553, 5036556.713194, 5036325.056836,
       5036093.400478, 5035861.74412 , 5035630.087761, 5035398.431403,
       5035166.775045, 5034935.118686, 5034703.462328, 5034471.80597 ,
       5034240.149612, 5034008.493253, 5033776.836895, 5033545.180537,
       5033313.524179, 5033081.86782 , 5032850.211462, 5032618.555104,
       5032386.898746, 5032155.242387, 5031923.586029, 5031691.929671,
       5031460.273313, 5031228.616954, 5030996.960596, 5030765.304238,
       5030533.647879, 5030301.991521, 5030070.335163, 5029838.678805,
       5029607.022446, 5029375.366088, 5029143.70973 , 5028912.053372,
       5028680.397013, 5028448.740655, 5028217.084297, 5027985.427939,
       5027753.77158 , 5027522.115222, 5027290.458864, 5027058.802506,
       5026827.146147, 5026595.489789, 5026363.833431, 5026132.177072,
       5025900.520714, 5025668.864356, 5025437.207998, 5025205.551639,
       5024973.895281, 5024742.238923, 5024510.582565, 5024278.926206,
       5024047.269848, 5023815.61349 , 5023583.957132, 5023352.300773,
       5023120.644415, 5022888.988057, 5022657.331698, 5022425.67534 ,
       5022194.018982, 5021962.362624, 5021730.706265, 5021499.049907,
       5021267.393549, 5021035.737191, 5020804.080832, 5020572.424474,
       5020340.768116, 5020109.111758, 5019877.455399, 5019645.799041,
       5019414.142683, 5019182.486325, 5018950.829966, 5018719.173608,
       5018487.51725 , 5018255.860891, 5018024.204533, 5017792.548175,
       5017560.891817, 5017329.235458, 5017097.5791  , 5016865.922742,
       5016634.266384, 5016402.610025, 5016170.953667, 5015939.297309,
       5015707.640951, 5015475.984592, 5015244.328234, 5015012.671876,
       5014781.015518, 5014549.359159, 5014317.702801, 5014086.046443,
       5013854.390084, 5013622.733726, 5013391.077368, 5013159.42101 ,
       5012927.764651, 5012696.108293, 5012464.451935, 5012232.795577,
       5012001.139218, 5011769.48286 , 5011537.826502, 5011306.170144,
       5011074.513785, 5010842.857427, 5010611.201069, 5010379.544711,
       5010147.888352, 5009916.231994, 5009684.575636, 5009452.919277,
       5009221.262919, 5008989.606561, 5008757.950203, 5008526.293844,
       5008294.637486, 5008062.981128, 5007831.32477 , 5007599.668411,
       5007368.012053, 5007136.355695, 5006904.699337, 5006673.042978,
       5006441.38662 , 5006209.730262, 5005978.073904, 5005746.417545,
       5005514.761187, 5005283.104829, 5005051.44847 , 5004819.792112,
       5004588.135754, 5004356.479396, 5004124.823037, 5003893.166679])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span class="xr-has-index">x</span></div><div class="xr-var-dims">(x)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">-7.274e+06 ... -7.228e+06</div><input id="attrs-e07702ab-def9-492a-bcb0-c1fc0c87f857" class="xr-var-attrs-in" type="checkbox"><label for="attrs-e07702ab-def9-492a-bcb0-c1fc0c87f857" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-f5aa530d-107d-4601-8cd6-de754f465018" class="xr-var-data-in" type="checkbox"><label for="data-f5aa530d-107d-4601-8cd6-de754f465018" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>axis :</span></dt><dd>X</dd><dt><span>long_name :</span></dt><dd>x coordinate of projection</dd><dt><span>standard_name :</span></dt><dd>projection_x_coordinate</dd><dt><span>units :</span></dt><dd>metre</dd></dl></div><div class="xr-var-data"><pre>array([-7273893.821307, -7273662.164949, -7273430.508591, -7273198.852232,
       -7272967.195874, -7272735.539516, -7272503.883158, -7272272.226799,
       -7272040.570441, -7271808.914083, -7271577.257725, -7271345.601366,
       -7271113.945008, -7270882.28865 , -7270650.632291, -7270418.975933,
       -7270187.319575, -7269955.663217, -7269724.006858, -7269492.3505  ,
       -7269260.694142, -7269029.037784, -7268797.381425, -7268565.725067,
       -7268334.068709, -7268102.412351, -7267870.755992, -7267639.099634,
       -7267407.443276, -7267175.786918, -7266944.130559, -7266712.474201,
       -7266480.817843, -7266249.161484, -7266017.505126, -7265785.848768,
       -7265554.19241 , -7265322.536051, -7265090.879693, -7264859.223335,
       -7264627.566977, -7264395.910618, -7264164.25426 , -7263932.597902,
       -7263700.941544, -7263469.285185, -7263237.628827, -7263005.972469,
       -7262774.31611 , -7262542.659752, -7262311.003394, -7262079.347036,
       -7261847.690677, -7261616.034319, -7261384.377961, -7261152.721603,
       -7260921.065244, -7260689.408886, -7260457.752528, -7260226.09617 ,
       -7259994.439811, -7259762.783453, -7259531.127095, -7259299.470737,
       -7259067.814378, -7258836.15802 , -7258604.501662, -7258372.845303,
       -7258141.188945, -7257909.532587, -7257677.876229, -7257446.21987 ,
       -7257214.563512, -7256982.907154, -7256751.250796, -7256519.594437,
       -7256287.938079, -7256056.281721, -7255824.625363, -7255592.969004,
       -7255361.312646, -7255129.656288, -7254897.99993 , -7254666.343571,
       -7254434.687213, -7254203.030855, -7253971.374496, -7253739.718138,
       -7253508.06178 , -7253276.405422, -7253044.749063, -7252813.092705,
       -7252581.436347, -7252349.779989, -7252118.12363 , -7251886.467272,
       -7251654.810914, -7251423.154556, -7251191.498197, -7250959.841839,
       -7250728.185481, -7250496.529122, -7250264.872764, -7250033.216406,
       -7249801.560048, -7249569.903689, -7249338.247331, -7249106.590973,
       -7248874.934615, -7248643.278256, -7248411.621898, -7248179.96554 ,
       -7247948.309182, -7247716.652823, -7247484.996465, -7247253.340107,
       -7247021.683749, -7246790.02739 , -7246558.371032, -7246326.714674,
       -7246095.058315, -7245863.401957, -7245631.745599, -7245400.089241,
       -7245168.432882, -7244936.776524, -7244705.120166, -7244473.463808,
       -7244241.807449, -7244010.151091, -7243778.494733, -7243546.838375,
       -7243315.182016, -7243083.525658, -7242851.8693  , -7242620.212942,
       -7242388.556583, -7242156.900225, -7241925.243867, -7241693.587508,
       -7241461.93115 , -7241230.274792, -7240998.618434, -7240766.962075,
       -7240535.305717, -7240303.649359, -7240071.993001, -7239840.336642,
       -7239608.680284, -7239377.023926, -7239145.367568, -7238913.711209,
       -7238682.054851, -7238450.398493, -7238218.742135, -7237987.085776,
       -7237755.429418, -7237523.77306 , -7237292.116701, -7237060.460343,
       -7236828.803985, -7236597.147627, -7236365.491268, -7236133.83491 ,
       -7235902.178552, -7235670.522194, -7235438.865835, -7235207.209477,
       -7234975.553119, -7234743.896761, -7234512.240402, -7234280.584044,
       -7234048.927686, -7233817.271327, -7233585.614969, -7233353.958611,
       -7233122.302253, -7232890.645894, -7232658.989536, -7232427.333178,
       -7232195.67682 , -7231964.020461, -7231732.364103, -7231500.707745,
       -7231269.051387, -7231037.395028, -7230805.73867 , -7230574.082312,
       -7230342.425954, -7230110.769595, -7229879.113237, -7229647.456879,
       -7229415.80052 , -7229184.144162, -7228952.487804, -7228720.831446,
       -7228489.175087, -7228257.518729, -7228025.862371, -7227794.206013])</pre></div></li></ul></div></li><li class="xr-section-item"><input id="section-d09078c6-53a9-4db6-b837-f72c19ddad76" class="xr-section-summary-in" type="checkbox"><label for="section-d09078c6-53a9-4db6-b837-f72c19ddad76" class="xr-section-summary">Indexes: <span>(2)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><ul class="xr-var-list"><li class="xr-var-item"><div class="xr-index-name"><div>y</div></div><div class="xr-index-preview">PandasIndex</div><div></div><input id="index-13e50fc8-abb9-4de3-a4be-d14eadcb084f" class="xr-index-data-in" type="checkbox"><label for="index-13e50fc8-abb9-4de3-a4be-d14eadcb084f" title="Show/Hide index repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-index-data"><pre>PandasIndex(Index([ 5049992.781973618,  5049761.125615354,   5049529.46925709,  5049297.812898827,  5049066.156540562,  5048834.500182299, 5048602.8438240355,  5048371.187465771,  5048139.531107508,  5047907.874749244,
       ...
        5005978.073903505,  5005746.417545241,  5005514.761186978,  5005283.104828713,   5005051.44847045,  5004819.792112187,  5004588.135753923,  5004356.479395659,  5004124.823037395,  5003893.166679132], dtype='float64', name='y', length=200))</pre></div></li><li class="xr-var-item"><div class="xr-index-name"><div>x</div></div><div class="xr-index-preview">PandasIndex</div><div></div><input id="index-8ae36394-8780-425a-9aa1-3c0206242072" class="xr-index-data-in" type="checkbox"><label for="index-8ae36394-8780-425a-9aa1-3c0206242072" title="Show/Hide index repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-index-data"><pre>PandasIndex(Index([ -7273893.821307159,  -7273662.164948896,  -7273430.508590631,  -7273198.852232368,  -7272967.195874103,   -7272735.53951584, -7272503.8831575755,  -7272272.226799311,  -7272040.570441048,  -7271808.914082783,
       ...
       -7229879.1132370075,  -7229647.456878743,   -7229415.80052048,  -7229184.144162215,  -7228952.487803951,  -7228720.831445687,  -7228489.175087423,   -7228257.51872916,  -7228025.862370895,  -7227794.206012632], dtype='float64', name='x', length=200))</pre></div></li></ul></div></li><li class="xr-section-item"><input id="section-68ca6db8-ae7d-426e-8048-405ba79c8e3e" class="xr-section-summary-in" type="checkbox" checked=""><label for="section-68ca6db8-ae7d-426e-8048-405ba79c8e3e" class="xr-section-summary">Attributes: <span>(5)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><dl class="xr-attrs"><dt><span>crs :</span></dt><dd>+a=6371007.181 +b=6371007.181 +lon_0=0 +no_defs +proj=sinu +units=m +x_0=0 +y_0=0</dd><dt><span>res :</span></dt><dd>[231.65635826 231.65635826]</dd><dt><span>is_tiled :</span></dt><dd>0</dd><dt><span>nodata :</span></dt><dd>-28672.0</dd><dt><span>transform :</span></dt><dd>[ 2.31656358e+02  0.00000000e+00 -7.27400965e+06  0.00000000e+00
 -2.31656358e+02  5.05010861e+06  0.00000000e+00  0.00000000e+00
  1.00000000e+00]</dd></dl></div></li></ul></div></div>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>filled <span class="op">=</span> xds.rio.interpolate_na()</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<p>En utilisant la m√©thode <code>plot</code> des objets <code>xarray.DataArray</code> (ici apr√®s avoir s√©lections un <em>subset</em> des donn√©es) :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">5</span>))</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>ax1, ax2 <span class="op">=</span> (fig.add_subplot(<span class="dv">131</span>), fig.add_subplot(<span class="dv">133</span>))</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>xds.isel(x<span class="op">=</span><span class="bu">slice</span>(<span class="dv">0</span>, <span class="dv">20</span>), y<span class="op">=</span><span class="bu">slice</span>(<span class="dv">0</span>, <span class="dv">20</span>)).plot(ax<span class="op">=</span>ax1)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>filled.isel(x<span class="op">=</span><span class="bu">slice</span>(<span class="dv">0</span>, <span class="dv">20</span>), y<span class="op">=</span><span class="bu">slice</span>(<span class="dv">0</span>, <span class="dv">20</span>)).plot(ax<span class="op">=</span>ax2)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="python_files/figure-html/xarray-tuto-plot-15.png" class="img-fluid" width="1440"></p>
</div>
</div>
</div>
<div id="tabset-2-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-4-tab">
<ul>
<li>Affichage :</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>xds.rio.crs</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CRS.from_wkt('PROJCS["unknown",GEOGCS["unknown",DATUM["unknown",SPHEROID["unknown",6371007.181,0]],PRIMEM["Greenwich",0,AUTHORITY["EPSG","8901"]],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]]],PROJECTION["Sinusoidal"],PARAMETER["longitude_of_center",0],PARAMETER["false_easting",0],PARAMETER["false_northing",0],UNIT["metre",1,AUTHORITY["EPSG","9001"]],AXIS["Easting",EAST],AXIS["Northing",NORTH]]')</code></pre>
</div>
</div>
<ul>
<li>Transformation :</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>xds <span class="op">=</span> xds.rio.reproject(<span class="st">"EPSG:6623"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-2-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-5-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>clipped <span class="op">=</span> xds.rio.clip(gdf.geometry.values, gdf.crs, drop<span class="op">=</span><span class="va">False</span>, invert<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="analyse-spatiale" class="level2">
<h2 class="anchored" data-anchor-id="analyse-spatiale">Analyse spatiale</h2>
<div class="columns">
<div class="column" style="width:80%;">
<p>√âcosyst√®me de biblioth√®ques pour l‚Äôanalyse spatiale <a href="https://pysal.org/">PySAL</a> (Python Spatial Analysis Library, <span class="citation" data-cites="pysal2007">Rey et Anselin (<a href="#ref-pysal2007" role="doc-biblioref">2007</a>)</span>) :</p>
<ul>
<li><strong>Explorer</strong>:
<ul>
<li>Analyse exploratoire des donn√©es spatiales (package <a href="https://pysal.org/esda/">esda</a>)</li>
<li>Analyse de la dynamique des donn√©es spatiales longitudinales (package <a href="https://pysal.org/giddy/">giddy</a>)</li>
<li>Mesure des in√©galit√©s dans l‚Äôespace et dans le temps (package <a href="https://inequality.readthedocs.io/en/latest/">inequality</a>)</li>
<li>Analyse statistique de motifs ponctuels planaires (package <a href="https://pysal.org/pointpats/">pointpats</a>)</li>
<li>Mesure de la s√©gr√©gation dans le temps et dans l‚Äôespace (package <a href="https://pysal.org/segregation/">segregation</a>)</li>
<li>Morphom√©trie urbaine (package <a href="https://docs.momepy.org/en/stable/">momepy</a>)</li>
</ul></li>
<li><strong>Mod√©liser</strong>:
<ul>
<li>R√©gression g√©ographiquement pond√©r√©e √† plusieurs √©chelles (package <a href="https://mgwr.readthedocs.io/en/latest/">mgwr</a>)</li>
<li>Mod√®les lin√©aires g√©n√©ralis√©s √©pars (package <a href="https://spglm.readthedocs.io/en/latest/">spglm</a>)</li>
<li>Mod√®les d‚Äôinteraction spatiale (package <a href="https://spint.readthedocs.io/en/latest/">spint</a>)</li>
<li>Mod√®les de r√©gression spatiale (package <a href="https://spreg.readthedocs.io/en/latest/">spreg</a>)</li>
<li>Mod√®les de composantes de variance √† corr√©lation spatiale √† plusieurs niveaux (package <a href="https://github.com/pysal/spvcm">spvcm</a>)</li>
<li><em>Areal interpolation</em> et cartographie dasym√©trique (package <a href="https://pysal.org/tobler/">tobler</a>)</li>
<li>Accessibilit√© spatiale (package <a href="https://pysal.org/access/">access</a>)</li>
<li>Optimisation spatiale (package <a href="https://pysal.org/spopt/">spopt</a>)</li>
</ul></li>
</ul>
</div><div class="column" style="width:20%;">
<p><img src="./fig/logo-pysal.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="autres-packages-utiles" class="level2">
<h2 class="anchored" data-anchor-id="autres-packages-utiles">Autres packages utiles ‚Ä¶</h2>
<ul>
<li>Binding Python pour <a href="https://grass.osgeo.org/grass82/manuals/libpython/index.html">GRASS</a> + Int√©gration dans les notebooks Jupyter</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./fig/grass_jupyter_combo_vis.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Source: <a href="https://grass.osgeo.org/news/2022_06_05_results_student_grant_caitlin/" class="uri">https://grass.osgeo.org/news/2022_06_05_results_student_grant_caitlin/</a></figcaption><p></p>
</figure>
</div>
<ul>
<li><p><a href="https://scitools-iris.readthedocs.io/en/stable/">Iris</a></p></li>
<li><p>Pour la cartographie : <a href="https://scitools.org.uk/cartopy/docs/latest/">cartopy</a> ; <a href="https://geoviews.org/">geoviews</a> et <a href="https://residentmario.github.io/geoplot/">geoplot</a> bas√©s sur <em>cartopy</em> ; <a href="https://www.pygmt.org/latest/">PyGMT</a> (selon les usages - pas de solution aussi aboutie que <code>mapsf</code> pour les cartes r√©alis√©es en SHS).</p></li>
</ul>
<p><img src="./fig/cartopy.png" class="img-fluid"></p>
</section>
<section id="ressources-python-g√©ospatial" class="level2">
<h2 class="anchored" data-anchor-id="ressources-python-g√©ospatial">Ressources Python G√©ospatial</h2>
<ul>
<li><p><a href="https://py.geocompx.org/">https://py.geocompx.org/</a> <span class="citation" data-cites="Dorman2022">(<a href="#ref-Dorman2022" role="doc-biblioref">Dorman et al., 2022</a>)</span></p></li>
<li><p><a href="https://geo-python-site.readthedocs.io/en/latest/">https://geo-python-site.readthedocs.io/en/latest/</a></p></li>
<li><p><a href="https://automating-gis-processes.github.io">https://automating-gis-processes.github.io</a></p></li>
<li><p><a href="https://www.earthdatascience.org/courses/use-data-open-source-python/">https://www.earthdatascience.org/courses/use-data-open-source-python/</a></p></li>
<li><p><a href="https://geographicdata.science/book/intro.html">https://geographicdata.science/book/intro.html</a></p></li>
</ul>
</section>
<section id="interaction-r-python-dans-quarto" class="level2">
<h2 class="anchored" data-anchor-id="interaction-r-python-dans-quarto">Interaction R ‚áÑ Python dans Quarto</h2>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true" href="">R ‚Üí Python</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false" href="">Python ‚Üí R</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<ul>
<li>D√©finition de variables dans un chunk R :</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">42</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">13</span>, <span class="dv">14</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>R√©cup√©ration depuis un chunk Python :</li>
</ul>
<p><em>en utilisant la variable <code>r</code>, un point, et le nom de la variable R √† r√©cup√©rer</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(r.a)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>42.0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(r.b)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1.0, 2.0, 3.0]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(r.c)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[12.0, 13.0, 14.0]</code></pre>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<ul>
<li>D√©finition de variables dans un chunk Python :</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> <span class="dv">42</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>]</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>R√©cup√©ration depuis un chunk R :</li>
</ul>
<p><em>en utilisant la variable <code>py</code>, un dollar <code>$</code>, et le nom de la variable Python √† r√©cup√©rer</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(py<span class="sc">$</span>a)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 42</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(py<span class="sc">$</span>b)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 2 3</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="interaction-r-python-dans-quarto-suite" class="level2">
<h2 class="anchored" data-anchor-id="interaction-r-python-dans-quarto-suite">Interaction R ‚áÑ Python dans Quarto (suite)</h2>
<ul>
<li>Il est possible d‚Äô√©changer des types plus complexes (<code>data.frame</code> ‚áÑ <code>DataFrame</code> pandas, tableau numpy, etc.)</li>
</ul>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true" href="">R ‚Üí Python</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false" href="">Python ‚Üí R</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<ul>
<li>Depuis un chunk R :</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>   <span class="at">emp_id =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>),</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">emp_name =</span> <span class="fu">c</span>(<span class="st">"Rick"</span>,<span class="st">"Dan"</span>,<span class="st">"Michelle"</span>,<span class="st">"Ryan"</span>,<span class="st">"Jane"</span>),</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>   <span class="at">salary =</span> <span class="fu">c</span>(<span class="fl">623.3</span>,<span class="fl">515.2</span>,<span class="fl">611.0</span>,<span class="fl">729.0</span>,<span class="fl">843.25</span>),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>   <span class="at">start_date =</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="st">"2012-01-01"</span>, <span class="st">"2013-09-23"</span>, <span class="st">"2014-11-15"</span>, <span class="st">"2014-05-11"</span>, <span class="st">"2015-03-27"</span>)),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>   <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>R√©cup√©ration depuis un chunk Python :</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> r.df</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.head())</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   emp_id  emp_name  salary  start_date
0       1      Rick  623.30  2012-01-01
1       2       Dan  515.20  2013-09-23
2       3  Michelle  611.00  2014-11-15
3       4      Ryan  729.00  2014-05-11
4       5      Jane  843.25  2015-03-27</code></pre>
</div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<ul>
<li>Depuis un chunk Python :</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> pd.DataFrame({</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"emp_id"</span>: <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">5</span>)),</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"emp_name"</span>: [<span class="st">"Rick"</span>, <span class="st">"Dan"</span>, <span class="st">"Michelle"</span>, <span class="st">"Ryan"</span>, <span class="st">"Jane"</span>],</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"salary"</span>: [<span class="fl">623.3</span>, <span class="fl">515.2</span>, <span class="fl">611.0</span>, <span class="fl">729.0</span>, <span class="fl">843.25</span>],</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"start_date"</span>: pd.to_datetime([<span class="st">"2012-01-01"</span>, <span class="st">"2013-09-23"</span>, <span class="st">"2014-11-15"</span>, <span class="st">"2014-05-11"</span>, <span class="st">"2015-03-27"</span>]),</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>arr <span class="op">=</span> np.array([[<span class="dv">12</span>, <span class="dv">47</span>], [<span class="dv">34</span>, <span class="dv">90</span>], [<span class="dv">23</span>, <span class="dv">19</span>]])</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Utilisation depuis un chunk R :</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(py<span class="sc">$</span>df2)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  emp_id emp_name salary          start_date
1      0     Rick 623.30 2012-01-01 01:00:00
2      1      Dan 515.20 2013-09-23 02:00:00
3      2 Michelle 611.00 2014-11-15 01:00:00
4      3     Ryan 729.00 2014-05-11 02:00:00
5      4     Jane 843.25 2015-03-27 01:00:00</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(py<span class="sc">$</span>arr)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,]   12   47
[2,]   34   90
[3,]   23   19</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="interaction-r-python-dans-quarto-suite-1" class="level2">
<h2 class="anchored" data-anchor-id="interaction-r-python-dans-quarto-suite-1">Interaction R ‚áÑ Python dans Quarto (suite)</h2>
<p>Et pour les objets spatiaux ? (<em>sf</em> / <em>geopandas</em>)</p>
<ul>
<li><p>Si la conversion <code>data.frame</code> ‚áÑ <code>DataFrame</code> est transparente, il n‚Äôen est pas de m√™me pour les dataframe avec une composante spatiale (perte de la dimension spatiale / colonne <code>geometry</code> contient d√©sormais ‚Ä¶)</p></li>
<li><p>L‚Äô√©criture d‚Äôune petite function permet de r√©soudre √ßa :</p></li>
</ul>
<div class="cell">

</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.geometry <span class="im">import</span> shape</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> restore_geodataframe(df, crs, geom_type):</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  geom <span class="op">=</span> df.geometry.<span class="bu">apply</span>(<span class="kw">lambda</span> coords: shape({ <span class="st">"type"</span>: geom_type, <span class="st">"coordinates"</span>: coords }))</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>  gdf <span class="op">=</span> gpd.GeoDataFrame(df.drop([<span class="st">'geometry'</span>], axis<span class="op">=</span><span class="dv">1</span>), geometry<span class="op">=</span>geom)</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>  gdf.set_crs(crs, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> gdf</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ainsi, les objets <code>sf</code> pourront √™tre convertis en <code>GeoDataFrame</code> ainsi :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>mrc <span class="op">=</span> restore_geodataframe(r.mrc, r.crs, <span class="st">"MultiPolygon"</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>mrc.head()</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  MUS_CO_MRC                                    MUS_NM_MRC                       MUS_NM_REG                                           geometry
0         01  Communaut√© maritime des √éles-de-la-Madeleine  Gasp√©sie - √éles-de-la-Madeleine  MULTIPOLYGON (((505936.000 400484.000, 503752....
1         02                               Le Rocher-Perc√©  Gasp√©sie - √éles-de-la-Madeleine  MULTIPOLYGON (((288282.000 493474.000, 281197....
2         03                              La C√¥te-de-Gasp√©  Gasp√©sie - √éles-de-la-Madeleine  MULTIPOLYGON (((252570.000 528170.000, 252646....
3         04                             La Haute-Gasp√©sie  Gasp√©sie - √éles-de-la-Madeleine  MULTIPOLYGON (((120775.000 563455.000, 122763....
4         05                                   Bonaventure  Gasp√©sie - √éles-de-la-Madeleine  MULTIPOLYGON (((163436.000 501024.000, 187515....</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>resto <span class="op">=</span> restore_geodataframe(r.resto, r.crs, <span class="st">"Point"</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>resto.head()</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      osm_id         name     cuisine                        geometry
0  291667452    Chez Cora          NA  POINT (-205284.124 320601.265)
1  295803248    Normandin          NA  POINT (-221931.609 321452.378)
2  345886369  Chez Victor      burger  POINT (-207712.728 315587.610)
3  386267989       Ly-Hai  vietnamese  POINT (-207895.478 315365.940)
4  393559700       Mike's     italian  POINT (-217665.483 319360.818)</code></pre>
</div>
</div>
</section>
<section id="python-quarto-et-interactivit√©" class="level2">
<h2 class="anchored" data-anchor-id="python-quarto-et-interactivit√©">Python, Quarto et interactivit√©</h2>
<ul>
<li><p>Utilisation des widgets Jupyter possible (seulement is utilisation de l‚Äôengin de rendu <code>jupyter</code>, pas avec <code>knitr</code> - i.e.&nbsp;l‚Äôinverse des <em>htmlwidgets</em> en R qui ne fonctionne que si <code>knitr</code> est utilis√©)</p></li>
<li><p>Exemple :</p></li>
</ul>
<p><img src="./fig/example-quarto-jupyter-widgets.jpg" class="img-fluid"></p>
<ul>
<li>Documentation : <a href="https://quarto.org/docs/interactive/widgets/jupyter.html">https://quarto.org/docs/interactive/widgets/jupyter.html</a></li>
</ul>
</section>
<section id="exemples-danalyse-sur-les-donn√©es-du-qu√©bec" class="level2">
<h2 class="anchored" data-anchor-id="exemples-danalyse-sur-les-donn√©es-du-qu√©bec">Exemples d‚Äôanalyse sur les donn√©es du Qu√©bec</h2>
<ul>
<li>Les imports n√©cessaires :</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterio <span class="im">as</span> rio</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rioxarray</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xarray</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.warp <span class="im">import</span> calculate_default_transform, reproject, Resampling</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot <span class="im">as</span> plt</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.plot <span class="im">import</span> show</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.mask <span class="im">import</span> mask</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterstats <span class="im">import</span> zonal_stats, point_query</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>On r√©cup√®re les jeux de donn√©es et quelques autres infos (SRC, etc.) depuis l‚Äôenvironnement R :</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Le SCR des donn√©es</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>dst_crs <span class="op">=</span> r.crs</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="co"># On r√©cup√®re le jeu de donn√©es "mrc" (municipalit√©s r√©gionales de comt√©)</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="co"># et le jeu de donn√©es "resto"</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>mrc <span class="op">=</span> restore_geodataframe(r.mrc, dst_crs, <span class="st">"MultiPolygon"</span>)</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>resto <span class="op">=</span> restore_geodataframe(r.resto, dst_crs, <span class="st">"Point"</span>)</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>reg <span class="op">=</span> mrc.dissolve(by<span class="op">=</span><span class="st">"MUS_NM_REG"</span>)</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>sel <span class="op">=</span> r.sel <span class="co"># Qu√©bec</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Chemin du jeu de donn√©es raster</span></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a><span class="co"># et du fichier contenant les descriptions des cat√©gories</span></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>lc_fp <span class="op">=</span> <span class="st">'../../T√©l√©chargements/T01_PROVINCE.tif'</span></span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>lc_categories_fp <span class="op">=</span> <span class="st">'../../T√©l√©chargements/correspondance_raster_CL_COUV.dbf'</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>On extrait les entit√©s correspondantes et on les affiche, relativement au reste de la province :</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>extract <span class="op">=</span> mrc[mrc.MUS_NM_MRC <span class="op">==</span> sel]</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> mrc.plot(color<span class="op">=</span><span class="st">"lightblue"</span>, edgecolor<span class="op">=</span><span class="st">"grey"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">12</span>))</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> reg.plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="va">None</span>, edgecolor<span class="op">=</span><span class="st">"orange"</span>, alpha<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> extract.plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">"red"</span>)</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>ax</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="python_files/figure-html/demo-first-plot-1.png" class="img-fluid" width="1536"></p>
</div>
</div>
<ul>
<li>Ouverture et reprojection d‚Äôun jeu de donn√©es raster (avec <em>rioxarray</em>) :</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>xds <span class="op">=</span> rioxarray.open_rasterio(lc_fp)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>xds <span class="op">=</span> xds.rio.reproject(dst_crs)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>xds</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewbox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewbox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '‚ñ∫';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '‚ñº';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class="xr-text-repr-fallback">&lt;xarray.DataArray (band: 1, y: 23726, x: 28690)&gt;
array([[[255, 255, 255, ..., 255, 255, 255],
        [255, 255, 255, ..., 255, 255, 255],
        [255, 255, 255, ..., 255, 255, 255],
        ...,
        [255, 255, 255, ..., 255, 255, 255],
        [255, 255, 255, ..., 255, 255, 255],
        [255, 255, 255, ..., 255, 255, 255]]], dtype=uint8)
Coordinates:
  * x            (x) float64 -8.306e+05 -8.305e+05 ... 6.038e+05 6.039e+05
  * y            (y) float64 1.303e+06 1.303e+06 ... 1.173e+05 1.172e+05
  * band         (band) int64 1
    spatial_ref  int64 0
Attributes: (12/13)
    AREA_OR_POINT:             Area
    RepresentationType:        THEMATIC
    STATISTICS_COVARIANCES:    5.53386940676013
    STATISTICS_MAXIMUM:        11
    STATISTICS_MEAN:           6.4740178066376
    STATISTICS_MINIMUM:        1
    ...                        ...
    STATISTICS_SKIPFACTORY:    1
    STATISTICS_STDDEV:         2.3524177748412
    STATISTICS_VALID_PERCENT:  41.95
    scale_factor:              1.0
    add_offset:                0.0
    _FillValue:                255</pre><div class="xr-wrap" style="display:none"><div class="xr-header"><div class="xr-obj-type">xarray.DataArray</div><div class="xr-array-name"></div><ul class="xr-dim-list"><li><span class="xr-has-index">band</span>: 1</li><li><span class="xr-has-index">y</span>: 23726</li><li><span class="xr-has-index">x</span>: 28690</li></ul></div><ul class="xr-sections"><li class="xr-section-item"><div class="xr-array-wrap"><input id="section-d11ec68c-4894-4598-a216-76afa4b48fb2" class="xr-array-in" type="checkbox" checked=""><label for="section-d11ec68c-4894-4598-a216-76afa4b48fb2" title="Show/hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-array-preview xr-preview"><span>255 255 255 255 255 255 255 255 ... 255 255 255 255 255 255 255 255</span></div><div class="xr-array-data"><pre>array([[[255, 255, 255, ..., 255, 255, 255],
        [255, 255, 255, ..., 255, 255, 255],
        [255, 255, 255, ..., 255, 255, 255],
        ...,
        [255, 255, 255, ..., 255, 255, 255],
        [255, 255, 255, ..., 255, 255, 255],
        [255, 255, 255, ..., 255, 255, 255]]], dtype=uint8)</pre></div></div></li><li class="xr-section-item"><input id="section-734060c5-cd81-41fb-a14f-9f58110d3664" class="xr-section-summary-in" type="checkbox" checked=""><label for="section-734060c5-cd81-41fb-a14f-9f58110d3664" class="xr-section-summary">Coordinates: <span>(4)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><ul class="xr-var-list"><li class="xr-var-item"><div class="xr-var-name"><span class="xr-has-index">x</span></div><div class="xr-var-dims">(x)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">-8.306e+05 -8.305e+05 ... 6.039e+05</div><input id="attrs-3201b6d0-03fe-47f0-a549-8d1d7ea2feff" class="xr-var-attrs-in" type="checkbox"><label for="attrs-3201b6d0-03fe-47f0-a549-8d1d7ea2feff" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-1ab22038-493a-491e-88c5-ef5ab10cef83" class="xr-var-data-in" type="checkbox"><label for="data-1ab22038-493a-491e-88c5-ef5ab10cef83" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>axis :</span></dt><dd>X</dd><dt><span>long_name :</span></dt><dd>x coordinate of projection</dd><dt><span>standard_name :</span></dt><dd>projection_x_coordinate</dd><dt><span>units :</span></dt><dd>metre</dd></dl></div><div class="xr-var-data"><pre>array([-830559.8693, -830509.8693, -830459.8693, ...,  603790.1307,
        603840.1307,  603890.1307])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span class="xr-has-index">y</span></div><div class="xr-var-dims">(y)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">1.303e+06 1.303e+06 ... 1.172e+05</div><input id="attrs-a735fdea-21e6-416a-b3c2-813c93b94b83" class="xr-var-attrs-in" type="checkbox"><label for="attrs-a735fdea-21e6-416a-b3c2-813c93b94b83" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-bf75b12c-122d-40b6-a4f1-8706a52b3200" class="xr-var-data-in" type="checkbox"><label for="data-bf75b12c-122d-40b6-a4f1-8706a52b3200" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>axis :</span></dt><dd>Y</dd><dt><span>long_name :</span></dt><dd>y coordinate of projection</dd><dt><span>standard_name :</span></dt><dd>projection_y_coordinate</dd><dt><span>units :</span></dt><dd>metre</dd></dl></div><div class="xr-var-data"><pre>array([1303477.2747, 1303427.2747, 1303377.2747, ...,  117327.2747,
        117277.2747,  117227.2747])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span class="xr-has-index">band</span></div><div class="xr-var-dims">(band)</div><div class="xr-var-dtype">int64</div><div class="xr-var-preview xr-preview">1</div><input id="attrs-6ca11a91-33c9-4abd-870c-426b92c11c39" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-6ca11a91-33c9-4abd-870c-426b92c11c39" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-f332a941-eaf4-40ea-9693-3b1d96583af4" class="xr-var-data-in" type="checkbox"><label for="data-f332a941-eaf4-40ea-9693-3b1d96583af4" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([1])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>spatial_ref</span></div><div class="xr-var-dims">()</div><div class="xr-var-dtype">int64</div><div class="xr-var-preview xr-preview">0</div><input id="attrs-97ae00eb-779a-405d-9da9-e54d9ea7b39a" class="xr-var-attrs-in" type="checkbox"><label for="attrs-97ae00eb-779a-405d-9da9-e54d9ea7b39a" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-b99f9035-672d-49ff-b736-e4b1a0845904" class="xr-var-data-in" type="checkbox"><label for="data-b99f9035-672d-49ff-b736-e4b1a0845904" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>crs_wkt :</span></dt><dd>PROJCS["NAD83 / Quebec Albers",GEOGCS["NAD83",DATUM["North_American_Datum_1983",SPHEROID["GRS 1980",6378137,298.257222101,AUTHORITY["EPSG","7019"]],AUTHORITY["EPSG","6269"]],PRIMEM["Greenwich",0,AUTHORITY["EPSG","8901"]],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]],AUTHORITY["EPSG","4269"]],PROJECTION["Albers_Conic_Equal_Area"],PARAMETER["latitude_of_center",44],PARAMETER["longitude_of_center",-68.5],PARAMETER["standard_parallel_1",60],PARAMETER["standard_parallel_2",46],PARAMETER["false_easting",0],PARAMETER["false_northing",0],UNIT["metre",1,AUTHORITY["EPSG","9001"]],AXIS["Easting",EAST],AXIS["Northing",NORTH],AUTHORITY["EPSG","6623"]]</dd><dt><span>semi_major_axis :</span></dt><dd>6378137.0</dd><dt><span>semi_minor_axis :</span></dt><dd>6356752.314140356</dd><dt><span>inverse_flattening :</span></dt><dd>298.257222101</dd><dt><span>reference_ellipsoid_name :</span></dt><dd>GRS 1980</dd><dt><span>longitude_of_prime_meridian :</span></dt><dd>0.0</dd><dt><span>prime_meridian_name :</span></dt><dd>Greenwich</dd><dt><span>geographic_crs_name :</span></dt><dd>NAD83</dd><dt><span>horizontal_datum_name :</span></dt><dd>North American Datum 1983</dd><dt><span>projected_crs_name :</span></dt><dd>NAD83 / Quebec Albers</dd><dt><span>grid_mapping_name :</span></dt><dd>albers_conical_equal_area</dd><dt><span>standard_parallel :</span></dt><dd>(60.0, 46.0)</dd><dt><span>latitude_of_projection_origin :</span></dt><dd>44.0</dd><dt><span>longitude_of_central_meridian :</span></dt><dd>-68.5</dd><dt><span>false_easting :</span></dt><dd>0.0</dd><dt><span>false_northing :</span></dt><dd>0.0</dd><dt><span>spatial_ref :</span></dt><dd>PROJCS["NAD83 / Quebec Albers",GEOGCS["NAD83",DATUM["North_American_Datum_1983",SPHEROID["GRS 1980",6378137,298.257222101,AUTHORITY["EPSG","7019"]],AUTHORITY["EPSG","6269"]],PRIMEM["Greenwich",0,AUTHORITY["EPSG","8901"]],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]],AUTHORITY["EPSG","4269"]],PROJECTION["Albers_Conic_Equal_Area"],PARAMETER["latitude_of_center",44],PARAMETER["longitude_of_center",-68.5],PARAMETER["standard_parallel_1",60],PARAMETER["standard_parallel_2",46],PARAMETER["false_easting",0],PARAMETER["false_northing",0],UNIT["metre",1,AUTHORITY["EPSG","9001"]],AXIS["Easting",EAST],AXIS["Northing",NORTH],AUTHORITY["EPSG","6623"]]</dd><dt><span>GeoTransform :</span></dt><dd>-830584.8693000015 50.00000000000006 0.0 1303502.274700009 0.0 -50.00000000000006</dd></dl></div><div class="xr-var-data"><pre>array(0)</pre></div></li></ul></div></li><li class="xr-section-item"><input id="section-d1646852-fb1e-4384-8aff-b507a96e351d" class="xr-section-summary-in" type="checkbox"><label for="section-d1646852-fb1e-4384-8aff-b507a96e351d" class="xr-section-summary">Indexes: <span>(3)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><ul class="xr-var-list"><li class="xr-var-item"><div class="xr-index-name"><div>x</div></div><div class="xr-index-preview">PandasIndex</div><div></div><input id="index-69921d81-1739-4889-a598-ba1b176f9655" class="xr-index-data-in" type="checkbox"><label for="index-69921d81-1739-4889-a598-ba1b176f9655" title="Show/Hide index repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-index-data"><pre>PandasIndex(Index([-830559.8693000015, -830509.8693000015, -830459.8693000015, -830409.8693000015, -830359.8693000015, -830309.8693000015, -830259.8693000015, -830209.8693000015, -830159.8693000015, -830109.8693000015,
       ...
        603440.1307000001,  603490.1307000001,  603540.1307000001,  603590.1307000001,  603640.1307000001,  603690.1307000001,  603740.1307000001,  603790.1307000001,  603840.1307000001,  603890.1307000001], dtype='float64', name='x', length=28690))</pre></div></li><li class="xr-var-item"><div class="xr-index-name"><div>y</div></div><div class="xr-index-preview">PandasIndex</div><div></div><input id="index-5db47169-8899-42a2-931b-60fd40219b1b" class="xr-index-data-in" type="checkbox"><label for="index-5db47169-8899-42a2-931b-60fd40219b1b" title="Show/Hide index repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-index-data"><pre>PandasIndex(Index([ 1303477.274700009,  1303427.274700009,  1303377.274700009,  1303327.274700009,  1303277.274700009,  1303227.274700009,  1303177.274700009,  1303127.274700009,  1303077.274700009,  1303027.274700009,
       ...
       117677.27470000763, 117627.27470000763, 117577.27470000763, 117527.27470000763, 117477.27470000763, 117427.27470000763, 117377.27470000763, 117327.27470000763, 117277.27470000763, 117227.27470000763], dtype='float64', name='y', length=23726))</pre></div></li><li class="xr-var-item"><div class="xr-index-name"><div>band</div></div><div class="xr-index-preview">PandasIndex</div><div></div><input id="index-c79423d2-b9f1-493a-8ec2-173950fe273c" class="xr-index-data-in" type="checkbox"><label for="index-c79423d2-b9f1-493a-8ec2-173950fe273c" title="Show/Hide index repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-index-data"><pre>PandasIndex(Index([1], dtype='int64', name='band'))</pre></div></li></ul></div></li><li class="xr-section-item"><input id="section-0c17c542-cf2a-4d13-bf4a-fe40b5d7d44c" class="xr-section-summary-in" type="checkbox"><label for="section-0c17c542-cf2a-4d13-bf4a-fe40b5d7d44c" class="xr-section-summary">Attributes: <span>(13)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><dl class="xr-attrs"><dt><span>AREA_OR_POINT :</span></dt><dd>Area</dd><dt><span>RepresentationType :</span></dt><dd>THEMATIC</dd><dt><span>STATISTICS_COVARIANCES :</span></dt><dd>5.53386940676013</dd><dt><span>STATISTICS_MAXIMUM :</span></dt><dd>11</dd><dt><span>STATISTICS_MEAN :</span></dt><dd>6.4740178066376</dd><dt><span>STATISTICS_MINIMUM :</span></dt><dd>1</dd><dt><span>STATISTICS_SKIPFACTORX :</span></dt><dd>1</dd><dt><span>STATISTICS_SKIPFACTORY :</span></dt><dd>1</dd><dt><span>STATISTICS_STDDEV :</span></dt><dd>2.3524177748412</dd><dt><span>STATISTICS_VALID_PERCENT :</span></dt><dd>41.95</dd><dt><span>scale_factor :</span></dt><dd>1.0</dd><dt><span>add_offset :</span></dt><dd>0.0</dd><dt><span>_FillValue :</span></dt><dd>255</dd></dl></div></li></ul></div></div>
</div>
</div>
<ul>
<li>Affichons le raster reprojet√© et l‚Äôemprise de la ville de Qu√©bec :</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remplacer les '255' par '0'</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>xds.data[xds.data <span class="op">==</span> <span class="dv">255</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="co"># √âtendue des donn√©es</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>bounds <span class="op">=</span> xds.rio.bounds()</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>extent <span class="op">=</span> [bounds[<span class="dv">0</span>], bounds[<span class="dv">2</span>], bounds[<span class="dv">1</span>], bounds[<span class="dv">3</span>]]</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Cr√©ation d'une figure vide</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">12</span>))</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Affichage du raster (attribut 'data' de l'objet xds)</span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>show(xds.data[<span class="dv">0</span>], ax<span class="op">=</span>ax, extent<span class="op">=</span>extent, cmap<span class="op">=</span><span class="st">"Set3"</span>)</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Affichage de la ville de Qu√©bec en rouge par dessus</span></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>extract.plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">'red'</span>, edgecolor<span class="op">=</span><span class="st">'red'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a><span class="co"># On enl√®ve l'affichage des axes</span></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>ax</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="python_files/figure-html/demo-plot-raster-3.png" class="img-fluid" width="1536"></p>
</div>
</div>
<ul>
<li>Ouverture du fichier DBF qui contient les correspondances entre les codes et les noms des cat√©gories d‚Äôutilisation des sols</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>categories <span class="op">=</span> pd.DataFrame(</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  gpd.read_file(lc_categories_fp, encoding<span class="op">=</span><span class="st">'utf-8'</span>)[[<span class="st">'ID'</span>, <span class="st">'CL_COUV'</span>, <span class="st">'Descriptio'</span>]])</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>categories.head(<span class="dv">11</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      ID CL_COUV                             Descriptio
0    1.0  010000                 Surfaces artificielles
1    2.0  020000                       Terres agricoles
2    3.0  060000             Milieux humides forestiers
3    4.0  070000  Milieux&nbsp;humides&nbsp;herbac√©s&nbsp;ou&nbsp;arbustifs
4    5.0  100000        Plans et cours d‚Äôeau int√©rieure
5    6.0  110101    For√™ts de conif√®res √† couvert ferm√©
6    7.0  110102     For√™ts&nbsp;de&nbsp;feuillus&nbsp;√†&nbsp;couvert&nbsp;ferm√©
7    8.0  110103          For√™ts&nbsp;mixtes&nbsp;√†&nbsp;couvert&nbsp;ferm√©
8    9.0  110200                For√™ts √† couvert ouvert
9   10.0  000000                         Pas de donn√©es
10  11.0  000001               En attente de traitement</code></pre>
</div>
</div>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On va convertir cette DataFrame en un dictionnaire pour l'utiliser</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="co"># comme un mapping ID -&gt; Description</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>categories <span class="op">=</span> {</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="bu">int</span>(k): v[<span class="st">'Descriptio'</span>]</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> k,v <span class="kw">in</span> categories[[<span class="st">'ID'</span>, <span class="st">'Descriptio'</span>]].set_index(<span class="st">'ID'</span>).to_dict(orient<span class="op">=</span><span class="st">'index'</span>).items()</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Bien qu'il y ait une cat√©gorie 'Pas de donn√©es' (ID 10)</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a><span class="co"># certaines cellules ne comportent pas de valeur (nodata, ici avec la valeur 0)</span></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>categories[<span class="dv">0</span>] <span class="op">=</span> <span class="st">'Pas de donn√©es'</span></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>categories</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{1: 'Surfaces artificielles', 2: 'Terres agricoles', 3: 'Milieux humides forestiers', 4: 'Milieux\xa0humides\xa0herbac√©s\xa0ou\xa0arbustifs', 5: 'Plans et cours d‚Äôeau int√©rieure', 6: 'For√™ts de conif√®res √† couvert ferm√©', 7: 'For√™ts\xa0de\xa0feuillus\xa0√†\xa0couvert\xa0ferm√©', 8: 'For√™ts\xa0mixtes\xa0√†\xa0couvert\xa0ferm√©', 9: 'For√™ts √† couvert ouvert', 10: 'Pas de donn√©es', 11: 'En attente de traitement', 12: 'Surfaces artificielles vers terres agricoles', 13: 'Surfaces artificielles vers milieux humides forestiers', 14: 'Surfaces artificielles vers milieux\xa0humides\xa0herbac√©s\xa0ou\xa0arbustifs', 15: 'Surfaces artificielles vers plans et cours d‚Äôeau int√©rieure', 16: 'Surfaces artificielles vers for√™ts de conif√®res √† couvert ferm√©', 17: 'Surfaces artificielles vers for√™ts\xa0de\xa0feuillus\xa0√†\xa0couvert\xa0ferm√©', 18: 'Surfaces artificielles vers for√™ts\xa0mixtes\xa0√†\xa0couvert\xa0ferm√©', 19: 'Surfaces artificielles vers for√™ts √† couvert ouvert', 20: 'Surfaces artificielles vers pas de donn√©es', 21: 'Surfaces artificielles vers en attente de traitement', 22: 'Terres agricoles vers surfaces artificielles', 23: 'Terres agricoles vers milieux humides forestiers', 24: 'Terres agricoles vers milieux\xa0humides\xa0herbac√©s\xa0ou\xa0arbustifs', 25: 'Terres agricoles vers plans et cours d‚Äôeau int√©rieure', 26: 'Terres agricoles vers for√™ts de conif√®res √† couvert ferm√©', 27: 'Terres agricoles vers for√™ts\xa0de\xa0feuillus\xa0√†\xa0couvert\xa0ferm√©', 28: 'Terres agricoles vers for√™ts\xa0mixtes\xa0√†\xa0couvert\xa0ferm√©', 29: 'Terres agricoles vers for√™ts √† couvert ouvert', 30: 'Terres agricoles vers pas de donn√©es', 31: 'Terres agricoles vers en attente de traitement', 32: 'Milieux humides forestiers vers surfaces artificielles', 33: 'Milieux humides forestiers vers terres agricoles', 34: 'Milieux humides forestiers vers milieux\xa0humides\xa0herbac√©s\xa0ou\xa0arbustifs', 35: 'Milieux humides forestiers vers plans et cours d‚Äôeau int√©rieure', 36: 'Milieux humides forestiers vers for√™ts de conif√®res √† couvert ferm√©', 37: 'Milieux humides forestiers vers for√™ts\xa0de\xa0feuillus\xa0√†\xa0couvert\xa0ferm√©', 38: 'Milieux humides forestiers vers for√™ts\xa0mixtes\xa0√†\xa0couvert\xa0ferm√©', 39: 'Milieux humides forestiers vers for√™ts √† couvert ouvert', 40: 'Milieux humides forestiers vers pas de donn√©es', 41: 'Milieux humides forestiers vers en attente de traitement', 42: 'Milieux\xa0humides\xa0herbac√©s\xa0ou\xa0arbustifs vers surfaces artificielles', 43: 'Milieux\xa0humides\xa0herbac√©s\xa0ou\xa0arbustifs vers terres agricoles', 44: 'Milieux\xa0humides\xa0herbac√©s\xa0ou\xa0arbustifs vers milieux humides forestiers', 45: 'Milieux\xa0humides\xa0herbac√©s\xa0ou\xa0arbustifs vers plans et cours d‚Äôeau int√©rieure', 46: 'Milieux\xa0humides\xa0herbac√©s\xa0ou\xa0arbustifs vers for√™ts de conif√®res √† couvert ferm√©', 47: 'Milieux\xa0humides\xa0herbac√©s\xa0ou\xa0arbustifs vers for√™ts\xa0de\xa0feuillus\xa0√†\xa0couvert\xa0ferm√©', 48: 'Milieux\xa0humides\xa0herbac√©s\xa0ou\xa0arbustifs vers for√™ts\xa0mixtes\xa0√†\xa0couvert\xa0ferm√©', 49: 'Milieux\xa0humides\xa0herbac√©s\xa0ou\xa0arbustifs vers for√™ts √† couvert ouvert', 50: 'Milieux\xa0humides\xa0herbac√©s\xa0ou\xa0arbustifs vers pas de donn√©es', 51: 'Milieux\xa0humides\xa0herbac√©s\xa0ou\xa0arbustifs vers en attente de traitement', 52: 'Plans et cours d‚Äôeau int√©rieure vers surfaces artificielles', 53: 'Plans et cours d‚Äôeau int√©rieure vers terres agricoles', 54: 'Plans et cours d‚Äôeau int√©rieure vers milieux humides forestiers', 55: 'Plans et cours d‚Äôeau int√©rieure vers milieux\xa0humides\xa0herbac√©s\xa0ou\xa0arbustifs', 56: 'Plans et cours d‚Äôeau int√©rieure vers for√™ts de conif√®res √† couvert ferm√©', 57: 'Plans et cours d‚Äôeau int√©rieure vers for√™ts\xa0de\xa0feuillus\xa0√†\xa0couvert\xa0ferm√©', 58: 'Plans et cours d‚Äôeau int√©rieure vers for√™ts\xa0mixtes\xa0√†\xa0couvert\xa0ferm√©', 59: 'Plans et cours d‚Äôeau int√©rieure vers for√™ts √† couvert ouvert', 60: 'Plans et cours d‚Äôeau int√©rieure vers pas de donn√©es', 61: 'Plans et cours d‚Äôeau int√©rieure vers en attente de traitement', 62: 'For√™ts de conif√®res √† couvert ferm√© vers surfaces artificielles', 63: 'For√™ts de conif√®res √† couvert ferm√© vers terres agricoles', 64: 'For√™ts de conif√®res √† couvert ferm√© vers milieux humides forestiers', 65: 'For√™ts de conif√®res √† couvert ferm√© vers milieux\xa0humides\xa0herbac√©s\xa0ou\xa0arbustifs', 66: 'For√™ts de conif√®res √† couvert ferm√© vers plans et cours d‚Äôeau int√©rieure', 67: 'For√™ts de conif√®res √† couvert ferm√© vers for√™ts\xa0de\xa0feuillus\xa0√†\xa0couvert\xa0ferm√©', 68: 'For√™ts de conif√®res √† couvert ferm√© vers for√™ts\xa0mixtes\xa0√†\xa0couvert\xa0ferm√©', 69: 'For√™ts de conif√®res √† couvert ferm√© vers for√™ts √† couvert ouvert', 70: 'For√™ts de conif√®res √† couvert ferm√© vers pas de donn√©es', 71: 'For√™ts de conif√®res √† couvert ferm√© vers en attente de traitement', 72: 'For√™ts\xa0de\xa0feuillus\xa0√†\xa0couvert\xa0ferm√© vers surfaces artificielles', 73: 'For√™ts\xa0de\xa0feuillus\xa0√†\xa0couvert\xa0ferm√© vers terres agricoles', 74: 'For√™ts\xa0de\xa0feuillus\xa0√†\xa0couvert\xa0ferm√© vers milieux humides forestiers', 75: 'For√™ts\xa0de\xa0feuillus\xa0√†\xa0couvert\xa0ferm√© vers milieux\xa0humides\xa0herbac√©s\xa0ou\xa0arbustifs', 76: 'For√™ts\xa0de\xa0feuillus\xa0√†\xa0couvert\xa0ferm√© vers plans et cours d‚Äôeau int√©rieure', 77: 'For√™ts\xa0de\xa0feuillus\xa0√†\xa0couvert\xa0ferm√© vers for√™ts de conif√®res √† couvert ferm√©', 78: 'For√™ts\xa0de\xa0feuillus\xa0√†\xa0couvert\xa0ferm√© vers for√™ts\xa0mixtes\xa0√†\xa0couvert\xa0ferm√©', 79: 'For√™ts\xa0de\xa0feuillus\xa0√†\xa0couvert\xa0ferm√© vers for√™ts √† couvert ouvert', 80: 'For√™ts\xa0de\xa0feuillus\xa0√†\xa0couvert\xa0ferm√© vers pas de donn√©es', 81: 'For√™ts\xa0de\xa0feuillus\xa0√†\xa0couvert\xa0ferm√© vers en attente de traitement', 82: 'For√™ts\xa0mixtes\xa0√†\xa0couvert\xa0ferm√© vers surfaces artificielles', 83: 'For√™ts\xa0mixtes\xa0√†\xa0couvert\xa0ferm√© vers terres agricoles', 84: 'For√™ts\xa0mixtes\xa0√†\xa0couvert\xa0ferm√© vers milieux humides forestiers', 85: 'For√™ts\xa0mixtes\xa0√†\xa0couvert\xa0ferm√© vers milieux\xa0humides\xa0herbac√©s\xa0ou\xa0arbustifs', 86: 'For√™ts\xa0mixtes\xa0√†\xa0couvert\xa0ferm√© vers plans et cours d‚Äôeau int√©rieure', 87: 'For√™ts\xa0mixtes\xa0√†\xa0couvert\xa0ferm√© vers for√™ts de conif√®res √† couvert ferm√©', 88: 'For√™ts\xa0mixtes\xa0√†\xa0couvert\xa0ferm√© vers for√™ts\xa0de\xa0feuillus\xa0√†\xa0couvert\xa0ferm√©', 89: 'For√™ts\xa0mixtes\xa0√†\xa0couvert\xa0ferm√© vers for√™ts √† couvert ouvert', 90: 'For√™ts\xa0mixtes\xa0√†\xa0couvert\xa0ferm√© vers pas de donn√©es', 91: 'For√™ts\xa0mixtes\xa0√†\xa0couvert\xa0ferm√© vers en attente de traitement', 92: 'For√™ts √† couvert ouvert vers surfaces artificielles', 93: 'For√™ts √† couvert ouvert vers terres agricoles', 94: 'For√™ts √† couvert ouvert vers milieux humides forestiers', 95: 'For√™ts √† couvert ouvert vers milieux\xa0humides\xa0herbac√©s\xa0ou\xa0arbustifs', 96: 'For√™ts √† couvert ouvert vers plans et cours d‚Äôeau int√©rieure', 97: 'For√™ts √† couvert ouvert vers for√™ts de conif√®res √† couvert ferm√©', 98: 'For√™ts √† couvert ouvert vers for√™ts\xa0de\xa0feuillus\xa0√†\xa0couvert\xa0ferm√©', 99: 'For√™ts √† couvert ouvert vers for√™ts\xa0mixtes\xa0√†\xa0couvert\xa0ferm√©', 100: 'For√™ts √† couvert ouvert vers pas de donn√©es', 101: 'For√™ts √† couvert ouvert vers en attente de traitement', 102: 'Pas de donn√©es vers surfaces artificielles', 103: 'Pas de donn√©es vers terres agricoles', 104: 'Pas de donn√©es vers milieux humides forestiers', 105: 'Pas de donn√©es vers milieux\xa0humides\xa0herbac√©s\xa0ou\xa0arbustifs', 106: 'Pas de donn√©es vers plans et cours d‚Äôeau int√©rieure', 107: 'Pas de donn√©es vers for√™ts de conif√®res √† couvert ferm√©', 108: 'Pas de donn√©es vers for√™ts\xa0de\xa0feuillus\xa0√†\xa0couvert\xa0ferm√©', 109: 'Pas de donn√©es vers for√™ts\xa0mixtes\xa0√†\xa0couvert\xa0ferm√©', 110: 'Pas de donn√©es vers for√™ts √† couvert ouvert', 111: 'Pas de donn√©es vers en attente de traitement', 112: 'En attente de traitement vers surfaces artificielles', 113: 'En attente de traitement vers terres agricoles', 114: 'En attente de traitement vers milieux humides forestiers', 115: 'En attente de traitement vers milieux\xa0humides\xa0herbac√©s\xa0ou\xa0arbustifs', 116: 'En attente de traitement vers plans et cours d‚Äôeau int√©rieure', 117: 'En attente de traitement vers for√™ts de conif√®res √† couvert ferm√©', 118: 'En attente de traitement vers for√™ts\xa0de\xa0feuillus\xa0√†\xa0couvert\xa0ferm√©', 119: 'En attente de traitement vers for√™ts\xa0mixtes\xa0√†\xa0couvert\xa0ferm√©', 120: 'En attente de traitement vers for√™ts √† couvert ouvert', 121: 'En attente de traitement vers pas de donn√©es', 0: 'Pas de donn√©es'}</code></pre>
</div>
</div>
<ul>
<li>Calculer les statistiques zonales (combien de cellules de chaque type dans la s√©lection) :</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>stats <span class="op">=</span> zonal_stats(extract, xds.data[<span class="dv">0</span>], affine<span class="op">=</span>xds.rio.transform(), categorical<span class="op">=</span><span class="va">True</span>, nodata<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>stats</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[{1: 95228, 2: 25829, 3: 4574, 4: 778, 5: 5490, 6: 4124, 7: 43887, 8: 44969, 9: 62, 10: 47}]</code></pre>
</div>
</div>
<ul>
<li>Tra√ßons un histogramme de ce r√©sultat, en utilisant les noms appropri√©s des cat√©gories d‚Äôutilisation des sols :</li>
</ul>
<div class="cell" data-output-location="slide">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Utilise les noms de cat√©gories du DataFrame `categories`...</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> [categories[<span class="bu">int</span>(v)] <span class="cf">for</span> v <span class="kw">in</span> stats[<span class="dv">0</span>].keys()]</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ...et les valeurs que nous venons de calculer avec la fonction `zonal_stats`</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>height <span class="op">=</span> stats[<span class="dv">0</span>].values()</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">8</span>))</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>bar_container <span class="op">=</span> ax.bar(x, height)</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>ax.set_xticklabels(</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>    ax.get_xticklabels(),</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>    rotation<span class="op">=</span><span class="dv">45</span>,</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>    horizontalalignment<span class="op">=</span><span class="st">'right'</span></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>ax</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="python_files/figure-html/unnamed-chunk-6-5.png" class="img-fluid" width="768"></p>
</div>
</div>
<ul>
<li>Affichons un petit r√©sum√© utilisant des valeurs en m</li>
<li>Dans quel type d‚Äôoccupation du sol se trouvent les restaurants pr√©c√©demment r√©cup√©r√©s ?</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>geoms <span class="op">=</span> resto[<span class="st">'geometry'</span>].tolist()</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>resto[<span class="st">"lc"</span>] <span class="op">=</span> [categories[<span class="bu">int</span>(x)] <span class="cf">for</span> x <span class="kw">in</span> point_query(vectors<span class="op">=</span>geoms, raster<span class="op">=</span>xds.data[<span class="dv">0</span>], nodata<span class="op">=</span><span class="dv">0</span>, affine<span class="op">=</span>xds.rio.transform())]</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>resto.head()</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      osm_id         name     cuisine                        geometry                      lc
0  291667452    Chez Cora          NA  POINT (-205284.124 320601.265)  Surfaces artificielles
1  295803248    Normandin          NA  POINT (-221931.609 321452.378)  Surfaces artificielles
2  345886369  Chez Victor      burger  POINT (-207712.728 315587.610)  Surfaces artificielles
3  386267989       Ly-Hai  vietnamese  POINT (-207895.478 315365.940)  Surfaces artificielles
4  393559700       Mike's     italian  POINT (-217665.483 319360.818)  Surfaces artificielles</code></pre>
</div>
</div>
<ul>
<li>Quels restaurants ne sont pas situ√©s dans une zone artificialis√©e ?</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>selection <span class="op">=</span> resto[(resto.lc <span class="op">!=</span> <span class="st">'Surfaces artificielles'</span>) <span class="op">&amp;</span> (resto.lc <span class="op">!=</span> <span class="st">'Pas de donn√©es'</span>)]</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>selection</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          osm_id                        name                          cuisine                        geometry                                     lc
68    2395695353                  Yuzu sushi                            sushi  POINT (-222424.372 321631.681)             Milieux humides forestiers
197   3089591298                     Caf√© 47                               NA  POINT (-211438.971 309903.333)             Milieux humides forestiers
209   3222747115                  Yuzu Sushi                               NA  POINT (-213715.133 318403.631)     For√™ts&nbsp;de&nbsp;feuillus&nbsp;√†&nbsp;couvert&nbsp;ferm√©
210   3224167888                   Le Subtil                               NA  POINT (-212550.597 319033.410)     For√™ts&nbsp;de&nbsp;feuillus&nbsp;√†&nbsp;couvert&nbsp;ferm√©
214   3257077054            Ben &amp; Florentine                               NA  POINT (-221125.085 321891.351)             Milieux humides forestiers
235   3801921158               Le Commandant                          italian  POINT (-218914.348 315176.377)          For√™ts&nbsp;mixtes&nbsp;√†&nbsp;couvert&nbsp;ferm√©
287   4726892021                        Pidz                            pizza  POINT (-229413.591 325273.771)        Plans et cours d‚Äôeau int√©rieure
295   5099196285         Le Bistro √âvolution                               NA  POINT (-210863.848 307329.858)          For√™ts&nbsp;mixtes&nbsp;√†&nbsp;couvert&nbsp;ferm√©
323   5485394052  √©rabli√®re du chemin du Roy  maple;ice_cream;quebec;canadian  POINT (-222402.680 308460.059)             Milieux humides forestiers
324   5485401715                   Quai 1636                  regional;french  POINT (-216802.399 309187.074)                       Terres agricoles
355   6643475285                     La cage                               NA  POINT (-203039.864 313768.119)  Milieux&nbsp;humides&nbsp;herbac√©s&nbsp;ou&nbsp;arbustifs
371   7816042184                 Chez Victor                               NA  POINT (-210673.674 307668.201)                       Terres agricoles
404  10878153356                      Pacini                          italian  POINT (-213819.005 318251.978)    For√™ts de conif√®res √† couvert ferm√©
405  10878153357                  Yuzu sushi                            sushi  POINT (-213801.047 318254.188)     For√™ts&nbsp;de&nbsp;feuillus&nbsp;√†&nbsp;couvert&nbsp;ferm√©
420    189982784              Resto-Pub Ryna                               NA  POINT (-211598.938 306756.046)     For√™ts&nbsp;de&nbsp;feuillus&nbsp;√†&nbsp;couvert&nbsp;ferm√©
467    998906150                 Benny &amp; Co.         chicken;barbecue;poutine  POINT (-213983.922 325706.559)                       Terres agricoles</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> extract.plot(color<span class="op">=</span><span class="va">None</span>, edgecolor<span class="op">=</span><span class="st">"black"</span>)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> selection.plot(ax<span class="op">=</span>ax, marker<span class="op">=</span><span class="st">'x'</span>, color<span class="op">=</span><span class="st">'red'</span>, markersize<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>ax</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="python_files/figure-html/unnamed-chunk-9-7.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="a-vous-de-jouer" class="level2">
<h2 class="anchored" data-anchor-id="a-vous-de-jouer">A vous de jouer üöÄ</h2>
<p><strong>Objectif</strong> : Comparez l‚Äôoccupation du sol de l‚Äôensemble de la province du Qu√©bec √† l‚Äôoccupation du sol de la MRC de Montr√©al.</p>
<ul>
<li>Vous cherchez √† obtenir :
<ul>
<li>2 graphiques en barres (un pour le Qu√©bec et un pour la MRC de Montr√©al)</li>
<li>un r√©sum√© (pourquoi pas en HTML !) de la surface de chaque type d‚Äôoccupation du sol, comme celui pr√©sent√© en exemple ci-dessous</li>
</ul></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./fig/summary-lc.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Exemple de tableau de r√©sum√©</figcaption><p></p>
</figure>
</div>
<ul>
<li>Au d√©but de votre document, vous devez ins√©rer un chunk de code <code>R</code> pour pr√©ciser la localisation de votre environnement virtuel Python - comme nous utilisons <code>knitr</code>, c‚Äôest ce qui va permettre √† <code>reticulate</code> de savoir o√π chercher les packages Python qui ont √©t√© install√©s pour cet atelier :</li>
</ul>
<div class="sourceCode" id="cb70"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reticulate)</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="fu">use_virtualenv</span>(<span class="st">"~/env-quarto"</span>)</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong><em>Besoin d‚Äôaide ?</em></strong></p>
<div class="callout-tip callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Quelle suite d‚Äôaction r√©aliser ?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li>Cr√©er un chunk ‚Äòr‚Äô pour dfinir la localisation de l‚Äôenvironnement virtuel</li>
<li>Cr√©er les chunks ‚Äòpython‚Äô correspondants aux actions suivantes :
<ul>
<li>Ouvrir le jeu de donn√©es raster</li>
<li>Ouvrir le jeu de donn√©es vecteur</li>
<li>S‚Äôassurer qu‚Äôils sont dans le m√™me syst√®me de coordonn√©es de r√©f√©rence et effectuer la transformation si ce n‚Äôest pas le cas</li>
<li>Obtenir les statistiques zonales pour l‚Äôensemble de la province du Qu√©bec</li>
<li>Obtenir les statistiques zonales pour la MRC de Montr√©al</li>
<li>Produire les deux graphiques et un tableau synth√©tisant ces informations</li>
</ul></li>
</ul>
</div>
</div>
</div>
<div class="callout-tip callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
De quelles biblioth√®ques a-t-on besoin ?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rioxarray</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xarray</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterstats</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="callout-tip callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Besoin d‚Äôaide pour ouvrir les donn√©es raster ?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>xds <span class="op">=</span> xarray.open_dataarray(<span class="st">"/chemin/vers/le/fichier"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="callout-tip callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Besoin d‚Äôaide pour ouvrir les donn√©es vecteur ?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>gdf <span class="op">=</span> gpd.read_file(<span class="st">'/chemin/vers/le/fichier'</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="callout-tip callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Comment connaitre la taille d‚Äôune cellule raster ?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>En utilisant les param√®tres d√©crivant la matrice de transformation de g√©or√©f√©rencement du jeu de donn√©es raster en question (cette transformation fait correspondre les coordonn√©es ligne/colonne des pixels aux coordonn√©es du syst√®me de r√©f√©rence de l‚Äôensemble de donn√©es) :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>transform <span class="op">=</span> xds.rio.transform()</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Puis en utilisant la premi√®re et la cinqui√®me valeur qui repr√©sentent respectivement la largeur et la hauteur du pixel :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>area_pixel <span class="op">=</span> transform[<span class="dv">0</span>] <span class="op">*</span> <span class="bu">abs</span>(transform[<span class="dv">4</span>]) <span class="co"># la hauteur est g√©n√©ralement n√©gative</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="callout-tip callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Comment faire pour qu‚Äôun <em>chunk</em> retourne du HTML ?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Par exemple en stockant du Markdown dans une cha√Æne de caract√®re et en le transformant en HTML avec <code>IPython.display.Markdown</code> :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> Markdown</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>rendu <span class="op">=</span> <span class="st">'''</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="st">## R√©sum√©</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a><span class="st">| Cat√©gorie | Superficie |</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a><span class="st">|---------|----------|</span></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a><span class="st">| Aahah | 21.34 |</span></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a><span class="st">'''</span></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>Markdown(rendu)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<!-- -->


</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">Les r√©f√©rences</h2><div id="refs" class="references csl-bib-body hanging-indent" data-line-spacing="2" role="doc-bibliography">
<div id="ref-Dorman2022" class="csl-entry" role="doc-biblioentry">
Dorman, M., Graser, A., Nowosad, J. et Lovelace, R. (2022). <em>Geocomputation with <span>Python</span></em>. CRC Press. <a href="https://py.geocompx.org/">https://py.geocompx.org/</a>
</div>
<div id="ref-GDAL" class="csl-entry" role="doc-biblioentry">
GDAL/OGR contributors. (2022). <em><span>GDAL/OGR</span> Geospatial Data Abstraction software Library</em>. Open Source Geospatial Foundation. <a href="https://doi.org/10.5281/zenodo.5884351">https://doi.org/10.5281/zenodo.5884351</a>
</div>
<div id="ref-GEOS" class="csl-entry" role="doc-biblioentry">
GEOS contributors. (2021). <em><span>GEOS</span> coordinate transformation software library</em>. Open Source Geospatial Foundation. <a href="https://libgeos.org/">https://libgeos.org/</a>
</div>
<div id="ref-gillies_2019" class="csl-entry" role="doc-biblioentry">
Gillies, S. <em>et al.</em> (2013). <em>Rasterio: geospatial raster I/O for <span>Python</span> programmers</em>. Mapbox. <a href="https://github.com/rasterio/rasterio">https://github.com/rasterio/rasterio</a>
</div>
<div id="ref-fiona" class="csl-entry" role="doc-biblioentry">
Gillies, S., Buffat, R., Arnott, J., Taves, M. W., Wurster, K., Snow, A. D., Cochran, M., Sales de Andrade, E. et Perry, M. (2023, janvier). Fiona. <a href="https://github.com/Toblerity/Fiona">https://github.com/Toblerity/Fiona</a>
</div>
<div id="ref-sgillies_2023" class="csl-entry" role="doc-biblioentry">
Gillies, S., Wel, C. van der, Van den Bossche, J., Taves, M. W., Arnott, J., Ward, B. C., <em>et al.</em> (2023, janvier). Shapely. <a href="https://doi.org/10.5281/zenodo.5597138">https://doi.org/10.5281/zenodo.5597138</a>
</div>
<div id="ref-xarray" class="csl-entry" role="doc-biblioentry">
Hoyer, S., Roos, M., Joseph, H., Magin, J., Cherian, D., Fitzgerald, C., Hauser, M., Fujii, K., Maussion, F., Imperiale, G., Clark, S., Kleeman, A., Nicholas, T., Kluyver, T., Westling, J., Munroe, J., Amici, A., Barghini, A., Banihirwe, A., Bell, R., <em>et al.</em>Wolfram, P. J. (s. d.). xarray. <a href="https://doi.org/10.5281/zenodo.598201">https://doi.org/10.5281/zenodo.598201</a>
</div>
<div id="ref-kelsey_jordahl_2020_3946761" class="csl-entry" role="doc-biblioentry">
Jordahl, K., Bossche, J. V. den, Fleischmann, M., Wasserman, J., McBride, J., Gerard, J., Tratner, J., Perry, M., Badaracco, A. G., Farmer, C., Hjelle, G. A., Snow, A. D., Cochran, M., Gillies, S., Culbertson, L., Bartos, M., Eubank, N., maxalbert, Bilogur, A., Rey, S., <em>et al.</em>Leblanc, F. (2020). <em>geopandas/geopandas: v0.8.1</em> (version v0.8.1). Zenodo. <a href="https://doi.org/10.5281/zenodo.3946761">https://doi.org/10.5281/zenodo.3946761</a>
</div>
<div id="ref-PROJ" class="csl-entry" role="doc-biblioentry">
PROJ contributors. (2021). <em><span>PROJ</span> coordinate transformation software library</em>. Open Source Geospatial Foundation. <a href="https://proj.org/">https://proj.org/</a>
</div>
<div id="ref-pysal2007" class="csl-entry" role="doc-biblioentry">
Rey, S. J. et Anselin, L. (2007). <span>PySAL: A Python Library of Spatial Analytical Methods</span>. <em>The Review of Regional Studies</em>, <em>37</em>(1), 5‚Äë27.
</div>
<div id="ref-rioxarray" class="csl-entry" role="doc-biblioentry">
Snow, A. D., Brochart, D., Raspaud, M., Taves, M., Bell, R., RichardScottOZ, Chegini, T., stefank0, Amici, A., Braun, R. et al., et. (2023). corteva/rioxarray: 0.14.1 Release. <a href="https://doi.org/10.5281/zenodo.7829704">https://doi.org/10.5281/zenodo.7829704</a>
</div>
<div id="ref-pyproj" class="csl-entry" role="doc-biblioentry">
Snow, A. D., Whitaker, J., Cochran, M., Miara, I., Bossche, J. V. den, Mayo, C., Cochrane, P., Lucas, G., Kloe, J. de, Karney, C. et al., et. (2023). pyproj4/pyproj: 3.5.0 Release. <a href="https://doi.org/10.5281/zenodo.7776548">https://doi.org/10.5281/zenodo.7776548</a>
</div>
<div id="ref-pandas" class="csl-entry" role="doc-biblioentry">
The pandas development team. (s. d.). pandas-dev/pandas: Pandas. <a href="https://github.com/pandas-dev/pandas">https://github.com/pandas-dev/pandas</a>
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copi√©");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copi√©");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Code source</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb77" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Articulation de diff√©rents langages (R, JavaScript et Python) pour la g√©ovisualisation avec Quarto"</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Atelier Sageo, Qu√©bec, Juin 2023"</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Timoth√©e Giraud, Nicolas Lambert, Matthieu Viry, Ronan Ysebaert (UAR RIATE, CNRS, Universit√© Paris Cit√©)"</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: sandstone</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a><span class="co">    fontsize: 0.9em</span></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 2</span></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a><span class="co">    linkcolor: "#8631ad"</span></span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span><span class="co"> </span></span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a><span class="co">  cache: false</span></span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a><span class="an">editor_options:</span><span class="co"> </span></span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a><span class="co">  chunk_output_type: console</span></span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a><span class="an">bibliography:</span><span class="co"> references.bib</span></span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a><span class="an">csl:</span><span class="co"> "universite-de-montreal-apa.csl"</span></span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a><span class="an">lang:</span><span class="co"> fr</span></span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb77-22"><a href="#cb77-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-23"><a href="#cb77-23" aria-hidden="true" tabindex="-1"></a><span class="in">```{r reticulate-env}</span></span>
<span id="cb77-24"><a href="#cb77-24" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb77-25"><a href="#cb77-25" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reticulate)</span>
<span id="cb77-26"><a href="#cb77-26" aria-hidden="true" tabindex="-1"></a><span class="fu">use_virtualenv</span>(<span class="st">"~/env-quarto"</span>)</span>
<span id="cb77-27"><a href="#cb77-27" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-28"><a href="#cb77-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-29"><a href="#cb77-29" aria-hidden="true" tabindex="-1"></a><span class="in">```{python pandas-column-width-setup}</span></span>
<span id="cb77-30"><a href="#cb77-30" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb77-31"><a href="#cb77-31" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb77-32"><a href="#cb77-32" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.max_rows'</span>, <span class="dv">500</span>)</span>
<span id="cb77-33"><a href="#cb77-33" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.max_columns'</span>, <span class="dv">500</span>)</span>
<span id="cb77-34"><a href="#cb77-34" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.width'</span>, <span class="dv">1000</span>)</span>
<span id="cb77-35"><a href="#cb77-35" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-36"><a href="#cb77-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-37"><a href="#cb77-37" aria-hidden="true" tabindex="-1"></a><span class="fu"># Python</span></span>
<span id="cb77-38"><a href="#cb77-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-39"><a href="#cb77-39" aria-hidden="true" tabindex="-1"></a><span class="fu">## Le langage Python</span></span>
<span id="cb77-40"><a href="#cb77-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-41"><a href="#cb77-41" aria-hidden="true" tabindex="-1"></a>:::: columns</span>
<span id="cb77-42"><a href="#cb77-42" aria-hidden="true" tabindex="-1"></a>::: {.column width="70%"}</span>
<span id="cb77-43"><a href="#cb77-43" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Python** : un langage *polyvalent*, *interpr√©t√©* et *multi-paradigme*</span>
<span id="cb77-44"><a href="#cb77-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-45"><a href="#cb77-45" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>De plus en plus utilis√© pour la *science des donn√©es*</span>
<span id="cb77-46"><a href="#cb77-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-47"><a href="#cb77-47" aria-hidden="true" tabindex="-1"></a>:::{.fragment}</span>
<span id="cb77-48"><a href="#cb77-48" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Un √©cosyst√®me robuste pour diff√©rents domaines d'application scientifiques</span>
<span id="cb77-49"><a href="#cb77-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-50"><a href="#cb77-50" aria-hidden="true" tabindex="-1"></a><span class="al">![](./fig/python-stack.png)</span></span>
<span id="cb77-51"><a href="#cb77-51" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb77-52"><a href="#cb77-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-53"><a href="#cb77-53" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb77-54"><a href="#cb77-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-55"><a href="#cb77-55" aria-hidden="true" tabindex="-1"></a>::: {.column width="30%"}</span>
<span id="cb77-56"><a href="#cb77-56" aria-hidden="true" tabindex="-1"></a><span class="al">![](./fig/logo-python.png)</span></span>
<span id="cb77-57"><a href="#cb77-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-58"><a href="#cb77-58" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb77-59"><a href="#cb77-59" aria-hidden="true" tabindex="-1"></a>::::</span>
<span id="cb77-60"><a href="#cb77-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-61"><a href="#cb77-61" aria-hidden="true" tabindex="-1"></a><span class="fu">## √âcosyst√®me pour le g√©ospatial</span></span>
<span id="cb77-62"><a href="#cb77-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-63"><a href="#cb77-63" aria-hidden="true" tabindex="-1"></a><span class="fu">## Donn√©es vectorielles</span></span>
<span id="cb77-64"><a href="#cb77-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-65"><a href="#cb77-65" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">**Bindings Python de GDAL/OGR**</span><span class="co">](https://gdal.org/api/python_bindings.html)</span> <span class="co">[</span><span class="ot">@GDAL</span><span class="co">]</span></span>
<span id="cb77-66"><a href="#cb77-66" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">**Fiona**</span><span class="co">](https://fiona.readthedocs.io/en/stable/)</span> <span class="co">[</span><span class="ot">@fiona</span><span class="co">]</span> - I/O (*wrapper* de haut niveau autour d'OGR)</span>
<span id="cb77-67"><a href="#cb77-67" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">**Shapely**</span><span class="co">](https://shapely.readthedocs.io/)</span>  <span class="co">[</span><span class="ot">@sgillies_2023</span><span class="co">]</span> - bindings Python de <span class="co">[</span><span class="ot">GEOS</span><span class="co">](https://github.com/libgeos/geos)</span> <span class="co">[</span><span class="ot">@GEOS</span><span class="co">]</span></span>
<span id="cb77-68"><a href="#cb77-68" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">**Pyproj**</span><span class="co">](https://pyproj4.github.io/pyproj)</span> <span class="co">[</span><span class="ot">@pyproj</span><span class="co">]</span> - bindings Python de <span class="co">[</span><span class="ot">PROJ</span><span class="co">](https://proj.org/)</span> <span class="co">[</span><span class="ot">@PROJ</span><span class="co">]</span></span>
<span id="cb77-69"><a href="#cb77-69" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">**Geopandas**</span><span class="co">](https://geopandas.org/)</span>  <span class="co">[</span><span class="ot">@kelsey_jordahl_2020_3946761</span><span class="co">]</span> - √âtend les <span class="in">`DataFrame`</span>s de <span class="co">[</span><span class="ot">pandas</span><span class="co">](https://pandas.pydata.org/)</span> <span class="co">[</span><span class="ot">@pandas</span><span class="co">]</span></span>
<span id="cb77-70"><a href="#cb77-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-71"><a href="#cb77-71" aria-hidden="true" tabindex="-1"></a><span class="al">![](./fig/logo-pandas.svg)</span></span>
<span id="cb77-72"><a href="#cb77-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-73"><a href="#cb77-73" aria-hidden="true" tabindex="-1"></a><span class="al">![](./fig/logo_geopandas.svg)</span></span>
<span id="cb77-74"><a href="#cb77-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-75"><a href="#cb77-75" aria-hidden="true" tabindex="-1"></a><span class="fu">## Le package *GeoPandas*</span></span>
<span id="cb77-76"><a href="#cb77-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-77"><a href="#cb77-77" aria-hidden="true" tabindex="-1"></a>Un projet open source pour faciliter le travail avec des donn√©es g√©ospatiales vectorielles en Python. GeoPandas √©tend Pandas pour permettre de disposer d'un type de colonne g√©om√©trique et pour permettre d'effectuer des op√©rations spatiales. Les op√©rations g√©om√©triques sont r√©alis√©es avec <span class="in">`shapely`</span>, les acc√®s en lecture / √©criture aux fichiers utilisent <span class="in">`fiona`</span> et la visualisation utilise <span class="in">`matplotlib`</span>.</span>
<span id="cb77-78"><a href="#cb77-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-79"><a href="#cb77-79" aria-hidden="true" tabindex="-1"></a><span class="al">![Format des GeoDataFrame](./fig/geopandas-table.png)</span></span>
<span id="cb77-80"><a href="#cb77-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-81"><a href="#cb77-81" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Utilisation :</span>
<span id="cb77-82"><a href="#cb77-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-83"><a href="#cb77-83" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset .custom-tab}</span>
<span id="cb77-84"><a href="#cb77-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-85"><a href="#cb77-85" aria-hidden="true" tabindex="-1"></a><span class="fu">### Import et lecture</span></span>
<span id="cb77-86"><a href="#cb77-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-87"><a href="#cb77-87" aria-hidden="true" tabindex="-1"></a><span class="in">```{python gpd-tuto-import-1}</span></span>
<span id="cb77-88"><a href="#cb77-88" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb77-89"><a href="#cb77-89" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geodatasets</span>
<span id="cb77-90"><a href="#cb77-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-91"><a href="#cb77-91" aria-hidden="true" tabindex="-1"></a>file_path <span class="op">=</span> geodatasets.get_path(<span class="st">"nybb"</span>)</span>
<span id="cb77-92"><a href="#cb77-92" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-93"><a href="#cb77-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-94"><a href="#cb77-94" aria-hidden="true" tabindex="-1"></a>Avec la fonction <span class="in">`read_file`</span> :</span>
<span id="cb77-95"><a href="#cb77-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-96"><a href="#cb77-96" aria-hidden="true" tabindex="-1"></a><span class="in">```{python gpd-tuto-import-2}</span></span>
<span id="cb77-97"><a href="#cb77-97" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb77-98"><a href="#cb77-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-99"><a href="#cb77-99" aria-hidden="true" tabindex="-1"></a>nybb <span class="op">=</span> gpd.read_file(file_path)</span>
<span id="cb77-100"><a href="#cb77-100" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-101"><a href="#cb77-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-102"><a href="#cb77-102" aria-hidden="true" tabindex="-1"></a><span class="fu">### Affichage</span></span>
<span id="cb77-103"><a href="#cb77-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-104"><a href="#cb77-104" aria-hidden="true" tabindex="-1"></a>Avec la m√©thode <span class="in">`plot`</span> des <span class="in">`GeoDataFrame`</span> :</span>
<span id="cb77-105"><a href="#cb77-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-106"><a href="#cb77-106" aria-hidden="true" tabindex="-1"></a><span class="in">```{python gpd-tuto-plot}</span></span>
<span id="cb77-107"><a href="#cb77-107" aria-hidden="true" tabindex="-1"></a>nybb.plot()</span>
<span id="cb77-108"><a href="#cb77-108" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-109"><a href="#cb77-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-110"><a href="#cb77-110" aria-hidden="true" tabindex="-1"></a><span class="fu">### SCR</span></span>
<span id="cb77-111"><a href="#cb77-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-112"><a href="#cb77-112" aria-hidden="true" tabindex="-1"></a>Affichage :</span>
<span id="cb77-113"><a href="#cb77-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-114"><a href="#cb77-114" aria-hidden="true" tabindex="-1"></a><span class="in">```{python gpd-tuto-crs}</span></span>
<span id="cb77-115"><a href="#cb77-115" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(nybb.crs)</span>
<span id="cb77-116"><a href="#cb77-116" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-117"><a href="#cb77-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-118"><a href="#cb77-118" aria-hidden="true" tabindex="-1"></a>Transformation :</span>
<span id="cb77-119"><a href="#cb77-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-120"><a href="#cb77-120" aria-hidden="true" tabindex="-1"></a><span class="in">```{python gpd-tuto-transformation}</span></span>
<span id="cb77-121"><a href="#cb77-121" aria-hidden="true" tabindex="-1"></a>nybb_geo <span class="op">=</span> nybb.to_crs(<span class="st">'EPSG:4326'</span>)</span>
<span id="cb77-122"><a href="#cb77-122" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-123"><a href="#cb77-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-124"><a href="#cb77-124" aria-hidden="true" tabindex="-1"></a><span class="fu">### Affichage avec fond de carte</span></span>
<span id="cb77-125"><a href="#cb77-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-126"><a href="#cb77-126" aria-hidden="true" tabindex="-1"></a>En utilisant la biblioth√®que <span class="in">`contextily`</span> :</span>
<span id="cb77-127"><a href="#cb77-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-128"><a href="#cb77-128" aria-hidden="true" tabindex="-1"></a><span class="in">```{python gpd-tuto-contextily}</span></span>
<span id="cb77-129"><a href="#cb77-129" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> contextily <span class="im">as</span> cx</span>
<span id="cb77-130"><a href="#cb77-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-131"><a href="#cb77-131" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> nybb.to_crs(<span class="st">'EPSG:3857'</span>).plot()</span>
<span id="cb77-132"><a href="#cb77-132" aria-hidden="true" tabindex="-1"></a>cx.add_basemap(ax, source<span class="op">=</span><span class="st">'https://</span><span class="sc">{s}</span><span class="st">.tile.openstreetmap.fr/osmfr/</span><span class="sc">{z}</span><span class="st">/</span><span class="sc">{x}</span><span class="st">/</span><span class="sc">{y}</span><span class="st">.png'</span>)</span>
<span id="cb77-133"><a href="#cb77-133" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb77-134"><a href="#cb77-134" aria-hidden="true" tabindex="-1"></a>ax</span>
<span id="cb77-135"><a href="#cb77-135" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-136"><a href="#cb77-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-137"><a href="#cb77-137" aria-hidden="true" tabindex="-1"></a><span class="fu">### Centroide</span></span>
<span id="cb77-138"><a href="#cb77-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-139"><a href="#cb77-139" aria-hidden="true" tabindex="-1"></a>Simplement en utilisant l'attribut <span class="in">`centroid`</span> des <span class="in">`GeoDataFrame`</span> :</span>
<span id="cb77-140"><a href="#cb77-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-141"><a href="#cb77-141" aria-hidden="true" tabindex="-1"></a><span class="in">```{python gpd-tuto-centroid}</span></span>
<span id="cb77-142"><a href="#cb77-142" aria-hidden="true" tabindex="-1"></a>nybb.centroid.plot()</span>
<span id="cb77-143"><a href="#cb77-143" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-144"><a href="#cb77-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-145"><a href="#cb77-145" aria-hidden="true" tabindex="-1"></a><span class="fu">### Boundary</span></span>
<span id="cb77-146"><a href="#cb77-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-147"><a href="#cb77-147" aria-hidden="true" tabindex="-1"></a>Simplement en utilisant l'attribut <span class="in">`boundary`</span> des <span class="in">`GeoDataFrame`</span> :</span>
<span id="cb77-148"><a href="#cb77-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-149"><a href="#cb77-149" aria-hidden="true" tabindex="-1"></a><span class="in">```{python gpd-tuto-boundary}</span></span>
<span id="cb77-150"><a href="#cb77-150" aria-hidden="true" tabindex="-1"></a>nybb.boundary.plot()</span>
<span id="cb77-151"><a href="#cb77-151" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-152"><a href="#cb77-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-153"><a href="#cb77-153" aria-hidden="true" tabindex="-1"></a><span class="fu">### Zone tampon</span></span>
<span id="cb77-154"><a href="#cb77-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-155"><a href="#cb77-155" aria-hidden="true" tabindex="-1"></a>En utilisant la m√©thode <span class="in">`buffer`</span> des <span class="in">`GeoDataFrame`</span> :</span>
<span id="cb77-156"><a href="#cb77-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-157"><a href="#cb77-157" aria-hidden="true" tabindex="-1"></a><span class="in">```{python gpd-tuto-buffer}</span></span>
<span id="cb77-158"><a href="#cb77-158" aria-hidden="true" tabindex="-1"></a>buff_nybb <span class="op">=</span> nybb.<span class="bu">buffer</span>(<span class="dv">3000</span>)</span>
<span id="cb77-159"><a href="#cb77-159" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-160"><a href="#cb77-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-161"><a href="#cb77-161" aria-hidden="true" tabindex="-1"></a><span class="in">```{python gpd-tuto-buffer-2}</span></span>
<span id="cb77-162"><a href="#cb77-162" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> buff_nybb.plot(color<span class="op">=</span><span class="st">"red"</span>)</span>
<span id="cb77-163"><a href="#cb77-163" aria-hidden="true" tabindex="-1"></a>nybb.plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">"aliceblue"</span>)</span>
<span id="cb77-164"><a href="#cb77-164" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-165"><a href="#cb77-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-166"><a href="#cb77-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-167"><a href="#cb77-167" aria-hidden="true" tabindex="-1"></a><span class="fu">### Aggr√©gation</span></span>
<span id="cb77-168"><a href="#cb77-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-169"><a href="#cb77-169" aria-hidden="true" tabindex="-1"></a>En utilisant la m√©thode <span class="in">`dissolve`</span> des <span class="in">`GeoDataFrame`</span> :</span>
<span id="cb77-170"><a href="#cb77-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-171"><a href="#cb77-171" aria-hidden="true" tabindex="-1"></a><span class="in">```{python gpd-tuto-agg}</span></span>
<span id="cb77-172"><a href="#cb77-172" aria-hidden="true" tabindex="-1"></a><span class="co"># On peut utiliser dissolve(by="nom_colonne") si on veut aggr√©ger selon les valeurs d'une colonne</span></span>
<span id="cb77-173"><a href="#cb77-173" aria-hidden="true" tabindex="-1"></a>agg <span class="op">=</span> nybb.dissolve()</span>
<span id="cb77-174"><a href="#cb77-174" aria-hidden="true" tabindex="-1"></a>agg.plot()</span>
<span id="cb77-175"><a href="#cb77-175" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-176"><a href="#cb77-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-177"><a href="#cb77-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-178"><a href="#cb77-178" aria-hidden="true" tabindex="-1"></a><span class="fu">### Intersection</span></span>
<span id="cb77-179"><a href="#cb77-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-180"><a href="#cb77-180" aria-hidden="true" tabindex="-1"></a>En utilisant la m√©thode <span class="in">`intersection`</span> des <span class="in">`GeoDataFrame`</span> :</span>
<span id="cb77-181"><a href="#cb77-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-182"><a href="#cb77-182" aria-hidden="true" tabindex="-1"></a><span class="in">```{python gpd-tuto-intersection}</span></span>
<span id="cb77-183"><a href="#cb77-183" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely <span class="im">import</span> wkt</span>
<span id="cb77-184"><a href="#cb77-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-185"><a href="#cb77-185" aria-hidden="true" tabindex="-1"></a>point <span class="op">=</span> wkt.loads(<span class="st">'Point(998769.1146889535 174169.7607268664)'</span>)</span>
<span id="cb77-186"><a href="#cb77-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-187"><a href="#cb77-187" aria-hidden="true" tabindex="-1"></a>intersecting <span class="op">=</span> nybb.intersection(point.<span class="bu">buffer</span>(<span class="dv">35000</span>))</span>
<span id="cb77-188"><a href="#cb77-188" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-189"><a href="#cb77-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-190"><a href="#cb77-190" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb77-191"><a href="#cb77-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-192"><a href="#cb77-192" aria-hidden="true" tabindex="-1"></a><span class="in">```{python gpd-tuto-intersectiob-2}</span></span>
<span id="cb77-193"><a href="#cb77-193" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> nybb.plot()</span>
<span id="cb77-194"><a href="#cb77-194" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> intersecting.plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">"red"</span>)</span>
<span id="cb77-195"><a href="#cb77-195" aria-hidden="true" tabindex="-1"></a>ax</span>
<span id="cb77-196"><a href="#cb77-196" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-197"><a href="#cb77-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-198"><a href="#cb77-198" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb77-199"><a href="#cb77-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-200"><a href="#cb77-200" aria-hidden="true" tabindex="-1"></a><span class="fu">## Donn√©es raster</span></span>
<span id="cb77-201"><a href="#cb77-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-202"><a href="#cb77-202" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">**Rasterio**</span><span class="co">](https://rasterio.readthedocs.io/)</span> <span class="co">[</span><span class="ot">@gillies_2019</span><span class="co">]</span> :</span>
<span id="cb77-203"><a href="#cb77-203" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>lecture / √©criture de raster (*wrapper* de haut niveau autour de GDAL)</span>
<span id="cb77-204"><a href="#cb77-204" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>donn√©es repr√©sent√©es sous forme d'<span class="in">`array`</span> NumPy</span>
<span id="cb77-205"><a href="#cb77-205" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>reprojection</span>
<span id="cb77-206"><a href="#cb77-206" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>_resampling_</span>
<span id="cb77-207"><a href="#cb77-207" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>_virtual files_</span>
<span id="cb77-208"><a href="#cb77-208" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>etc.</span>
<span id="cb77-209"><a href="#cb77-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-210"><a href="#cb77-210" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">**Rasterstats**</span><span class="co">](https://pythonhosted.org/rasterstats/)</span> :</span>
<span id="cb77-211"><a href="#cb77-211" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>r√©sumer des donn√©es raster sur la base de g√©om√©tries vectorielles</span>
<span id="cb77-212"><a href="#cb77-212" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>extraction de valeurs √† un point pr√©cis</span>
<span id="cb77-213"><a href="#cb77-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-214"><a href="#cb77-214" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">**xarray**</span><span class="co">](https://docs.xarray.dev/en/stable/)</span> <span class="co">[</span><span class="ot">@xarray</span><span class="co">]</span> et <span class="co">[</span><span class="ot">**rioxarray**</span><span class="co">](https://corteva.github.io/rioxarray/)</span> <span class="co">[</span><span class="ot">@rioxarray</span><span class="co">]</span>:</span>
<span id="cb77-215"><a href="#cb77-215" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>*xarray* pour travailler avec des tableaux multidimensionnels √©tiquet√©s</span>
<span id="cb77-216"><a href="#cb77-216" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>*rioxarray* pour ouvrir des jeux des donn√©es raster avec *rasterio*, les stocker dans le format de *xarray*, et avoir acc√®s √† diff√©rentes fonctionnalit√©s de *rasterio*</span>
<span id="cb77-217"><a href="#cb77-217" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>moins "rustique" que d'utiliser rasterio seul / d√©pend de l'usage souhait√©</span>
<span id="cb77-218"><a href="#cb77-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-219"><a href="#cb77-219" aria-hidden="true" tabindex="-1"></a><span class="fu">## Le package *Rasterio*</span></span>
<span id="cb77-220"><a href="#cb77-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-221"><a href="#cb77-221" aria-hidden="true" tabindex="-1"></a>Exemple d'utilisation :</span>
<span id="cb77-222"><a href="#cb77-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-223"><a href="#cb77-223" aria-hidden="true" tabindex="-1"></a><span class="in">```{python example-rio-1}</span></span>
<span id="cb77-224"><a href="#cb77-224" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterio <span class="im">as</span> rio</span>
<span id="cb77-225"><a href="#cb77-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-226"><a href="#cb77-226" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rio.<span class="bu">open</span>(<span class="st">'data/MODIS_ARRAY.nc'</span>) <span class="im">as</span> f:</span>
<span id="cb77-227"><a href="#cb77-227" aria-hidden="true" tabindex="-1"></a>    <span class="co"># M√©tadonn√©es :</span></span>
<span id="cb77-228"><a href="#cb77-228" aria-hidden="true" tabindex="-1"></a>    metadata <span class="op">=</span> f.meta</span>
<span id="cb77-229"><a href="#cb77-229" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Lire toutes les bandes :</span></span>
<span id="cb77-230"><a href="#cb77-230" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> f.read()</span>
<span id="cb77-231"><a href="#cb77-231" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ou f.read(1) pour lire seulement la premi√®re bande</span></span>
<span id="cb77-232"><a href="#cb77-232" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-233"><a href="#cb77-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-234"><a href="#cb77-234" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Un dictionnaire de m√©ta-donn√©es + un tableau NumPy contenant la (ou les) bande(s) :</span>
<span id="cb77-235"><a href="#cb77-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-236"><a href="#cb77-236" aria-hidden="true" tabindex="-1"></a><span class="in">```{python example-rio-2}</span></span>
<span id="cb77-237"><a href="#cb77-237" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(metadata)</span>
<span id="cb77-238"><a href="#cb77-238" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(data)</span>
<span id="cb77-239"><a href="#cb77-239" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-240"><a href="#cb77-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-241"><a href="#cb77-241" aria-hidden="true" tabindex="-1"></a><span class="fu">## Les package *xarray* et *rioxarray*</span></span>
<span id="cb77-242"><a href="#cb77-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-243"><a href="#cb77-243" aria-hidden="true" tabindex="-1"></a>Exemple d'utilisation :</span>
<span id="cb77-244"><a href="#cb77-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-245"><a href="#cb77-245" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset .custom-tab}</span>
<span id="cb77-246"><a href="#cb77-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-247"><a href="#cb77-247" aria-hidden="true" tabindex="-1"></a><span class="fu">### Import et lecture</span></span>
<span id="cb77-248"><a href="#cb77-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-249"><a href="#cb77-249" aria-hidden="true" tabindex="-1"></a><span class="in">```{python xarray-tuto-import-1}</span></span>
<span id="cb77-250"><a href="#cb77-250" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rioxarray</span>
<span id="cb77-251"><a href="#cb77-251" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xarray</span>
<span id="cb77-252"><a href="#cb77-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-253"><a href="#cb77-253" aria-hidden="true" tabindex="-1"></a>xds <span class="op">=</span> xarray.open_dataarray(<span class="st">"./data/MODIS_ARRAY.nc"</span>)</span>
<span id="cb77-254"><a href="#cb77-254" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-255"><a href="#cb77-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-256"><a href="#cb77-256" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Un objet de type <span class="in">`xarray.DataArray`</span> ou <span class="in">`xarray.Dataset`</span> qui contient les diff√©rentes m√©ta-donn√©es et les donn√©es :</span>
<span id="cb77-257"><a href="#cb77-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-258"><a href="#cb77-258" aria-hidden="true" tabindex="-1"></a><span class="in">```{python xarray-tuto-import-2}</span></span>
<span id="cb77-259"><a href="#cb77-259" aria-hidden="true" tabindex="-1"></a>xds</span>
<span id="cb77-260"><a href="#cb77-260" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-261"><a href="#cb77-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-262"><a href="#cb77-262" aria-hidden="true" tabindex="-1"></a><span class="fu">### Compl√©tion des valeurs manquantes</span></span>
<span id="cb77-263"><a href="#cb77-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-264"><a href="#cb77-264" aria-hidden="true" tabindex="-1"></a><span class="in">```{python xarray-tuto-na}</span></span>
<span id="cb77-265"><a href="#cb77-265" aria-hidden="true" tabindex="-1"></a>filled <span class="op">=</span> xds.rio.interpolate_na()</span>
<span id="cb77-266"><a href="#cb77-266" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-267"><a href="#cb77-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-268"><a href="#cb77-268" aria-hidden="true" tabindex="-1"></a><span class="fu">### Affichage</span></span>
<span id="cb77-269"><a href="#cb77-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-270"><a href="#cb77-270" aria-hidden="true" tabindex="-1"></a>En utilisant la m√©thode <span class="in">`plot`</span> des objets <span class="in">`xarray.DataArray`</span> (ici apr√®s avoir s√©lections un *subset* des donn√©es) :</span>
<span id="cb77-271"><a href="#cb77-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-272"><a href="#cb77-272" aria-hidden="true" tabindex="-1"></a><span class="in">```{python xarray-tuto-plot}</span></span>
<span id="cb77-273"><a href="#cb77-273" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb77-274"><a href="#cb77-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-275"><a href="#cb77-275" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">5</span>))</span>
<span id="cb77-276"><a href="#cb77-276" aria-hidden="true" tabindex="-1"></a>ax1, ax2 <span class="op">=</span> (fig.add_subplot(<span class="dv">131</span>), fig.add_subplot(<span class="dv">133</span>))</span>
<span id="cb77-277"><a href="#cb77-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-278"><a href="#cb77-278" aria-hidden="true" tabindex="-1"></a>xds.isel(x<span class="op">=</span><span class="bu">slice</span>(<span class="dv">0</span>, <span class="dv">20</span>), y<span class="op">=</span><span class="bu">slice</span>(<span class="dv">0</span>, <span class="dv">20</span>)).plot(ax<span class="op">=</span>ax1)</span>
<span id="cb77-279"><a href="#cb77-279" aria-hidden="true" tabindex="-1"></a>filled.isel(x<span class="op">=</span><span class="bu">slice</span>(<span class="dv">0</span>, <span class="dv">20</span>), y<span class="op">=</span><span class="bu">slice</span>(<span class="dv">0</span>, <span class="dv">20</span>)).plot(ax<span class="op">=</span>ax2)</span>
<span id="cb77-280"><a href="#cb77-280" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-281"><a href="#cb77-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-282"><a href="#cb77-282" aria-hidden="true" tabindex="-1"></a><span class="fu">### SCR</span></span>
<span id="cb77-283"><a href="#cb77-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-284"><a href="#cb77-284" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Affichage :</span>
<span id="cb77-285"><a href="#cb77-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-286"><a href="#cb77-286" aria-hidden="true" tabindex="-1"></a><span class="in">```{python xarray-tuto-crs-1}</span></span>
<span id="cb77-287"><a href="#cb77-287" aria-hidden="true" tabindex="-1"></a>xds.rio.crs</span>
<span id="cb77-288"><a href="#cb77-288" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-289"><a href="#cb77-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-290"><a href="#cb77-290" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Transformation :</span>
<span id="cb77-291"><a href="#cb77-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-292"><a href="#cb77-292" aria-hidden="true" tabindex="-1"></a><span class="in">```{python xarray-tuto-crs-2}</span></span>
<span id="cb77-293"><a href="#cb77-293" aria-hidden="true" tabindex="-1"></a>xds <span class="op">=</span> xds.rio.reproject(<span class="st">"EPSG:6623"</span>)</span>
<span id="cb77-294"><a href="#cb77-294" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-295"><a href="#cb77-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-296"><a href="#cb77-296" aria-hidden="true" tabindex="-1"></a><span class="fu">### D√©coupage</span></span>
<span id="cb77-297"><a href="#cb77-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-298"><a href="#cb77-298" aria-hidden="true" tabindex="-1"></a><span class="in">```{python xarray-tuto-clipping}</span></span>
<span id="cb77-299"><a href="#cb77-299" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb77-300"><a href="#cb77-300" aria-hidden="true" tabindex="-1"></a>clipped <span class="op">=</span> xds.rio.clip(gdf.geometry.values, gdf.crs, drop<span class="op">=</span><span class="va">False</span>, invert<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb77-301"><a href="#cb77-301" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-302"><a href="#cb77-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-303"><a href="#cb77-303" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb77-304"><a href="#cb77-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-305"><a href="#cb77-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-306"><a href="#cb77-306" aria-hidden="true" tabindex="-1"></a><span class="fu">## Analyse spatiale</span></span>
<span id="cb77-307"><a href="#cb77-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-308"><a href="#cb77-308" aria-hidden="true" tabindex="-1"></a>:::: {.columns}</span>
<span id="cb77-309"><a href="#cb77-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-310"><a href="#cb77-310" aria-hidden="true" tabindex="-1"></a>::: {.column width="80%"}</span>
<span id="cb77-311"><a href="#cb77-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-312"><a href="#cb77-312" aria-hidden="true" tabindex="-1"></a>√âcosyst√®me de biblioth√®ques pour l'analyse spatiale <span class="co">[</span><span class="ot">PySAL</span><span class="co">](https://pysal.org/)</span> (Python Spatial Analysis Library, @pysal2007) :</span>
<span id="cb77-313"><a href="#cb77-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-314"><a href="#cb77-314" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Explorer**:</span>
<span id="cb77-315"><a href="#cb77-315" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Analyse exploratoire des donn√©es spatiales (package <span class="co">[</span><span class="ot">esda</span><span class="co">](https://pysal.org/esda/)</span>)</span>
<span id="cb77-316"><a href="#cb77-316" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Analyse de la dynamique des donn√©es spatiales longitudinales (package <span class="co">[</span><span class="ot">giddy</span><span class="co">](https://pysal.org/giddy/)</span>)</span>
<span id="cb77-317"><a href="#cb77-317" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Mesure des in√©galit√©s dans l'espace et dans le temps (package <span class="co">[</span><span class="ot">inequality</span><span class="co">](https://inequality.readthedocs.io/en/latest/)</span>)</span>
<span id="cb77-318"><a href="#cb77-318" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Analyse statistique de motifs ponctuels planaires (package <span class="co">[</span><span class="ot">pointpats</span><span class="co">](https://pysal.org/pointpats/)</span>)</span>
<span id="cb77-319"><a href="#cb77-319" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Mesure de la s√©gr√©gation dans le temps et dans l'espace (package <span class="co">[</span><span class="ot">segregation</span><span class="co">](https://pysal.org/segregation/)</span>)</span>
<span id="cb77-320"><a href="#cb77-320" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Morphom√©trie urbaine (package <span class="co">[</span><span class="ot">momepy</span><span class="co">](https://docs.momepy.org/en/stable/)</span>)</span>
<span id="cb77-321"><a href="#cb77-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-322"><a href="#cb77-322" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Mod√©liser**:</span>
<span id="cb77-323"><a href="#cb77-323" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>R√©gression g√©ographiquement pond√©r√©e √† plusieurs √©chelles (package <span class="co">[</span><span class="ot">mgwr</span><span class="co">](https://mgwr.readthedocs.io/en/latest/)</span>)</span>
<span id="cb77-324"><a href="#cb77-324" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Mod√®les lin√©aires g√©n√©ralis√©s √©pars (package <span class="co">[</span><span class="ot">spglm</span><span class="co">](https://spglm.readthedocs.io/en/latest/)</span>)</span>
<span id="cb77-325"><a href="#cb77-325" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Mod√®les d'interaction spatiale (package <span class="co">[</span><span class="ot">spint</span><span class="co">](https://spint.readthedocs.io/en/latest/)</span>)</span>
<span id="cb77-326"><a href="#cb77-326" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Mod√®les de r√©gression spatiale (package <span class="co">[</span><span class="ot">spreg</span><span class="co">](https://spreg.readthedocs.io/en/latest/)</span>)</span>
<span id="cb77-327"><a href="#cb77-327" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Mod√®les de composantes de variance √† corr√©lation spatiale √† plusieurs niveaux (package <span class="co">[</span><span class="ot">spvcm</span><span class="co">](https://github.com/pysal/spvcm)</span>)</span>
<span id="cb77-328"><a href="#cb77-328" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>*Areal interpolation* et cartographie dasym√©trique (package <span class="co">[</span><span class="ot">tobler</span><span class="co">](https://pysal.org/tobler/)</span>)</span>
<span id="cb77-329"><a href="#cb77-329" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Accessibilit√© spatiale (package <span class="co">[</span><span class="ot">access</span><span class="co">](https://pysal.org/access/)</span>)</span>
<span id="cb77-330"><a href="#cb77-330" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Optimisation spatiale (package <span class="co">[</span><span class="ot">spopt</span><span class="co">](https://pysal.org/spopt/)</span>)</span>
<span id="cb77-331"><a href="#cb77-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-332"><a href="#cb77-332" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb77-333"><a href="#cb77-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-334"><a href="#cb77-334" aria-hidden="true" tabindex="-1"></a>::: {.column width="20%"}</span>
<span id="cb77-335"><a href="#cb77-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-336"><a href="#cb77-336" aria-hidden="true" tabindex="-1"></a><span class="al">![](./fig/logo-pysal.png)</span></span>
<span id="cb77-337"><a href="#cb77-337" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb77-338"><a href="#cb77-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-339"><a href="#cb77-339" aria-hidden="true" tabindex="-1"></a>::::</span>
<span id="cb77-340"><a href="#cb77-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-341"><a href="#cb77-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-342"><a href="#cb77-342" aria-hidden="true" tabindex="-1"></a><span class="fu">## Autres packages utiles ...</span></span>
<span id="cb77-343"><a href="#cb77-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-344"><a href="#cb77-344" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Binding Python pour <span class="co">[</span><span class="ot">GRASS</span><span class="co">](https://grass.osgeo.org/grass82/manuals/libpython/index.html)</span> + Int√©gration dans les notebooks Jupyter</span>
<span id="cb77-345"><a href="#cb77-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-346"><a href="#cb77-346" aria-hidden="true" tabindex="-1"></a><span class="al">![Source: &lt;https://grass.osgeo.org/news/2022_06_05_results_student_grant_caitlin/&gt;](./fig/grass_jupyter_combo_vis.png)</span></span>
<span id="cb77-347"><a href="#cb77-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-348"><a href="#cb77-348" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Iris</span><span class="co">](https://scitools-iris.readthedocs.io/en/stable/)</span></span>
<span id="cb77-349"><a href="#cb77-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-350"><a href="#cb77-350" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Pour la cartographie : <span class="co">[</span><span class="ot">cartopy</span><span class="co">](https://scitools.org.uk/cartopy/docs/latest/)</span> ; <span class="co">[</span><span class="ot">geoviews</span><span class="co">](https://geoviews.org/)</span> et <span class="co">[</span><span class="ot">geoplot</span><span class="co">](https://residentmario.github.io/geoplot/)</span> bas√©s sur *cartopy* ; <span class="co">[</span><span class="ot">PyGMT</span><span class="co">](https://www.pygmt.org/latest/)</span> (selon les usages - pas de solution aussi aboutie que <span class="in">`mapsf`</span> pour les cartes r√©alis√©es en SHS).</span>
<span id="cb77-351"><a href="#cb77-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-352"><a href="#cb77-352" aria-hidden="true" tabindex="-1"></a><span class="al">![](./fig/cartopy.png)</span></span>
<span id="cb77-353"><a href="#cb77-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-354"><a href="#cb77-354" aria-hidden="true" tabindex="-1"></a><span class="fu">## Ressources Python G√©ospatial</span></span>
<span id="cb77-355"><a href="#cb77-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-356"><a href="#cb77-356" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">https://py.geocompx.org/</span><span class="co">](https://py.geocompx.org/)</span> <span class="co">[</span><span class="ot">@Dorman2022</span><span class="co">]</span></span>
<span id="cb77-357"><a href="#cb77-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-358"><a href="#cb77-358" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">https://geo-python-site.readthedocs.io/en/latest/</span><span class="co">](https://geo-python-site.readthedocs.io/en/latest/)</span></span>
<span id="cb77-359"><a href="#cb77-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-360"><a href="#cb77-360" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">https://automating-gis-processes.github.io</span><span class="co">](https://automating-gis-processes.github.io)</span></span>
<span id="cb77-361"><a href="#cb77-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-362"><a href="#cb77-362" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">https://www.earthdatascience.org/courses/use-data-open-source-python/</span><span class="co">](https://www.earthdatascience.org/courses/use-data-open-source-python/)</span></span>
<span id="cb77-363"><a href="#cb77-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-364"><a href="#cb77-364" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">https://geographicdata.science/book/intro.html</span><span class="co">](https://geographicdata.science/book/intro.html)</span></span>
<span id="cb77-365"><a href="#cb77-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-366"><a href="#cb77-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-367"><a href="#cb77-367" aria-hidden="true" tabindex="-1"></a><span class="fu">## Interaction R ‚áÑ Python dans Quarto</span></span>
<span id="cb77-368"><a href="#cb77-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-369"><a href="#cb77-369" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb77-370"><a href="#cb77-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-371"><a href="#cb77-371" aria-hidden="true" tabindex="-1"></a><span class="fu">### R ‚Üí Python</span></span>
<span id="cb77-372"><a href="#cb77-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-373"><a href="#cb77-373" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>D√©finition de variables dans un chunk R :</span>
<span id="cb77-374"><a href="#cb77-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-375"><a href="#cb77-375" aria-hidden="true" tabindex="-1"></a><span class="in">```{r example-r-1}</span></span>
<span id="cb77-376"><a href="#cb77-376" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">42</span></span>
<span id="cb77-377"><a href="#cb77-377" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb77-378"><a href="#cb77-378" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">13</span>, <span class="dv">14</span>)</span>
<span id="cb77-379"><a href="#cb77-379" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-380"><a href="#cb77-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-381"><a href="#cb77-381" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>R√©cup√©ration depuis un chunk Python :</span>
<span id="cb77-382"><a href="#cb77-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-383"><a href="#cb77-383" aria-hidden="true" tabindex="-1"></a>*en utilisant la variable `r`, un point, et le nom de la variable R √† r√©cup√©rer*</span>
<span id="cb77-384"><a href="#cb77-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-385"><a href="#cb77-385" aria-hidden="true" tabindex="-1"></a><span class="in">```{python example-python-1}</span></span>
<span id="cb77-386"><a href="#cb77-386" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(r.a)</span>
<span id="cb77-387"><a href="#cb77-387" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(r.b)</span>
<span id="cb77-388"><a href="#cb77-388" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(r.c)</span>
<span id="cb77-389"><a href="#cb77-389" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-390"><a href="#cb77-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-391"><a href="#cb77-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-392"><a href="#cb77-392" aria-hidden="true" tabindex="-1"></a><span class="fu">### Python ‚Üí R</span></span>
<span id="cb77-393"><a href="#cb77-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-394"><a href="#cb77-394" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>D√©finition de variables dans un chunk Python :</span>
<span id="cb77-395"><a href="#cb77-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-396"><a href="#cb77-396" aria-hidden="true" tabindex="-1"></a><span class="in">```{python example-python-2}</span></span>
<span id="cb77-397"><a href="#cb77-397" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> <span class="dv">42</span></span>
<span id="cb77-398"><a href="#cb77-398" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>]</span>
<span id="cb77-399"><a href="#cb77-399" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-400"><a href="#cb77-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-401"><a href="#cb77-401" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>R√©cup√©ration depuis un chunk R :</span>
<span id="cb77-402"><a href="#cb77-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-403"><a href="#cb77-403" aria-hidden="true" tabindex="-1"></a>*en utilisant la variable `py`, un dollar `$`, et le nom de la variable Python √† r√©cup√©rer*</span>
<span id="cb77-404"><a href="#cb77-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-405"><a href="#cb77-405" aria-hidden="true" tabindex="-1"></a><span class="in">```{r example-r-2}</span></span>
<span id="cb77-406"><a href="#cb77-406" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(py<span class="sc">$</span>a)</span>
<span id="cb77-407"><a href="#cb77-407" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(py<span class="sc">$</span>b)</span>
<span id="cb77-408"><a href="#cb77-408" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-409"><a href="#cb77-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-410"><a href="#cb77-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-411"><a href="#cb77-411" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb77-412"><a href="#cb77-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-413"><a href="#cb77-413" aria-hidden="true" tabindex="-1"></a><span class="fu">## Interaction R ‚áÑ Python dans Quarto (suite)</span></span>
<span id="cb77-414"><a href="#cb77-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-415"><a href="#cb77-415" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Il est possible d'√©changer des types plus complexes (<span class="in">`data.frame`</span> ‚áÑ <span class="in">`DataFrame`</span> pandas, tableau numpy, etc.)</span>
<span id="cb77-416"><a href="#cb77-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-417"><a href="#cb77-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-418"><a href="#cb77-418" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb77-419"><a href="#cb77-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-420"><a href="#cb77-420" aria-hidden="true" tabindex="-1"></a><span class="fu">### R ‚Üí Python</span></span>
<span id="cb77-421"><a href="#cb77-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-422"><a href="#cb77-422" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Depuis un chunk R :</span>
<span id="cb77-423"><a href="#cb77-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-424"><a href="#cb77-424" aria-hidden="true" tabindex="-1"></a><span class="in">```{r example-r-3}</span></span>
<span id="cb77-425"><a href="#cb77-425" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb77-426"><a href="#cb77-426" aria-hidden="true" tabindex="-1"></a>   <span class="at">emp_id =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>),</span>
<span id="cb77-427"><a href="#cb77-427" aria-hidden="true" tabindex="-1"></a>   <span class="at">emp_name =</span> <span class="fu">c</span>(<span class="st">"Rick"</span>,<span class="st">"Dan"</span>,<span class="st">"Michelle"</span>,<span class="st">"Ryan"</span>,<span class="st">"Jane"</span>),</span>
<span id="cb77-428"><a href="#cb77-428" aria-hidden="true" tabindex="-1"></a>   <span class="at">salary =</span> <span class="fu">c</span>(<span class="fl">623.3</span>,<span class="fl">515.2</span>,<span class="fl">611.0</span>,<span class="fl">729.0</span>,<span class="fl">843.25</span>),</span>
<span id="cb77-429"><a href="#cb77-429" aria-hidden="true" tabindex="-1"></a>   <span class="at">start_date =</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="st">"2012-01-01"</span>, <span class="st">"2013-09-23"</span>, <span class="st">"2014-11-15"</span>, <span class="st">"2014-05-11"</span>, <span class="st">"2015-03-27"</span>)),</span>
<span id="cb77-430"><a href="#cb77-430" aria-hidden="true" tabindex="-1"></a>   <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb77-431"><a href="#cb77-431" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb77-432"><a href="#cb77-432" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-433"><a href="#cb77-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-434"><a href="#cb77-434" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>R√©cup√©ration depuis un chunk Python :</span>
<span id="cb77-435"><a href="#cb77-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-436"><a href="#cb77-436" aria-hidden="true" tabindex="-1"></a><span class="in">```{python example-python-3}</span></span>
<span id="cb77-437"><a href="#cb77-437" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> r.df</span>
<span id="cb77-438"><a href="#cb77-438" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.head())</span>
<span id="cb77-439"><a href="#cb77-439" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-440"><a href="#cb77-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-441"><a href="#cb77-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-442"><a href="#cb77-442" aria-hidden="true" tabindex="-1"></a><span class="fu">### Python ‚Üí R</span></span>
<span id="cb77-443"><a href="#cb77-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-444"><a href="#cb77-444" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Depuis un chunk Python :</span>
<span id="cb77-445"><a href="#cb77-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-446"><a href="#cb77-446" aria-hidden="true" tabindex="-1"></a><span class="in">```{python example-python-4}</span></span>
<span id="cb77-447"><a href="#cb77-447" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb77-448"><a href="#cb77-448" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb77-449"><a href="#cb77-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-450"><a href="#cb77-450" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> pd.DataFrame({</span>
<span id="cb77-451"><a href="#cb77-451" aria-hidden="true" tabindex="-1"></a>  <span class="st">"emp_id"</span>: <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">5</span>)),</span>
<span id="cb77-452"><a href="#cb77-452" aria-hidden="true" tabindex="-1"></a>  <span class="st">"emp_name"</span>: [<span class="st">"Rick"</span>, <span class="st">"Dan"</span>, <span class="st">"Michelle"</span>, <span class="st">"Ryan"</span>, <span class="st">"Jane"</span>],</span>
<span id="cb77-453"><a href="#cb77-453" aria-hidden="true" tabindex="-1"></a>  <span class="st">"salary"</span>: [<span class="fl">623.3</span>, <span class="fl">515.2</span>, <span class="fl">611.0</span>, <span class="fl">729.0</span>, <span class="fl">843.25</span>],</span>
<span id="cb77-454"><a href="#cb77-454" aria-hidden="true" tabindex="-1"></a>  <span class="st">"start_date"</span>: pd.to_datetime([<span class="st">"2012-01-01"</span>, <span class="st">"2013-09-23"</span>, <span class="st">"2014-11-15"</span>, <span class="st">"2014-05-11"</span>, <span class="st">"2015-03-27"</span>]),</span>
<span id="cb77-455"><a href="#cb77-455" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb77-456"><a href="#cb77-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-457"><a href="#cb77-457" aria-hidden="true" tabindex="-1"></a>arr <span class="op">=</span> np.array([[<span class="dv">12</span>, <span class="dv">47</span>], [<span class="dv">34</span>, <span class="dv">90</span>], [<span class="dv">23</span>, <span class="dv">19</span>]])</span>
<span id="cb77-458"><a href="#cb77-458" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-459"><a href="#cb77-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-460"><a href="#cb77-460" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Utilisation depuis un chunk R :</span>
<span id="cb77-461"><a href="#cb77-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-462"><a href="#cb77-462" aria-hidden="true" tabindex="-1"></a><span class="in">```{r example-r-4}</span></span>
<span id="cb77-463"><a href="#cb77-463" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(py<span class="sc">$</span>df2)</span>
<span id="cb77-464"><a href="#cb77-464" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(py<span class="sc">$</span>arr)</span>
<span id="cb77-465"><a href="#cb77-465" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-466"><a href="#cb77-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-467"><a href="#cb77-467" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb77-468"><a href="#cb77-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-469"><a href="#cb77-469" aria-hidden="true" tabindex="-1"></a><span class="fu">## Interaction R ‚áÑ Python dans Quarto (suite)</span></span>
<span id="cb77-470"><a href="#cb77-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-471"><a href="#cb77-471" aria-hidden="true" tabindex="-1"></a>Et pour les objets spatiaux ? (*sf* / *geopandas*)</span>
<span id="cb77-472"><a href="#cb77-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-473"><a href="#cb77-473" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Si la conversion <span class="in">`data.frame`</span> ‚áÑ <span class="in">`DataFrame`</span> est transparente, il n'en est pas de m√™me pour les dataframe avec une composante spatiale (perte de la dimension spatiale / colonne <span class="in">`geometry`</span> contient d√©sormais ...)</span>
<span id="cb77-474"><a href="#cb77-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-475"><a href="#cb77-475" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>L'√©criture d'une petite function permet de r√©soudre √ßa :</span>
<span id="cb77-476"><a href="#cb77-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-477"><a href="#cb77-477" aria-hidden="true" tabindex="-1"></a><span class="in">```{r import}</span></span>
<span id="cb77-478"><a href="#cb77-478" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb77-479"><a href="#cb77-479" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb77-480"><a href="#cb77-480" aria-hidden="true" tabindex="-1"></a><span class="co"># Import des donn√©es</span></span>
<span id="cb77-481"><a href="#cb77-481" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb77-482"><a href="#cb77-482" aria-hidden="true" tabindex="-1"></a>mun_raw <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"geom/munic.geojson"</span>, <span class="at">quiet=</span> <span class="cn">TRUE</span>)</span>
<span id="cb77-483"><a href="#cb77-483" aria-hidden="true" tabindex="-1"></a>mrc_raw <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"geom/mrc.geojson"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb77-484"><a href="#cb77-484" aria-hidden="true" tabindex="-1"></a><span class="co"># Projection NAD83 / Quebec Albers</span></span>
<span id="cb77-485"><a href="#cb77-485" aria-hidden="true" tabindex="-1"></a>crs <span class="ot">&lt;-</span> <span class="st">"EPSG:6623"</span></span>
<span id="cb77-486"><a href="#cb77-486" aria-hidden="true" tabindex="-1"></a>mun <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(mun_raw, crs)</span>
<span id="cb77-487"><a href="#cb77-487" aria-hidden="true" tabindex="-1"></a>mrc <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(mrc_raw, crs)</span>
<span id="cb77-488"><a href="#cb77-488" aria-hidden="true" tabindex="-1"></a><span class="co"># Cr√©ation d'une couche des r√©gions</span></span>
<span id="cb77-489"><a href="#cb77-489" aria-hidden="true" tabindex="-1"></a>reg <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(<span class="at">x =</span> mrc[,<span class="st">'MUS_NM_REG'</span>], </span>
<span id="cb77-490"><a href="#cb77-490" aria-hidden="true" tabindex="-1"></a>                 <span class="at">by =</span> <span class="fu">list</span>(<span class="at">REG =</span> mrc<span class="sc">$</span>MUS_NM_REG), </span>
<span id="cb77-491"><a href="#cb77-491" aria-hidden="true" tabindex="-1"></a>                 <span class="at">FUN =</span> head, <span class="dv">1</span>)</span>
<span id="cb77-492"><a href="#cb77-492" aria-hidden="true" tabindex="-1"></a>resto_raw <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">'geom/resto.geojson'</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb77-493"><a href="#cb77-493" aria-hidden="true" tabindex="-1"></a>resto <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(resto_raw, crs)</span>
<span id="cb77-494"><a href="#cb77-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-495"><a href="#cb77-495" aria-hidden="true" tabindex="-1"></a>sel <span class="ot">&lt;-</span> <span class="st">"Qu√©bec"</span></span>
<span id="cb77-496"><a href="#cb77-496" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-497"><a href="#cb77-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-500"><a href="#cb77-500" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb77-501"><a href="#cb77-501" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.geometry <span class="im">import</span> shape</span>
<span id="cb77-502"><a href="#cb77-502" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb77-503"><a href="#cb77-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-504"><a href="#cb77-504" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> restore_geodataframe(df, crs, geom_type):</span>
<span id="cb77-505"><a href="#cb77-505" aria-hidden="true" tabindex="-1"></a>  geom <span class="op">=</span> df.geometry.<span class="bu">apply</span>(<span class="kw">lambda</span> coords: shape({ <span class="st">"type"</span>: geom_type, <span class="st">"coordinates"</span>: coords }))</span>
<span id="cb77-506"><a href="#cb77-506" aria-hidden="true" tabindex="-1"></a>  gdf <span class="op">=</span> gpd.GeoDataFrame(df.drop([<span class="st">'geometry'</span>], axis<span class="op">=</span><span class="dv">1</span>), geometry<span class="op">=</span>geom)</span>
<span id="cb77-507"><a href="#cb77-507" aria-hidden="true" tabindex="-1"></a>  gdf.set_crs(crs, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb77-508"><a href="#cb77-508" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> gdf</span>
<span id="cb77-509"><a href="#cb77-509" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-510"><a href="#cb77-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-511"><a href="#cb77-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-512"><a href="#cb77-512" aria-hidden="true" tabindex="-1"></a>Ainsi, les objets <span class="in">`sf`</span> pourront √™tre convertis en <span class="in">`GeoDataFrame`</span> ainsi :</span>
<span id="cb77-513"><a href="#cb77-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-516"><a href="#cb77-516" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb77-517"><a href="#cb77-517" aria-hidden="true" tabindex="-1"></a>mrc <span class="op">=</span> restore_geodataframe(r.mrc, r.crs, <span class="st">"MultiPolygon"</span>)</span>
<span id="cb77-518"><a href="#cb77-518" aria-hidden="true" tabindex="-1"></a>mrc.head()</span>
<span id="cb77-519"><a href="#cb77-519" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-520"><a href="#cb77-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-523"><a href="#cb77-523" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb77-524"><a href="#cb77-524" aria-hidden="true" tabindex="-1"></a>resto <span class="op">=</span> restore_geodataframe(r.resto, r.crs, <span class="st">"Point"</span>)</span>
<span id="cb77-525"><a href="#cb77-525" aria-hidden="true" tabindex="-1"></a>resto.head()</span>
<span id="cb77-526"><a href="#cb77-526" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-527"><a href="#cb77-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-528"><a href="#cb77-528" aria-hidden="true" tabindex="-1"></a><span class="fu">## Python, Quarto et interactivit√©</span></span>
<span id="cb77-529"><a href="#cb77-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-530"><a href="#cb77-530" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Utilisation des widgets Jupyter possible (seulement is utilisation de l'engin de rendu <span class="in">`jupyter`</span>, pas avec <span class="in">`knitr`</span> - i.e. l'inverse des *htmlwidgets* en R qui ne fonctionne que si <span class="in">`knitr`</span> est utilis√©)</span>
<span id="cb77-531"><a href="#cb77-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-532"><a href="#cb77-532" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Exemple :</span>
<span id="cb77-533"><a href="#cb77-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-534"><a href="#cb77-534" aria-hidden="true" tabindex="-1"></a><span class="al">![](./fig/example-quarto-jupyter-widgets.jpg)</span></span>
<span id="cb77-535"><a href="#cb77-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-536"><a href="#cb77-536" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Documentation : <span class="co">[</span><span class="ot">https://quarto.org/docs/interactive/widgets/jupyter.html</span><span class="co">](https://quarto.org/docs/interactive/widgets/jupyter.html)</span></span>
<span id="cb77-537"><a href="#cb77-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-538"><a href="#cb77-538" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exemples d'analyse sur les donn√©es du Qu√©bec</span></span>
<span id="cb77-539"><a href="#cb77-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-540"><a href="#cb77-540" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Les imports n√©cessaires :</span>
<span id="cb77-541"><a href="#cb77-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-542"><a href="#cb77-542" aria-hidden="true" tabindex="-1"></a><span class="in">```{python demo-import}</span></span>
<span id="cb77-543"><a href="#cb77-543" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb77-544"><a href="#cb77-544" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterio <span class="im">as</span> rio</span>
<span id="cb77-545"><a href="#cb77-545" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb77-546"><a href="#cb77-546" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb77-547"><a href="#cb77-547" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rioxarray</span>
<span id="cb77-548"><a href="#cb77-548" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xarray</span>
<span id="cb77-549"><a href="#cb77-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-550"><a href="#cb77-550" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.warp <span class="im">import</span> calculate_default_transform, reproject, Resampling</span>
<span id="cb77-551"><a href="#cb77-551" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot <span class="im">as</span> plt</span>
<span id="cb77-552"><a href="#cb77-552" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.plot <span class="im">import</span> show</span>
<span id="cb77-553"><a href="#cb77-553" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.mask <span class="im">import</span> mask</span>
<span id="cb77-554"><a href="#cb77-554" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterstats <span class="im">import</span> zonal_stats, point_query</span>
<span id="cb77-555"><a href="#cb77-555" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-556"><a href="#cb77-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-557"><a href="#cb77-557" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>On r√©cup√®re les jeux de donn√©es et quelques autres infos (SRC, etc.) depuis l'environnement R :</span>
<span id="cb77-558"><a href="#cb77-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-559"><a href="#cb77-559" aria-hidden="true" tabindex="-1"></a><span class="in">```{python demo-vector-dataset-opening}</span></span>
<span id="cb77-560"><a href="#cb77-560" aria-hidden="true" tabindex="-1"></a><span class="co"># Le SCR des donn√©es</span></span>
<span id="cb77-561"><a href="#cb77-561" aria-hidden="true" tabindex="-1"></a>dst_crs <span class="op">=</span> r.crs</span>
<span id="cb77-562"><a href="#cb77-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-563"><a href="#cb77-563" aria-hidden="true" tabindex="-1"></a><span class="co"># On r√©cup√®re le jeu de donn√©es "mrc" (municipalit√©s r√©gionales de comt√©)</span></span>
<span id="cb77-564"><a href="#cb77-564" aria-hidden="true" tabindex="-1"></a><span class="co"># et le jeu de donn√©es "resto"</span></span>
<span id="cb77-565"><a href="#cb77-565" aria-hidden="true" tabindex="-1"></a>mrc <span class="op">=</span> restore_geodataframe(r.mrc, dst_crs, <span class="st">"MultiPolygon"</span>)</span>
<span id="cb77-566"><a href="#cb77-566" aria-hidden="true" tabindex="-1"></a>resto <span class="op">=</span> restore_geodataframe(r.resto, dst_crs, <span class="st">"Point"</span>)</span>
<span id="cb77-567"><a href="#cb77-567" aria-hidden="true" tabindex="-1"></a>reg <span class="op">=</span> mrc.dissolve(by<span class="op">=</span><span class="st">"MUS_NM_REG"</span>)</span>
<span id="cb77-568"><a href="#cb77-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-569"><a href="#cb77-569" aria-hidden="true" tabindex="-1"></a>sel <span class="op">=</span> r.sel <span class="co"># Qu√©bec</span></span>
<span id="cb77-570"><a href="#cb77-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-571"><a href="#cb77-571" aria-hidden="true" tabindex="-1"></a><span class="co"># Chemin du jeu de donn√©es raster</span></span>
<span id="cb77-572"><a href="#cb77-572" aria-hidden="true" tabindex="-1"></a><span class="co"># et du fichier contenant les descriptions des cat√©gories</span></span>
<span id="cb77-573"><a href="#cb77-573" aria-hidden="true" tabindex="-1"></a>lc_fp <span class="op">=</span> <span class="st">'../../T√©l√©chargements/T01_PROVINCE.tif'</span></span>
<span id="cb77-574"><a href="#cb77-574" aria-hidden="true" tabindex="-1"></a>lc_categories_fp <span class="op">=</span> <span class="st">'../../T√©l√©chargements/correspondance_raster_CL_COUV.dbf'</span></span>
<span id="cb77-575"><a href="#cb77-575" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-576"><a href="#cb77-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-577"><a href="#cb77-577" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>On extrait les entit√©s correspondantes et on les affiche, relativement au reste de la province :</span>
<span id="cb77-578"><a href="#cb77-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-579"><a href="#cb77-579" aria-hidden="true" tabindex="-1"></a><span class="in">```{python demo-first-plot}</span></span>
<span id="cb77-580"><a href="#cb77-580" aria-hidden="true" tabindex="-1"></a>extract <span class="op">=</span> mrc[mrc.MUS_NM_MRC <span class="op">==</span> sel]</span>
<span id="cb77-581"><a href="#cb77-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-582"><a href="#cb77-582" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> mrc.plot(color<span class="op">=</span><span class="st">"lightblue"</span>, edgecolor<span class="op">=</span><span class="st">"grey"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">12</span>))</span>
<span id="cb77-583"><a href="#cb77-583" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> reg.plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="va">None</span>, edgecolor<span class="op">=</span><span class="st">"orange"</span>, alpha<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb77-584"><a href="#cb77-584" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> extract.plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">"red"</span>)</span>
<span id="cb77-585"><a href="#cb77-585" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb77-586"><a href="#cb77-586" aria-hidden="true" tabindex="-1"></a>ax</span>
<span id="cb77-587"><a href="#cb77-587" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-588"><a href="#cb77-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-589"><a href="#cb77-589" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Ouverture et reprojection d'un jeu de donn√©es raster (avec *rioxarray*) :</span>
<span id="cb77-590"><a href="#cb77-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-591"><a href="#cb77-591" aria-hidden="true" tabindex="-1"></a><span class="in">```{python demo-open-raster}</span></span>
<span id="cb77-592"><a href="#cb77-592" aria-hidden="true" tabindex="-1"></a>xds <span class="op">=</span> rioxarray.open_rasterio(lc_fp)</span>
<span id="cb77-593"><a href="#cb77-593" aria-hidden="true" tabindex="-1"></a>xds <span class="op">=</span> xds.rio.reproject(dst_crs)</span>
<span id="cb77-594"><a href="#cb77-594" aria-hidden="true" tabindex="-1"></a>xds</span>
<span id="cb77-595"><a href="#cb77-595" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-596"><a href="#cb77-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-597"><a href="#cb77-597" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Affichons le raster reprojet√© et l'emprise de la ville de Qu√©bec :</span>
<span id="cb77-598"><a href="#cb77-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-599"><a href="#cb77-599" aria-hidden="true" tabindex="-1"></a><span class="in">```{python demo-plot-raster}</span></span>
<span id="cb77-600"><a href="#cb77-600" aria-hidden="true" tabindex="-1"></a><span class="co"># Remplacer les '255' par '0'</span></span>
<span id="cb77-601"><a href="#cb77-601" aria-hidden="true" tabindex="-1"></a>xds.data[xds.data <span class="op">==</span> <span class="dv">255</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb77-602"><a href="#cb77-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-603"><a href="#cb77-603" aria-hidden="true" tabindex="-1"></a><span class="co"># √âtendue des donn√©es</span></span>
<span id="cb77-604"><a href="#cb77-604" aria-hidden="true" tabindex="-1"></a>bounds <span class="op">=</span> xds.rio.bounds()</span>
<span id="cb77-605"><a href="#cb77-605" aria-hidden="true" tabindex="-1"></a>extent <span class="op">=</span> [bounds[<span class="dv">0</span>], bounds[<span class="dv">2</span>], bounds[<span class="dv">1</span>], bounds[<span class="dv">3</span>]]</span>
<span id="cb77-606"><a href="#cb77-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-607"><a href="#cb77-607" aria-hidden="true" tabindex="-1"></a><span class="co"># Cr√©ation d'une figure vide</span></span>
<span id="cb77-608"><a href="#cb77-608" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">12</span>))</span>
<span id="cb77-609"><a href="#cb77-609" aria-hidden="true" tabindex="-1"></a><span class="co"># Affichage du raster (attribut 'data' de l'objet xds)</span></span>
<span id="cb77-610"><a href="#cb77-610" aria-hidden="true" tabindex="-1"></a>show(xds.data[<span class="dv">0</span>], ax<span class="op">=</span>ax, extent<span class="op">=</span>extent, cmap<span class="op">=</span><span class="st">"Set3"</span>)</span>
<span id="cb77-611"><a href="#cb77-611" aria-hidden="true" tabindex="-1"></a><span class="co"># Affichage de la ville de Qu√©bec en rouge par dessus</span></span>
<span id="cb77-612"><a href="#cb77-612" aria-hidden="true" tabindex="-1"></a>extract.plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">'red'</span>, edgecolor<span class="op">=</span><span class="st">'red'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb77-613"><a href="#cb77-613" aria-hidden="true" tabindex="-1"></a><span class="co"># On enl√®ve l'affichage des axes</span></span>
<span id="cb77-614"><a href="#cb77-614" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb77-615"><a href="#cb77-615" aria-hidden="true" tabindex="-1"></a>ax</span>
<span id="cb77-616"><a href="#cb77-616" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-617"><a href="#cb77-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-618"><a href="#cb77-618" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Ouverture du fichier DBF qui contient les correspondances entre les codes et les noms des cat√©gories d'utilisation des sols</span>
<span id="cb77-619"><a href="#cb77-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-620"><a href="#cb77-620" aria-hidden="true" tabindex="-1"></a><span class="in">```{python demo-open-dbf}</span></span>
<span id="cb77-621"><a href="#cb77-621" aria-hidden="true" tabindex="-1"></a>categories <span class="op">=</span> pd.DataFrame(</span>
<span id="cb77-622"><a href="#cb77-622" aria-hidden="true" tabindex="-1"></a>  gpd.read_file(lc_categories_fp, encoding<span class="op">=</span><span class="st">'utf-8'</span>)[[<span class="st">'ID'</span>, <span class="st">'CL_COUV'</span>, <span class="st">'Descriptio'</span>]])</span>
<span id="cb77-623"><a href="#cb77-623" aria-hidden="true" tabindex="-1"></a>categories.head(<span class="dv">11</span>)</span>
<span id="cb77-624"><a href="#cb77-624" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-625"><a href="#cb77-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-626"><a href="#cb77-626" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb77-627"><a href="#cb77-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-630"><a href="#cb77-630" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb77-631"><a href="#cb77-631" aria-hidden="true" tabindex="-1"></a><span class="co"># On va convertir cette DataFrame en un dictionnaire pour l'utiliser</span></span>
<span id="cb77-632"><a href="#cb77-632" aria-hidden="true" tabindex="-1"></a><span class="co"># comme un mapping ID -&gt; Description</span></span>
<span id="cb77-633"><a href="#cb77-633" aria-hidden="true" tabindex="-1"></a>categories <span class="op">=</span> {</span>
<span id="cb77-634"><a href="#cb77-634" aria-hidden="true" tabindex="-1"></a>  <span class="bu">int</span>(k): v[<span class="st">'Descriptio'</span>]</span>
<span id="cb77-635"><a href="#cb77-635" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> k,v <span class="kw">in</span> categories[[<span class="st">'ID'</span>, <span class="st">'Descriptio'</span>]].set_index(<span class="st">'ID'</span>).to_dict(orient<span class="op">=</span><span class="st">'index'</span>).items()</span>
<span id="cb77-636"><a href="#cb77-636" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb77-637"><a href="#cb77-637" aria-hidden="true" tabindex="-1"></a><span class="co"># Bien qu'il y ait une cat√©gorie 'Pas de donn√©es' (ID 10)</span></span>
<span id="cb77-638"><a href="#cb77-638" aria-hidden="true" tabindex="-1"></a><span class="co"># certaines cellules ne comportent pas de valeur (nodata, ici avec la valeur 0)</span></span>
<span id="cb77-639"><a href="#cb77-639" aria-hidden="true" tabindex="-1"></a>categories[<span class="dv">0</span>] <span class="op">=</span> <span class="st">'Pas de donn√©es'</span></span>
<span id="cb77-640"><a href="#cb77-640" aria-hidden="true" tabindex="-1"></a>categories</span>
<span id="cb77-641"><a href="#cb77-641" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-642"><a href="#cb77-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-643"><a href="#cb77-643" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Calculer les statistiques zonales (combien de cellules de chaque type dans la s√©lection) :</span>
<span id="cb77-644"><a href="#cb77-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-647"><a href="#cb77-647" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb77-648"><a href="#cb77-648" aria-hidden="true" tabindex="-1"></a>stats <span class="op">=</span> zonal_stats(extract, xds.data[<span class="dv">0</span>], affine<span class="op">=</span>xds.rio.transform(), categorical<span class="op">=</span><span class="va">True</span>, nodata<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb77-649"><a href="#cb77-649" aria-hidden="true" tabindex="-1"></a>stats</span>
<span id="cb77-650"><a href="#cb77-650" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-651"><a href="#cb77-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-652"><a href="#cb77-652" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Tra√ßons un histogramme de ce r√©sultat, en utilisant les noms appropri√©s des cat√©gories d'utilisation des sols :</span>
<span id="cb77-653"><a href="#cb77-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-656"><a href="#cb77-656" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb77-657"><a href="#cb77-657" aria-hidden="true" tabindex="-1"></a><span class="co">#| output-location: slide </span></span>
<span id="cb77-658"><a href="#cb77-658" aria-hidden="true" tabindex="-1"></a><span class="co"># Utilise les noms de cat√©gories du DataFrame `categories`...</span></span>
<span id="cb77-659"><a href="#cb77-659" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> [categories[<span class="bu">int</span>(v)] <span class="cf">for</span> v <span class="kw">in</span> stats[<span class="dv">0</span>].keys()]</span>
<span id="cb77-660"><a href="#cb77-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-661"><a href="#cb77-661" aria-hidden="true" tabindex="-1"></a><span class="co"># ...et les valeurs que nous venons de calculer avec la fonction `zonal_stats`</span></span>
<span id="cb77-662"><a href="#cb77-662" aria-hidden="true" tabindex="-1"></a>height <span class="op">=</span> stats[<span class="dv">0</span>].values()</span>
<span id="cb77-663"><a href="#cb77-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-664"><a href="#cb77-664" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">8</span>))</span>
<span id="cb77-665"><a href="#cb77-665" aria-hidden="true" tabindex="-1"></a>bar_container <span class="op">=</span> ax.bar(x, height)</span>
<span id="cb77-666"><a href="#cb77-666" aria-hidden="true" tabindex="-1"></a>ax.set_xticklabels(</span>
<span id="cb77-667"><a href="#cb77-667" aria-hidden="true" tabindex="-1"></a>    ax.get_xticklabels(),</span>
<span id="cb77-668"><a href="#cb77-668" aria-hidden="true" tabindex="-1"></a>    rotation<span class="op">=</span><span class="dv">45</span>,</span>
<span id="cb77-669"><a href="#cb77-669" aria-hidden="true" tabindex="-1"></a>    horizontalalignment<span class="op">=</span><span class="st">'right'</span></span>
<span id="cb77-670"><a href="#cb77-670" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb77-671"><a href="#cb77-671" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span>
<span id="cb77-672"><a href="#cb77-672" aria-hidden="true" tabindex="-1"></a>ax</span>
<span id="cb77-673"><a href="#cb77-673" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-674"><a href="#cb77-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-675"><a href="#cb77-675" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Affichons un petit r√©sum√© utilisant des valeurs en m</span>
<span id="cb77-676"><a href="#cb77-676" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Dans quel type d'occupation du sol se trouvent les restaurants pr√©c√©demment r√©cup√©r√©s ?</span>
<span id="cb77-677"><a href="#cb77-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-680"><a href="#cb77-680" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb77-681"><a href="#cb77-681" aria-hidden="true" tabindex="-1"></a>geoms <span class="op">=</span> resto[<span class="st">'geometry'</span>].tolist()</span>
<span id="cb77-682"><a href="#cb77-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-683"><a href="#cb77-683" aria-hidden="true" tabindex="-1"></a>resto[<span class="st">"lc"</span>] <span class="op">=</span> [categories[<span class="bu">int</span>(x)] <span class="cf">for</span> x <span class="kw">in</span> point_query(vectors<span class="op">=</span>geoms, raster<span class="op">=</span>xds.data[<span class="dv">0</span>], nodata<span class="op">=</span><span class="dv">0</span>, affine<span class="op">=</span>xds.rio.transform())]</span>
<span id="cb77-684"><a href="#cb77-684" aria-hidden="true" tabindex="-1"></a>resto.head()</span>
<span id="cb77-685"><a href="#cb77-685" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-686"><a href="#cb77-686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-687"><a href="#cb77-687" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Quels restaurants ne sont pas situ√©s dans une zone artificialis√©e ?</span>
<span id="cb77-688"><a href="#cb77-688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-691"><a href="#cb77-691" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb77-692"><a href="#cb77-692" aria-hidden="true" tabindex="-1"></a>selection <span class="op">=</span> resto[(resto.lc <span class="op">!=</span> <span class="st">'Surfaces artificielles'</span>) <span class="op">&amp;</span> (resto.lc <span class="op">!=</span> <span class="st">'Pas de donn√©es'</span>)]</span>
<span id="cb77-693"><a href="#cb77-693" aria-hidden="true" tabindex="-1"></a>selection</span>
<span id="cb77-694"><a href="#cb77-694" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-695"><a href="#cb77-695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-696"><a href="#cb77-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-699"><a href="#cb77-699" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb77-700"><a href="#cb77-700" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> extract.plot(color<span class="op">=</span><span class="va">None</span>, edgecolor<span class="op">=</span><span class="st">"black"</span>)</span>
<span id="cb77-701"><a href="#cb77-701" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> selection.plot(ax<span class="op">=</span>ax, marker<span class="op">=</span><span class="st">'x'</span>, color<span class="op">=</span><span class="st">'red'</span>, markersize<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb77-702"><a href="#cb77-702" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb77-703"><a href="#cb77-703" aria-hidden="true" tabindex="-1"></a>ax</span>
<span id="cb77-704"><a href="#cb77-704" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-705"><a href="#cb77-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-706"><a href="#cb77-706" aria-hidden="true" tabindex="-1"></a><span class="fu">## A vous de jouer üöÄ</span></span>
<span id="cb77-707"><a href="#cb77-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-708"><a href="#cb77-708" aria-hidden="true" tabindex="-1"></a>**Objectif** : Comparez l'occupation du sol de l'ensemble de la province du Qu√©bec √† l'occupation du sol de la MRC de Montr√©al.</span>
<span id="cb77-709"><a href="#cb77-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-710"><a href="#cb77-710" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Vous cherchez √† obtenir :</span>
<span id="cb77-711"><a href="#cb77-711" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>2 graphiques en barres (un pour le Qu√©bec et un pour la MRC de Montr√©al)</span>
<span id="cb77-712"><a href="#cb77-712" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>un r√©sum√© (pourquoi pas en HTML !) de la surface de chaque type d'occupation du sol, comme celui pr√©sent√© en exemple ci-dessous</span>
<span id="cb77-713"><a href="#cb77-713" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb77-714"><a href="#cb77-714" aria-hidden="true" tabindex="-1"></a><span class="al">![Exemple de tableau de r√©sum√©](./fig/summary-lc.png)</span></span>
<span id="cb77-715"><a href="#cb77-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-716"><a href="#cb77-716" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Au d√©but de votre document, vous devez ins√©rer un chunk de code <span class="in">`R`</span> pour pr√©ciser la localisation de votre environnement virtuel Python - comme nous utilisons <span class="in">`knitr`</span>, c'est ce qui va permettre √† <span class="in">`reticulate`</span> de savoir o√π chercher les packages Python qui ont √©t√© install√©s pour cet atelier :</span>
<span id="cb77-717"><a href="#cb77-717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-718"><a href="#cb77-718" aria-hidden="true" tabindex="-1"></a><span class="in">````</span></span>
<span id="cb77-719"><a href="#cb77-719" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb77-720"><a href="#cb77-720" aria-hidden="true" tabindex="-1"></a><span class="in">#| echo: false</span></span>
<span id="cb77-721"><a href="#cb77-721" aria-hidden="true" tabindex="-1"></a><span class="in">library(reticulate)</span></span>
<span id="cb77-722"><a href="#cb77-722" aria-hidden="true" tabindex="-1"></a><span class="in">use_virtualenv("~/env-quarto")</span></span>
<span id="cb77-723"><a href="#cb77-723" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-724"><a href="#cb77-724" aria-hidden="true" tabindex="-1"></a><span class="in">````</span></span>
<span id="cb77-725"><a href="#cb77-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-726"><a href="#cb77-726" aria-hidden="true" tabindex="-1"></a>**_Besoin d'aide ?_**</span>
<span id="cb77-727"><a href="#cb77-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-728"><a href="#cb77-728" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip icon=false collapse="true"}</span>
<span id="cb77-729"><a href="#cb77-729" aria-hidden="true" tabindex="-1"></a><span class="fu">### Quelle suite d'action r√©aliser ?</span></span>
<span id="cb77-730"><a href="#cb77-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-731"><a href="#cb77-731" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Cr√©er un chunk 'r' pour dfinir la localisation de l'environnement virtuel</span>
<span id="cb77-732"><a href="#cb77-732" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Cr√©er les chunks 'python' correspondants aux actions suivantes :</span>
<span id="cb77-733"><a href="#cb77-733" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Ouvrir le jeu de donn√©es raster</span>
<span id="cb77-734"><a href="#cb77-734" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Ouvrir le jeu de donn√©es vecteur</span>
<span id="cb77-735"><a href="#cb77-735" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>S'assurer qu'ils sont dans le m√™me syst√®me de coordonn√©es de r√©f√©rence et effectuer la transformation si ce n'est pas le cas</span>
<span id="cb77-736"><a href="#cb77-736" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Obtenir les statistiques zonales pour l'ensemble de la province du Qu√©bec</span>
<span id="cb77-737"><a href="#cb77-737" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Obtenir les statistiques zonales pour la MRC de Montr√©al</span>
<span id="cb77-738"><a href="#cb77-738" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Produire les deux graphiques et un tableau synth√©tisant ces informations</span>
<span id="cb77-739"><a href="#cb77-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-740"><a href="#cb77-740" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb77-741"><a href="#cb77-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-742"><a href="#cb77-742" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip icon=false collapse="true"}</span>
<span id="cb77-743"><a href="#cb77-743" aria-hidden="true" tabindex="-1"></a><span class="fu">### De quelles biblioth√®ques a-t-on besoin ?</span></span>
<span id="cb77-744"><a href="#cb77-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-745"><a href="#cb77-745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-748"><a href="#cb77-748" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb77-749"><a href="#cb77-749" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb77-750"><a href="#cb77-750" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rioxarray</span>
<span id="cb77-751"><a href="#cb77-751" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xarray</span>
<span id="cb77-752"><a href="#cb77-752" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb77-753"><a href="#cb77-753" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb77-754"><a href="#cb77-754" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterstats</span>
<span id="cb77-755"><a href="#cb77-755" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb77-756"><a href="#cb77-756" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-757"><a href="#cb77-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-758"><a href="#cb77-758" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb77-759"><a href="#cb77-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-760"><a href="#cb77-760" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip icon=false collapse="true"}</span>
<span id="cb77-761"><a href="#cb77-761" aria-hidden="true" tabindex="-1"></a><span class="fu">### Besoin d'aide pour ouvrir les donn√©es raster ?</span></span>
<span id="cb77-762"><a href="#cb77-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-763"><a href="#cb77-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-766"><a href="#cb77-766" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb77-767"><a href="#cb77-767" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb77-768"><a href="#cb77-768" aria-hidden="true" tabindex="-1"></a>xds <span class="op">=</span> xarray.open_dataarray(<span class="st">"/chemin/vers/le/fichier"</span>)</span>
<span id="cb77-769"><a href="#cb77-769" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-770"><a href="#cb77-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-771"><a href="#cb77-771" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb77-772"><a href="#cb77-772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-773"><a href="#cb77-773" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip icon=false collapse="true"}</span>
<span id="cb77-774"><a href="#cb77-774" aria-hidden="true" tabindex="-1"></a><span class="fu">### Besoin d'aide pour ouvrir les donn√©es vecteur ?</span></span>
<span id="cb77-775"><a href="#cb77-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-776"><a href="#cb77-776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-779"><a href="#cb77-779" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb77-780"><a href="#cb77-780" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb77-781"><a href="#cb77-781" aria-hidden="true" tabindex="-1"></a>gdf <span class="op">=</span> gpd.read_file(<span class="st">'/chemin/vers/le/fichier'</span>)</span>
<span id="cb77-782"><a href="#cb77-782" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-783"><a href="#cb77-783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-784"><a href="#cb77-784" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb77-785"><a href="#cb77-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-786"><a href="#cb77-786" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip icon=false collapse="true"}</span>
<span id="cb77-787"><a href="#cb77-787" aria-hidden="true" tabindex="-1"></a><span class="fu">### Comment connaitre la taille d'une cellule raster ?</span></span>
<span id="cb77-788"><a href="#cb77-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-789"><a href="#cb77-789" aria-hidden="true" tabindex="-1"></a>En utilisant les param√®tres d√©crivant la matrice de transformation de g√©or√©f√©rencement du jeu de donn√©es raster en question (cette transformation fait correspondre les coordonn√©es ligne/colonne des pixels aux coordonn√©es du syst√®me de r√©f√©rence de l'ensemble de donn√©es) :</span>
<span id="cb77-790"><a href="#cb77-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-793"><a href="#cb77-793" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb77-794"><a href="#cb77-794" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb77-795"><a href="#cb77-795" aria-hidden="true" tabindex="-1"></a>transform <span class="op">=</span> xds.rio.transform()</span>
<span id="cb77-796"><a href="#cb77-796" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-797"><a href="#cb77-797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-798"><a href="#cb77-798" aria-hidden="true" tabindex="-1"></a>Puis en utilisant la premi√®re et la cinqui√®me valeur qui repr√©sentent respectivement la largeur et la hauteur du pixel :</span>
<span id="cb77-799"><a href="#cb77-799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-802"><a href="#cb77-802" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb77-803"><a href="#cb77-803" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb77-804"><a href="#cb77-804" aria-hidden="true" tabindex="-1"></a>area_pixel <span class="op">=</span> transform[<span class="dv">0</span>] <span class="op">*</span> <span class="bu">abs</span>(transform[<span class="dv">4</span>]) <span class="co"># la hauteur est g√©n√©ralement n√©gative</span></span>
<span id="cb77-805"><a href="#cb77-805" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-806"><a href="#cb77-806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-807"><a href="#cb77-807" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb77-808"><a href="#cb77-808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-809"><a href="#cb77-809" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip icon=false collapse="true"}</span>
<span id="cb77-810"><a href="#cb77-810" aria-hidden="true" tabindex="-1"></a><span class="fu">### Comment faire pour qu'un *chunk* retourne du HTML ?</span></span>
<span id="cb77-811"><a href="#cb77-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-812"><a href="#cb77-812" aria-hidden="true" tabindex="-1"></a>Par exemple en stockant du Markdown dans une cha√Æne de caract√®re et en le transformant en HTML avec <span class="in">`IPython.display.Markdown`</span> :</span>
<span id="cb77-813"><a href="#cb77-813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-816"><a href="#cb77-816" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb77-817"><a href="#cb77-817" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb77-818"><a href="#cb77-818" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> Markdown</span>
<span id="cb77-819"><a href="#cb77-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-820"><a href="#cb77-820" aria-hidden="true" tabindex="-1"></a>rendu <span class="op">=</span> <span class="st">'''</span></span>
<span id="cb77-821"><a href="#cb77-821" aria-hidden="true" tabindex="-1"></a><span class="st">## R√©sum√©</span></span>
<span id="cb77-822"><a href="#cb77-822" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-823"><a href="#cb77-823" aria-hidden="true" tabindex="-1"></a><span class="st">| Cat√©gorie | Superficie |</span></span>
<span id="cb77-824"><a href="#cb77-824" aria-hidden="true" tabindex="-1"></a><span class="st">|---------|----------|</span></span>
<span id="cb77-825"><a href="#cb77-825" aria-hidden="true" tabindex="-1"></a><span class="st">| Aahah | 21.34 |</span></span>
<span id="cb77-826"><a href="#cb77-826" aria-hidden="true" tabindex="-1"></a><span class="st">'''</span></span>
<span id="cb77-827"><a href="#cb77-827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-828"><a href="#cb77-828" aria-hidden="true" tabindex="-1"></a>Markdown(rendu)</span>
<span id="cb77-829"><a href="#cb77-829" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-830"><a href="#cb77-830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-831"><a href="#cb77-831" aria-hidden="true" tabindex="-1"></a>:::</span>
</code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>