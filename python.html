<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.475">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Timothée Giraud, Nicolas Lambert, Matthieu Viry, Ronan Ysebaert (UAR RIATE, CNRS, Université Paris Cité)">

<title>Articulation de différents langages (R, JavaScript et Python) pour la géovisualisation avec Quarto</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="python_files/libs/clipboard/clipboard.min.js"></script>
<script src="python_files/libs/quarto-html/quarto.js"></script>
<script src="python_files/libs/quarto-html/popper.min.js"></script>
<script src="python_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="python_files/libs/quarto-html/anchor.min.js"></script>
<link href="python_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="python_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="python_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="python_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="python_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul class="collapse">
  <li><a href="#python" id="toc-python" class="nav-link active" data-scroll-target="#python">Python</a>
  <ul class="collapse">
  <li><a href="#le-langage-python" id="toc-le-langage-python" class="nav-link" data-scroll-target="#le-langage-python">Le langage Python</a></li>
  <li><a href="#écosystème-pour-le-géospatial" id="toc-écosystème-pour-le-géospatial" class="nav-link" data-scroll-target="#écosystème-pour-le-géospatial">Écosystème pour le géospatial</a></li>
  <li><a href="#données-vectorielles" id="toc-données-vectorielles" class="nav-link" data-scroll-target="#données-vectorielles">Données vectorielles</a></li>
  <li><a href="#le-package-geopandas" id="toc-le-package-geopandas" class="nav-link" data-scroll-target="#le-package-geopandas">Le package <em>GeoPandas</em></a></li>
  <li><a href="#données-raster" id="toc-données-raster" class="nav-link" data-scroll-target="#données-raster">Données raster</a></li>
  <li><a href="#le-package-rasterio" id="toc-le-package-rasterio" class="nav-link" data-scroll-target="#le-package-rasterio">Le package <em>Rasterio</em></a></li>
  <li><a href="#les-package-xarray-et-rioxarray" id="toc-les-package-xarray-et-rioxarray" class="nav-link" data-scroll-target="#les-package-xarray-et-rioxarray">Les package <em>xarray</em> et <em>rioxarray</em></a></li>
  <li><a href="#analyse-spatiale" id="toc-analyse-spatiale" class="nav-link" data-scroll-target="#analyse-spatiale">Analyse spatiale</a></li>
  <li><a href="#autres-packages-utiles" id="toc-autres-packages-utiles" class="nav-link" data-scroll-target="#autres-packages-utiles">Autres packages utiles …</a></li>
  <li><a href="#ressources-python-géospatial" id="toc-ressources-python-géospatial" class="nav-link" data-scroll-target="#ressources-python-géospatial">Ressources Python Géospatial</a></li>
  <li><a href="#interaction-r-python-dans-quarto" id="toc-interaction-r-python-dans-quarto" class="nav-link" data-scroll-target="#interaction-r-python-dans-quarto">Interaction R ⇄ Python dans Quarto</a></li>
  <li><a href="#interaction-r-python-dans-quarto-suite" id="toc-interaction-r-python-dans-quarto-suite" class="nav-link" data-scroll-target="#interaction-r-python-dans-quarto-suite">Interaction R ⇄ Python dans Quarto (suite)</a></li>
  <li><a href="#interaction-r-python-dans-quarto-suite-1" id="toc-interaction-r-python-dans-quarto-suite-1" class="nav-link" data-scroll-target="#interaction-r-python-dans-quarto-suite-1">Interaction R ⇄ Python dans Quarto (suite)</a></li>
  <li><a href="#python-quarto-et-interactivité" id="toc-python-quarto-et-interactivité" class="nav-link" data-scroll-target="#python-quarto-et-interactivité">Python, Quarto et interactivité</a></li>
  <li><a href="#exemples-danalyse-sur-les-données-du-québec" id="toc-exemples-danalyse-sur-les-données-du-québec" class="nav-link" data-scroll-target="#exemples-danalyse-sur-les-données-du-québec">Exemples d’analyse sur les données du Québec</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Articulation de différents langages (R, JavaScript et Python) pour la géovisualisation avec Quarto</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
<p class="subtitle lead">Atelier Sageo, Québec, Juin 2023</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Timothée Giraud, Nicolas Lambert, Matthieu Viry, Ronan Ysebaert (UAR RIATE, CNRS, Université Paris Cité) </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<div class="cell">

</div>
<div class="cell">

</div>
<section id="python" class="level1">
<h1>Python</h1>
<section id="le-langage-python" class="level2">
<h2 class="anchored" data-anchor-id="le-langage-python">Le langage Python</h2>
<div class="columns">
<div class="column" style="width:70%;">
<ul>
<li><p><strong>Python</strong> : un langage <em>polyvalent</em>, <em>interprété</em> et <em>multi-paradigme</em></p></li>
<li><p>De plus en plus utilisé pour la <em>science des données</em></p></li>
</ul>
<div class="fragment">
<ul>
<li>Un écosystème robuste pour différents domaines d’application scientifiques</li>
</ul>
<p><img src="./fig/python-stack.png" class="img-fluid"></p>
</div>
</div><div class="column" style="width:30%;">
<p><img src="./fig/logo-python.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="écosystème-pour-le-géospatial" class="level2">
<h2 class="anchored" data-anchor-id="écosystème-pour-le-géospatial">Écosystème pour le géospatial</h2>
</section>
<section id="données-vectorielles" class="level2">
<h2 class="anchored" data-anchor-id="données-vectorielles">Données vectorielles</h2>
<div class="columns">
<div class="column" style="width:66%;">
<ul>
<li><a href="https://gdal.org/api/python_bindings.html"><strong>Bindings Python de GDAL/OGR</strong></a></li>
<li><a href="https://fiona.readthedocs.io/en/stable/"><strong>Fiona</strong></a> - I/O (<em>wrapper</em> de haut niveau autour d’OGR)</li>
<li><a href="https://shapely.readthedocs.io/"><strong>Shapely</strong></a> (bindings Python de GEOS)</li>
<li><a href="https://pyproj4.github.io/pyproj"><strong>Pyproj</strong></a> (bindings Python de <a href="https://proj.org/">PROJ</a>)</li>
<li><a href="https://geopandas.org/"><strong>Geopandas</strong></a> - Étend les <code>DataFrame</code>s de <a href="https://pandas.pydata.org/">pandas</a> pour … (basé sur Fiona / Shapely / Pyproj)</li>
</ul>
</div><div class="column" style="width:33%;">
<p><img src="./fig/logo-pandas.svg" class="img-fluid"></p>
<p><img src="./fig/logo_geopandas.svg" class="img-fluid"></p>
</div>
</div>
</section>
<section id="le-package-geopandas" class="level2">
<h2 class="anchored" data-anchor-id="le-package-geopandas">Le package <em>GeoPandas</em></h2>
<p>Un projet open source pour faciliter le travail avec des données géospatiales vectorielles en Python. GeoPandas étend Pandas pour permettre de disposer d’un type de colonne géométrique et pour permettre d’effectuer des opérations spatiales. Les opérations géométriques sont réalisées avec <code>shapely</code>, les accès en lecture / écriture aux fichiers utilisent <code>fiona</code> et la visualisation utilise <code>matplotlib</code>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./fig/geopandas-table.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Format des GeoDataFrame</figcaption><p></p>
</figure>
</div>
<ul>
<li>Utilisation :</li>
</ul>
<div class="panel-tabset custom-tab">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" href="">Import et lecture</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false" href="">Affichage</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false" href="">SCR</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" role="tab" aria-controls="tabset-1-4" aria-selected="false" href="">Affichage avec fond de carte</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-5" role="tab" aria-controls="tabset-1-5" aria-selected="false" href="">Centroide</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-6" role="tab" aria-controls="tabset-1-6" aria-selected="false" href="">Boundary</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-7-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-7" role="tab" aria-controls="tabset-1-7" aria-selected="false" href="">Zone tampon</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-8-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-8" role="tab" aria-controls="tabset-1-8" aria-selected="false" href="">Aggrégation</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-9-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-9" role="tab" aria-controls="tabset-1-9" aria-selected="false" href="">Intersection</a></li></ul>
<div class="tab-content custom-tab">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">

</div>
<p>Avec la fonction <code>read_file</code> :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>nybb <span class="op">=</span> gpd.read_file(file_path)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p>Avec la méthode <code>plot</code> des <code>GeoDataFrame</code> :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>nybb.plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="python_files/figure-html/gpd-tuto-plot-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<p>Affichage :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(nybb.crs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>epsg:2263</code></pre>
</div>
</div>
<p>Transformation :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>nybb_geo <span class="op">=</span> nybb.to_crs(<span class="st">'EPSG:4326'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-4-tab">
<p>En utilisant la bibliothèque <code>contextily</code> :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> contextily <span class="im">as</span> cx</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> nybb.to_crs(<span class="st">'EPSG:3857'</span>).plot()</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>cx.add_basemap(ax, source<span class="op">=</span><span class="st">'https://</span><span class="sc">{s}</span><span class="st">.tile.openstreetmap.fr/osmfr/</span><span class="sc">{z}</span><span class="st">/</span><span class="sc">{x}</span><span class="st">/</span><span class="sc">{y}</span><span class="st">.png'</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>ax</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="python_files/figure-html/gpd-tuto-contextily-3.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-1-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-5-tab">
<p>Simplement en utilisant l’attribut <code>centroid</code> des <code>GeoDataFrame</code> :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>nybb.centroid.plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="python_files/figure-html/gpd-tuto-centroid-5.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-1-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-6-tab">
<p>Simplement en utilisant l’attribut <code>boundary</code> des <code>GeoDataFrame</code> :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>nybb.boundary.plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="python_files/figure-html/gpd-tuto-boundary-7.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-1-7" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-7-tab">
<p>En utilisant la méthode <code>buffer</code> des <code>GeoDataFrame</code> :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>buff_nybb <span class="op">=</span> nybb.<span class="bu">buffer</span>(<span class="dv">3000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> buff_nybb.plot(color<span class="op">=</span><span class="st">"red"</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>nybb.plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">"aliceblue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="python_files/figure-html/gpd-tuto-buffer-2-9.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-1-8" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-8-tab">
<p>En utilisant la méthode <code>dissolve</code> des <code>GeoDataFrame</code> :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On peut utiliser dissolve(by="nom_colonne") si on veut aggréger selon les valeurs d'une colonne</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>agg <span class="op">=</span> nybb.dissolve()</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>agg.plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="python_files/figure-html/gpd-tuto-agg-11.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-1-9" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-9-tab">
<p>En utilisant la méthode <code>intersection</code> des <code>GeoDataFrame</code> :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely <span class="im">import</span> wkt</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>point <span class="op">=</span> wkt.loads(<span class="st">'Point(998769.1146889535 174169.7607268664)'</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>intersecting <span class="op">=</span> nybb.intersection(point.<span class="bu">buffer</span>(<span class="dv">35000</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>/home/mthh/env-quarto/lib/python3.10/site-packages/shapely/set_operations.py:133: RuntimeWarning: invalid value encountered in intersection
  return lib.intersection(a, b, **kwargs)</code></pre>
</div>
</div>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> nybb.plot()</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> intersecting.plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">"red"</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>ax</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="python_files/figure-html/gpd-tuto-intersectiob-2-13.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="données-raster" class="level2">
<h2 class="anchored" data-anchor-id="données-raster">Données raster</h2>
<ul>
<li><a href="https://rasterio.readthedocs.io/"><strong>Rasterio</strong></a> :
<ul>
<li>lecture / écriture de raster (<em>wrapper</em> de haut niveau autour de GDAL)</li>
<li>données représentées sous forme d’<code>array</code> NumPy</li>
<li>reprojection</li>
<li><em>resampling</em></li>
<li><em>virtual files</em></li>
<li>etc.</li>
</ul></li>
<li><a href="https://pythonhosted.org/rasterstats/"><strong>Rasterstats</strong></a> :
<ul>
<li>résumer des données raster sur la base de géométries vectorielles</li>
<li>extraction de valeurs à un point précis</li>
</ul></li>
<li><a href="https://docs.xarray.dev/en/stable/"><strong>xarray</strong></a> et <a href="https://corteva.github.io/rioxarray/"><strong>rioxarray</strong></a> :
<ul>
<li><em>xarray</em> pour travailler avec des tableaux multidimensionnels étiquetés</li>
<li><em>rioxarray</em> pour ouvrir des jeux des données raster avec <em>rasterio</em>, les stocker dans le format de <em>xarray</em>, et avoir accès à différentes fonctionnalités de <em>rasterio</em></li>
<li>moins “rustique” que d’utiliser rasterio seul / dépend de l’usage souhaité</li>
</ul></li>
</ul>
</section>
<section id="le-package-rasterio" class="level2">
<h2 class="anchored" data-anchor-id="le-package-rasterio">Le package <em>Rasterio</em></h2>
<p>Exemple d’utilisation :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterio <span class="im">as</span> rio</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rio.<span class="bu">open</span>(<span class="st">'data/MODIS_ARRAY.nc'</span>) <span class="im">as</span> f:</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Métadonnées :</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    metadata <span class="op">=</span> f.meta</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Lire toutes les bandes :</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> f.read()</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ou f.read(1) pour lire seulement la première bande</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Un dictionnaire de méta-données + un tableau NumPy contenant la (ou les) bande(s) :</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(metadata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{'driver': 'netCDF', 'dtype': 'int16', 'nodata': -28672.0, 'width': 200, 'height': 200, 'count': 1, 'crs': CRS.from_wkt('PROJCS["unknown",GEOGCS["unknown",DATUM["unknown",SPHEROID["unknown",6371007.181,0]],PRIMEM["Greenwich",0,AUTHORITY["EPSG","8901"]],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]]],PROJECTION["Sinusoidal"],PARAMETER["longitude_of_center",0],PARAMETER["false_easting",0],PARAMETER["false_northing",0],UNIT["metre",1,AUTHORITY["EPSG","9001"]],AXIS["Easting",EAST],AXIS["Northing",NORTH]]'), 'transform': Affine(231.6563582639561, 0.0, -7274009.649486291,
       0.0, -231.65635826375018, 5050108.61015275)}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[[-28672 -28672 -28672 ...    656    656    554]
  [-28672 -28672 -28672 ...    694    694    642]
  [-28672 -28672 -28672 ...    456    575    642]
  ...
  [   993    817    817 ...    471    479    498]
  [   893    893    816 ...    479    479    469]
  [   816    816    832 ...    515    469    485]]]</code></pre>
</div>
</div>
</section>
<section id="les-package-xarray-et-rioxarray" class="level2">
<h2 class="anchored" data-anchor-id="les-package-xarray-et-rioxarray">Les package <em>xarray</em> et <em>rioxarray</em></h2>
<p>Exemple d’utilisation :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rioxarray</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xarray</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>xds <span class="op">=</span> xarray.open_dataarray(<span class="st">"./data/MODIS_ARRAY.nc"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Un objet de type <code>xarray.DataArray</code> ou <code>xarray.Dataset</code> qui contient les différentes méta-données et les données :</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>xds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewbox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewbox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class="xr-text-repr-fallback">&lt;xarray.DataArray (y: 200, x: 200)&gt;
[40000 values with dtype=float32]
Coordinates:
  * y        (y) float64 5.05e+06 5.05e+06 5.05e+06 ... 5.004e+06 5.004e+06
  * x        (x) float64 -7.274e+06 -7.274e+06 ... -7.228e+06 -7.228e+06
Attributes:
    crs:        +a=6371007.181 +b=6371007.181 +lon_0=0 +no_defs +proj=sinu +u...
    res:        [231.65635826 231.65635826]
    is_tiled:   0
    nodata:     -28672.0
    transform:  [ 2.31656358e+02  0.00000000e+00 -7.27400965e+06  0.00000000e...</pre><div class="xr-wrap" style="display:none"><div class="xr-header"><div class="xr-obj-type">xarray.DataArray</div><div class="xr-array-name"></div><ul class="xr-dim-list"><li><span class="xr-has-index">y</span>: 200</li><li><span class="xr-has-index">x</span>: 200</li></ul></div><ul class="xr-sections"><li class="xr-section-item"><div class="xr-array-wrap"><input id="section-a18e86a6-ecd0-4d70-8ef4-90ad0d0ee0a0" class="xr-array-in" type="checkbox" checked=""><label for="section-a18e86a6-ecd0-4d70-8ef4-90ad0d0ee0a0" title="Show/hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-array-preview xr-preview"><span>...</span></div><div class="xr-array-data"><pre>[40000 values with dtype=float32]</pre></div></div></li><li class="xr-section-item"><input id="section-c65c2d0b-a0c1-4dfb-8e62-38af275a1440" class="xr-section-summary-in" type="checkbox" checked=""><label for="section-c65c2d0b-a0c1-4dfb-8e62-38af275a1440" class="xr-section-summary">Coordinates: <span>(2)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><ul class="xr-var-list"><li class="xr-var-item"><div class="xr-var-name"><span class="xr-has-index">y</span></div><div class="xr-var-dims">(y)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">5.05e+06 5.05e+06 ... 5.004e+06</div><input id="attrs-c5381907-4cba-4b71-bea6-ccd338652b8e" class="xr-var-attrs-in" type="checkbox"><label for="attrs-c5381907-4cba-4b71-bea6-ccd338652b8e" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-dea72dec-6d68-4ca1-8fee-7b7fd3ff46ff" class="xr-var-data-in" type="checkbox"><label for="data-dea72dec-6d68-4ca1-8fee-7b7fd3ff46ff" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>axis :</span></dt><dd>Y</dd><dt><span>long_name :</span></dt><dd>y coordinate of projection</dd><dt><span>standard_name :</span></dt><dd>projection_y_coordinate</dd><dt><span>units :</span></dt><dd>metre</dd></dl></div><div class="xr-var-data"><pre>array([5049992.781974, 5049761.125615, 5049529.469257, 5049297.812899,
       5049066.156541, 5048834.500182, 5048602.843824, 5048371.187466,
       5048139.531108, 5047907.874749, 5047676.218391, 5047444.562033,
       5047212.905674, 5046981.249316, 5046749.592958, 5046517.9366  ,
       5046286.280241, 5046054.623883, 5045822.967525, 5045591.311167,
       5045359.654808, 5045127.99845 , 5044896.342092, 5044664.685734,
       5044433.029375, 5044201.373017, 5043969.716659, 5043738.0603  ,
       5043506.403942, 5043274.747584, 5043043.091226, 5042811.434867,
       5042579.778509, 5042348.122151, 5042116.465793, 5041884.809434,
       5041653.153076, 5041421.496718, 5041189.84036 , 5040958.184001,
       5040726.527643, 5040494.871285, 5040263.214927, 5040031.558568,
       5039799.90221 , 5039568.245852, 5039336.589493, 5039104.933135,
       5038873.276777, 5038641.620419, 5038409.96406 , 5038178.307702,
       5037946.651344, 5037714.994986, 5037483.338627, 5037251.682269,
       5037020.025911, 5036788.369553, 5036556.713194, 5036325.056836,
       5036093.400478, 5035861.74412 , 5035630.087761, 5035398.431403,
       5035166.775045, 5034935.118686, 5034703.462328, 5034471.80597 ,
       5034240.149612, 5034008.493253, 5033776.836895, 5033545.180537,
       5033313.524179, 5033081.86782 , 5032850.211462, 5032618.555104,
       5032386.898746, 5032155.242387, 5031923.586029, 5031691.929671,
       5031460.273313, 5031228.616954, 5030996.960596, 5030765.304238,
       5030533.647879, 5030301.991521, 5030070.335163, 5029838.678805,
       5029607.022446, 5029375.366088, 5029143.70973 , 5028912.053372,
       5028680.397013, 5028448.740655, 5028217.084297, 5027985.427939,
       5027753.77158 , 5027522.115222, 5027290.458864, 5027058.802506,
       5026827.146147, 5026595.489789, 5026363.833431, 5026132.177072,
       5025900.520714, 5025668.864356, 5025437.207998, 5025205.551639,
       5024973.895281, 5024742.238923, 5024510.582565, 5024278.926206,
       5024047.269848, 5023815.61349 , 5023583.957132, 5023352.300773,
       5023120.644415, 5022888.988057, 5022657.331698, 5022425.67534 ,
       5022194.018982, 5021962.362624, 5021730.706265, 5021499.049907,
       5021267.393549, 5021035.737191, 5020804.080832, 5020572.424474,
       5020340.768116, 5020109.111758, 5019877.455399, 5019645.799041,
       5019414.142683, 5019182.486325, 5018950.829966, 5018719.173608,
       5018487.51725 , 5018255.860891, 5018024.204533, 5017792.548175,
       5017560.891817, 5017329.235458, 5017097.5791  , 5016865.922742,
       5016634.266384, 5016402.610025, 5016170.953667, 5015939.297309,
       5015707.640951, 5015475.984592, 5015244.328234, 5015012.671876,
       5014781.015518, 5014549.359159, 5014317.702801, 5014086.046443,
       5013854.390084, 5013622.733726, 5013391.077368, 5013159.42101 ,
       5012927.764651, 5012696.108293, 5012464.451935, 5012232.795577,
       5012001.139218, 5011769.48286 , 5011537.826502, 5011306.170144,
       5011074.513785, 5010842.857427, 5010611.201069, 5010379.544711,
       5010147.888352, 5009916.231994, 5009684.575636, 5009452.919277,
       5009221.262919, 5008989.606561, 5008757.950203, 5008526.293844,
       5008294.637486, 5008062.981128, 5007831.32477 , 5007599.668411,
       5007368.012053, 5007136.355695, 5006904.699337, 5006673.042978,
       5006441.38662 , 5006209.730262, 5005978.073904, 5005746.417545,
       5005514.761187, 5005283.104829, 5005051.44847 , 5004819.792112,
       5004588.135754, 5004356.479396, 5004124.823037, 5003893.166679])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span class="xr-has-index">x</span></div><div class="xr-var-dims">(x)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">-7.274e+06 ... -7.228e+06</div><input id="attrs-8e30ea44-5636-4a69-9ca3-c36fa7020412" class="xr-var-attrs-in" type="checkbox"><label for="attrs-8e30ea44-5636-4a69-9ca3-c36fa7020412" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-5671d296-2114-4013-b06e-0635249e3c83" class="xr-var-data-in" type="checkbox"><label for="data-5671d296-2114-4013-b06e-0635249e3c83" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>axis :</span></dt><dd>X</dd><dt><span>long_name :</span></dt><dd>x coordinate of projection</dd><dt><span>standard_name :</span></dt><dd>projection_x_coordinate</dd><dt><span>units :</span></dt><dd>metre</dd></dl></div><div class="xr-var-data"><pre>array([-7273893.821307, -7273662.164949, -7273430.508591, -7273198.852232,
       -7272967.195874, -7272735.539516, -7272503.883158, -7272272.226799,
       -7272040.570441, -7271808.914083, -7271577.257725, -7271345.601366,
       -7271113.945008, -7270882.28865 , -7270650.632291, -7270418.975933,
       -7270187.319575, -7269955.663217, -7269724.006858, -7269492.3505  ,
       -7269260.694142, -7269029.037784, -7268797.381425, -7268565.725067,
       -7268334.068709, -7268102.412351, -7267870.755992, -7267639.099634,
       -7267407.443276, -7267175.786918, -7266944.130559, -7266712.474201,
       -7266480.817843, -7266249.161484, -7266017.505126, -7265785.848768,
       -7265554.19241 , -7265322.536051, -7265090.879693, -7264859.223335,
       -7264627.566977, -7264395.910618, -7264164.25426 , -7263932.597902,
       -7263700.941544, -7263469.285185, -7263237.628827, -7263005.972469,
       -7262774.31611 , -7262542.659752, -7262311.003394, -7262079.347036,
       -7261847.690677, -7261616.034319, -7261384.377961, -7261152.721603,
       -7260921.065244, -7260689.408886, -7260457.752528, -7260226.09617 ,
       -7259994.439811, -7259762.783453, -7259531.127095, -7259299.470737,
       -7259067.814378, -7258836.15802 , -7258604.501662, -7258372.845303,
       -7258141.188945, -7257909.532587, -7257677.876229, -7257446.21987 ,
       -7257214.563512, -7256982.907154, -7256751.250796, -7256519.594437,
       -7256287.938079, -7256056.281721, -7255824.625363, -7255592.969004,
       -7255361.312646, -7255129.656288, -7254897.99993 , -7254666.343571,
       -7254434.687213, -7254203.030855, -7253971.374496, -7253739.718138,
       -7253508.06178 , -7253276.405422, -7253044.749063, -7252813.092705,
       -7252581.436347, -7252349.779989, -7252118.12363 , -7251886.467272,
       -7251654.810914, -7251423.154556, -7251191.498197, -7250959.841839,
       -7250728.185481, -7250496.529122, -7250264.872764, -7250033.216406,
       -7249801.560048, -7249569.903689, -7249338.247331, -7249106.590973,
       -7248874.934615, -7248643.278256, -7248411.621898, -7248179.96554 ,
       -7247948.309182, -7247716.652823, -7247484.996465, -7247253.340107,
       -7247021.683749, -7246790.02739 , -7246558.371032, -7246326.714674,
       -7246095.058315, -7245863.401957, -7245631.745599, -7245400.089241,
       -7245168.432882, -7244936.776524, -7244705.120166, -7244473.463808,
       -7244241.807449, -7244010.151091, -7243778.494733, -7243546.838375,
       -7243315.182016, -7243083.525658, -7242851.8693  , -7242620.212942,
       -7242388.556583, -7242156.900225, -7241925.243867, -7241693.587508,
       -7241461.93115 , -7241230.274792, -7240998.618434, -7240766.962075,
       -7240535.305717, -7240303.649359, -7240071.993001, -7239840.336642,
       -7239608.680284, -7239377.023926, -7239145.367568, -7238913.711209,
       -7238682.054851, -7238450.398493, -7238218.742135, -7237987.085776,
       -7237755.429418, -7237523.77306 , -7237292.116701, -7237060.460343,
       -7236828.803985, -7236597.147627, -7236365.491268, -7236133.83491 ,
       -7235902.178552, -7235670.522194, -7235438.865835, -7235207.209477,
       -7234975.553119, -7234743.896761, -7234512.240402, -7234280.584044,
       -7234048.927686, -7233817.271327, -7233585.614969, -7233353.958611,
       -7233122.302253, -7232890.645894, -7232658.989536, -7232427.333178,
       -7232195.67682 , -7231964.020461, -7231732.364103, -7231500.707745,
       -7231269.051387, -7231037.395028, -7230805.73867 , -7230574.082312,
       -7230342.425954, -7230110.769595, -7229879.113237, -7229647.456879,
       -7229415.80052 , -7229184.144162, -7228952.487804, -7228720.831446,
       -7228489.175087, -7228257.518729, -7228025.862371, -7227794.206013])</pre></div></li></ul></div></li><li class="xr-section-item"><input id="section-7fc8fb75-ea29-4945-b79d-3f60a6cd4ab1" class="xr-section-summary-in" type="checkbox"><label for="section-7fc8fb75-ea29-4945-b79d-3f60a6cd4ab1" class="xr-section-summary">Indexes: <span>(2)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><ul class="xr-var-list"><li class="xr-var-item"><div class="xr-index-name"><div>y</div></div><div class="xr-index-preview">PandasIndex</div><div></div><input id="index-7e501dd8-fa0c-4aff-ae03-8edd996df39a" class="xr-index-data-in" type="checkbox"><label for="index-7e501dd8-fa0c-4aff-ae03-8edd996df39a" title="Show/Hide index repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-index-data"><pre>PandasIndex(Index([ 5049992.781973618,  5049761.125615354,   5049529.46925709,  5049297.812898827,  5049066.156540562,  5048834.500182299, 5048602.8438240355,  5048371.187465771,  5048139.531107508,  5047907.874749244,
       ...
        5005978.073903505,  5005746.417545241,  5005514.761186978,  5005283.104828713,   5005051.44847045,  5004819.792112187,  5004588.135753923,  5004356.479395659,  5004124.823037395,  5003893.166679132], dtype='float64', name='y', length=200))</pre></div></li><li class="xr-var-item"><div class="xr-index-name"><div>x</div></div><div class="xr-index-preview">PandasIndex</div><div></div><input id="index-d5acab49-3316-4100-90e4-fa628e805b82" class="xr-index-data-in" type="checkbox"><label for="index-d5acab49-3316-4100-90e4-fa628e805b82" title="Show/Hide index repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-index-data"><pre>PandasIndex(Index([ -7273893.821307159,  -7273662.164948896,  -7273430.508590631,  -7273198.852232368,  -7272967.195874103,   -7272735.53951584, -7272503.8831575755,  -7272272.226799311,  -7272040.570441048,  -7271808.914082783,
       ...
       -7229879.1132370075,  -7229647.456878743,   -7229415.80052048,  -7229184.144162215,  -7228952.487803951,  -7228720.831445687,  -7228489.175087423,   -7228257.51872916,  -7228025.862370895,  -7227794.206012632], dtype='float64', name='x', length=200))</pre></div></li></ul></div></li><li class="xr-section-item"><input id="section-711c59f7-c967-4b95-b878-35862183dbd3" class="xr-section-summary-in" type="checkbox" checked=""><label for="section-711c59f7-c967-4b95-b878-35862183dbd3" class="xr-section-summary">Attributes: <span>(5)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><dl class="xr-attrs"><dt><span>crs :</span></dt><dd>+a=6371007.181 +b=6371007.181 +lon_0=0 +no_defs +proj=sinu +units=m +x_0=0 +y_0=0</dd><dt><span>res :</span></dt><dd>[231.65635826 231.65635826]</dd><dt><span>is_tiled :</span></dt><dd>0</dd><dt><span>nodata :</span></dt><dd>-28672.0</dd><dt><span>transform :</span></dt><dd>[ 2.31656358e+02  0.00000000e+00 -7.27400965e+06  0.00000000e+00
 -2.31656358e+02  5.05010861e+06  0.00000000e+00  0.00000000e+00
  1.00000000e+00]</dd></dl></div></li></ul></div></div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Interpolate missing data:</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>filled <span class="op">=</span> xds.rio.interpolate_na()</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">5</span>))</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>ax1, ax2 <span class="op">=</span> (fig.add_subplot(<span class="dv">131</span>), fig.add_subplot(<span class="dv">133</span>))</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>xds.isel(x<span class="op">=</span><span class="bu">slice</span>(<span class="dv">0</span>, <span class="dv">20</span>), y<span class="op">=</span><span class="bu">slice</span>(<span class="dv">0</span>, <span class="dv">20</span>)).plot(ax<span class="op">=</span>ax1)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>filled.isel(x<span class="op">=</span><span class="bu">slice</span>(<span class="dv">0</span>, <span class="dv">20</span>), y<span class="op">=</span><span class="bu">slice</span>(<span class="dv">0</span>, <span class="dv">20</span>)).plot(ax<span class="op">=</span>ax2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="python_files/figure-html/example-rioxarray-3-15.png" class="img-fluid" width="1440"></p>
</div>
</div>
</section>
<section id="analyse-spatiale" class="level2">
<h2 class="anchored" data-anchor-id="analyse-spatiale">Analyse spatiale</h2>
<div class="columns">
<div class="column" style="width:80%;">
<p>Écosystème de bibliothèques pour l’analyse spatiale <a href="https://pysal.org/">PySAL</a> (Python Spatial Analysis Library) :</p>
<ul>
<li><strong>Explorer</strong>:
<ul>
<li>Analyse exploratoire des données spatiales (package <a href="https://pysal.org/esda/">esda</a>)</li>
<li>Analyse de la dynamique des données spatiales longitudinales (package <a href="https://pysal.org/giddy/">giddy</a>)</li>
<li>Mesure des inégalités dans l’espace et dans le temps (package <a href="https://inequality.readthedocs.io/en/latest/">inequality</a>)</li>
<li>Analyse statistique de motifs ponctuels planaires (package <a href="https://pysal.org/pointpats/">pointpats</a>)</li>
<li>Mesure de la ségrégation dans le temps et dans l’espace (package <a href="https://pysal.org/segregation/">segregation</a>)</li>
<li>Morphométrie urbaine (package <a href="https://docs.momepy.org/en/stable/">momepy</a>)</li>
</ul></li>
<li><strong>Modéliser</strong>:
<ul>
<li>Régression géographiquement pondérée à plusieurs échelles (package <a href="https://mgwr.readthedocs.io/en/latest/">mgwr</a>)</li>
<li>Modèles linéaires généralisés épars (package <a href="https://spglm.readthedocs.io/en/latest/">spglm</a>)</li>
<li>Modèles d’interaction spatiale (package <a href="https://spint.readthedocs.io/en/latest/">spint</a>)</li>
<li>Modèles de régression spatiale (package <a href="https://spreg.readthedocs.io/en/latest/">spreg</a>)</li>
<li>Modèles de composantes de variance à corrélation spatiale à plusieurs niveaux (package <a href="https://github.com/pysal/spvcm">spvcm</a>)</li>
<li><em>Areal interpolation</em> et cartographie dasymétrique (package <a href="https://pysal.org/tobler/">tobler</a>)</li>
<li>Accessibilité spatiale (package <a href="https://pysal.org/access/">access</a>)</li>
<li>Optimisation spatiale (package <a href="https://pysal.org/spopt/">spopt</a>)</li>
</ul></li>
</ul>
</div><div class="column" style="width:20%;">
<p><img src="./fig/logo-pysal.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="autres-packages-utiles" class="level2">
<h2 class="anchored" data-anchor-id="autres-packages-utiles">Autres packages utiles …</h2>
<ul>
<li>Binding Python pour <a href="https://grass.osgeo.org/grass82/manuals/libpython/index.html">GRASS</a> + Intégration dans les notebooks Jupyter</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./fig/grass_jupyter_combo_vis.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Source: <a href="https://grass.osgeo.org/news/2022_06_05_results_student_grant_caitlin/" class="uri">https://grass.osgeo.org/news/2022_06_05_results_student_grant_caitlin/</a></figcaption><p></p>
</figure>
</div>
<ul>
<li><p><a href="https://scitools-iris.readthedocs.io/en/stable/">Iris</a></p></li>
<li><p>Pour la cartographie : <a href="https://scitools.org.uk/cartopy/docs/latest/">cartopy</a> ; <a href="https://geoviews.org/">geoviews</a> et <a href="https://residentmario.github.io/geoplot/">geoplot</a> basés sur <em>cartopy</em> ; <a href="https://www.pygmt.org/latest/">PyGMT</a> (selon les usages - pas de solution aussi aboutie que <code>mapsf</code> pour les cartes réalisées en SHS).</p></li>
</ul>
<p><img src="./fig/cartopy.png" class="img-fluid"></p>
</section>
<section id="ressources-python-géospatial" class="level2">
<h2 class="anchored" data-anchor-id="ressources-python-géospatial">Ressources Python Géospatial</h2>
<ul>
<li><p><a href="https://py.geocompx.org/">https://py.geocompx.org/</a></p></li>
<li><p><a href="https://automating-gis-processes.github.io">https://automating-gis-processes.github.io</a></p></li>
<li><p><a href="https://www.earthdatascience.org/courses/use-data-open-source-python/">https://www.earthdatascience.org/courses/use-data-open-source-python/</a></p></li>
<li><p><a href="https://geographicdata.science/book/intro.html">https://geographicdata.science/book/intro.html</a></p></li>
</ul>
</section>
<section id="interaction-r-python-dans-quarto" class="level2">
<h2 class="anchored" data-anchor-id="interaction-r-python-dans-quarto">Interaction R ⇄ Python dans Quarto</h2>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true" href="">R → Python</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false" href="">Python → R</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<ul>
<li>Définition de variables dans un chunk R :</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">42</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">13</span>, <span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Récupération depuis un chunk Python :</li>
</ul>
<p><em>en utilisant la variable <code>r</code>, un point, et le nom de la variable R à récupérer</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(r.a)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>42.0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(r.b)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1.0, 2.0, 3.0]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(r.c)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[12.0, 13.0, 14.0]</code></pre>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<ul>
<li>Définition de variables dans un chunk Python :</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> <span class="dv">42</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Récupération depuis un chunk R :</li>
</ul>
<p><em>en utilisant la variable <code>py</code>, un dollar <code>$</code>, et le nom de la variable Python à récupérer</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(py<span class="sc">$</span>a)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 42</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(py<span class="sc">$</span>b)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 2 3</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="interaction-r-python-dans-quarto-suite" class="level2">
<h2 class="anchored" data-anchor-id="interaction-r-python-dans-quarto-suite">Interaction R ⇄ Python dans Quarto (suite)</h2>
<ul>
<li>Il est possible d’échanger des types plus complexes (<code>data.frame</code> ⇄ <code>DataFrame</code> pandas, tableau numpy, etc.)</li>
</ul>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true" href="">R → Python</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false" href="">Python → R</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<ul>
<li>Depuis un chunk R :</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>   <span class="at">emp_id =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>),</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">emp_name =</span> <span class="fu">c</span>(<span class="st">"Rick"</span>,<span class="st">"Dan"</span>,<span class="st">"Michelle"</span>,<span class="st">"Ryan"</span>,<span class="st">"Jane"</span>),</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>   <span class="at">salary =</span> <span class="fu">c</span>(<span class="fl">623.3</span>,<span class="fl">515.2</span>,<span class="fl">611.0</span>,<span class="fl">729.0</span>,<span class="fl">843.25</span>),</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>   <span class="at">start_date =</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="st">"2012-01-01"</span>, <span class="st">"2013-09-23"</span>, <span class="st">"2014-11-15"</span>, <span class="st">"2014-05-11"</span>, <span class="st">"2015-03-27"</span>)),</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>   <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Récupération depuis un chunk Python :</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> r.df</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   emp_id  emp_name  salary  start_date
0       1      Rick  623.30  2012-01-01
1       2       Dan  515.20  2013-09-23
2       3  Michelle  611.00  2014-11-15
3       4      Ryan  729.00  2014-05-11
4       5      Jane  843.25  2015-03-27</code></pre>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<ul>
<li>Depuis un chunk Python :</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> pd.DataFrame({</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"emp_id"</span>: <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">5</span>)),</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"emp_name"</span>: [<span class="st">"Rick"</span>, <span class="st">"Dan"</span>, <span class="st">"Michelle"</span>, <span class="st">"Ryan"</span>, <span class="st">"Jane"</span>],</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"salary"</span>: [<span class="fl">623.3</span>, <span class="fl">515.2</span>, <span class="fl">611.0</span>, <span class="fl">729.0</span>, <span class="fl">843.25</span>],</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"start_date"</span>: pd.to_datetime([<span class="st">"2012-01-01"</span>, <span class="st">"2013-09-23"</span>, <span class="st">"2014-11-15"</span>, <span class="st">"2014-05-11"</span>, <span class="st">"2015-03-27"</span>]),</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>arr <span class="op">=</span> np.array([[<span class="dv">12</span>, <span class="dv">47</span>], [<span class="dv">34</span>, <span class="dv">90</span>], [<span class="dv">23</span>, <span class="dv">19</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Utilisation depuis un chunk R :</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(py<span class="sc">$</span>df2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  emp_id emp_name salary          start_date
1      0     Rick 623.30 2012-01-01 01:00:00
2      1      Dan 515.20 2013-09-23 02:00:00
3      2 Michelle 611.00 2014-11-15 01:00:00
4      3     Ryan 729.00 2014-05-11 02:00:00
5      4     Jane 843.25 2015-03-27 01:00:00</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(py<span class="sc">$</span>arr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,]   12   47
[2,]   34   90
[3,]   23   19</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="interaction-r-python-dans-quarto-suite-1" class="level2">
<h2 class="anchored" data-anchor-id="interaction-r-python-dans-quarto-suite-1">Interaction R ⇄ Python dans Quarto (suite)</h2>
<p>Et pour les objets spatiaux ? (<em>sf</em> / <em>geopandas</em>)</p>
<ul>
<li><p>Si la conversion <code>data.frame</code> ⇄ <code>DataFrame</code> est transparente, il n’en est pas de même pour les dataframe avec une composante spatiale (perte de la dimension spatiale / colonne <code>geometry</code> contient désormais …)</p></li>
<li><p>L’écriture d’une petite function permet de résoudre ça :</p></li>
</ul>
<div class="cell">

</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.geometry <span class="im">import</span> shape</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> restore_geodataframe(df, crs, geom_type):</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  geom <span class="op">=</span> df.geometry.<span class="bu">apply</span>(<span class="kw">lambda</span> coords: shape({ <span class="st">"type"</span>: geom_type, <span class="st">"coordinates"</span>: coords }))</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  gdf <span class="op">=</span> gpd.GeoDataFrame(df.drop([<span class="st">'geometry'</span>], axis<span class="op">=</span><span class="dv">1</span>), geometry<span class="op">=</span>geom)</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  gdf.set_crs(crs, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> gdf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ainsi, les objets <code>sf</code> pourront être convertis en <code>GeoDataFrame</code> ainsi :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>mrc <span class="op">=</span> restore_geodataframe(r.mrc, r.crs, <span class="st">"MultiPolygon"</span>)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>mrc.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  MUS_CO_MRC                                    MUS_NM_MRC                       MUS_NM_REG                                           geometry
0         01  Communauté maritime des Îles-de-la-Madeleine  Gaspésie - Îles-de-la-Madeleine  MULTIPOLYGON (((505936.000 400484.000, 503752....
1         02                               Le Rocher-Percé  Gaspésie - Îles-de-la-Madeleine  MULTIPOLYGON (((288282.000 493474.000, 281197....
2         03                              La Côte-de-Gaspé  Gaspésie - Îles-de-la-Madeleine  MULTIPOLYGON (((252570.000 528170.000, 252646....
3         04                             La Haute-Gaspésie  Gaspésie - Îles-de-la-Madeleine  MULTIPOLYGON (((120775.000 563455.000, 122763....
4         05                                   Bonaventure  Gaspésie - Îles-de-la-Madeleine  MULTIPOLYGON (((163436.000 501024.000, 187515....</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>resto <span class="op">=</span> restore_geodataframe(r.resto, r.crs, <span class="st">"Point"</span>)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>resto.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      osm_id         name     cuisine                        geometry
0  291667452    Chez Cora          NA  POINT (-205284.124 320601.265)
1  295803248    Normandin          NA  POINT (-221931.609 321452.378)
2  345886369  Chez Victor      burger  POINT (-207712.728 315587.610)
3  386267989       Ly-Hai  vietnamese  POINT (-207895.478 315365.940)
4  393559700       Mike's     italian  POINT (-217665.483 319360.818)</code></pre>
</div>
</div>
</section>
<section id="python-quarto-et-interactivité" class="level2">
<h2 class="anchored" data-anchor-id="python-quarto-et-interactivité">Python, Quarto et interactivité</h2>
<ul>
<li><p>Utilisation des widgets Jupyter possible (seulement is utilisation de l’engin de rendu <code>jupyter</code>, pas avec <code>knitr</code> - i.e.&nbsp;l’inverse des <em>htmlwidgets</em> en R qui ne fonctionne que si <code>knitr</code> est utilisé)</p></li>
<li><p>Exemple :</p></li>
</ul>
<p><img src="./fig/example-quarto-jupyter-widgets.jpg" class="img-fluid"></p>
<ul>
<li>Documentation : <a href="https://quarto.org/docs/interactive/widgets/jupyter.html">https://quarto.org/docs/interactive/widgets/jupyter.html</a></li>
</ul>
</section>
<section id="exemples-danalyse-sur-les-données-du-québec" class="level2">
<h2 class="anchored" data-anchor-id="exemples-danalyse-sur-les-données-du-québec">Exemples d’analyse sur les données du Québec</h2>
<ul>
<li>Les imports nécessaires :</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterio <span class="im">as</span> rio</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rioxarray</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xarray</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.warp <span class="im">import</span> calculate_default_transform, reproject, Resampling</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot <span class="im">as</span> plt</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.plot <span class="im">import</span> show</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.mask <span class="im">import</span> mask</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterstats <span class="im">import</span> zonal_stats, point_query</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>On récupère les jeux de données et quelques autres infos (SRC, etc.) depuis l’environnement R :</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Le SCR des données</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>dst_crs <span class="op">=</span> r.crs</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="co"># On récupère le jeu de données "mrc" et le jeu de données "resto"</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>mrc <span class="op">=</span> restore_geodataframe(r.mrc, dst_crs, <span class="st">"MultiPolygon"</span>)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>resto <span class="op">=</span> restore_geodataframe(r.resto, dst_crs, <span class="st">"Point"</span>)</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>reg <span class="op">=</span> mrc.dissolve(by<span class="op">=</span><span class="st">"MUS_NM_REG"</span>)</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>sel <span class="op">=</span> r.sel <span class="co"># Québec</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Chemin du jeu de données raster</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a><span class="co"># et du fichier contenant les descriptions des catégories</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>lc_fp <span class="op">=</span> <span class="st">'../../Téléchargements/T01_PROVINCE.tif'</span></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>lc_categories_fp <span class="op">=</span> <span class="st">'../../Téléchargements/correspondance_raster_CL_COUV.dbf'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>On extrait les entités correspondantes et on les affiche, relativement au reste de la province :</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>extract <span class="op">=</span> mrc[mrc.MUS_NM_MRC <span class="op">==</span> sel]</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> mrc.plot(color<span class="op">=</span><span class="st">"lightblue"</span>, edgecolor<span class="op">=</span><span class="st">"grey"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">12</span>))</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> reg.plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="va">None</span>, edgecolor<span class="op">=</span><span class="st">"orange"</span>, alpha<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> extract.plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">"red"</span>)</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>ax</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="python_files/figure-html/demo-first-plot-1.png" class="img-fluid" width="1536"></p>
</div>
</div>
<ul>
<li>Ouverture et reprojection d’un jeu de données raster (avec <em>rioxarray</em>) :</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>xds <span class="op">=</span> rioxarray.open_rasterio(lc_fp)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>xds <span class="op">=</span> xds.rio.reproject(dst_crs)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>xds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewbox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewbox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class="xr-text-repr-fallback">&lt;xarray.DataArray (band: 1, y: 23726, x: 28690)&gt;
array([[[255, 255, 255, ..., 255, 255, 255],
        [255, 255, 255, ..., 255, 255, 255],
        [255, 255, 255, ..., 255, 255, 255],
        ...,
        [255, 255, 255, ..., 255, 255, 255],
        [255, 255, 255, ..., 255, 255, 255],
        [255, 255, 255, ..., 255, 255, 255]]], dtype=uint8)
Coordinates:
  * x            (x) float64 -8.306e+05 -8.305e+05 ... 6.038e+05 6.039e+05
  * y            (y) float64 1.303e+06 1.303e+06 ... 1.173e+05 1.172e+05
  * band         (band) int64 1
    spatial_ref  int64 0
Attributes: (12/13)
    AREA_OR_POINT:             Area
    RepresentationType:        THEMATIC
    STATISTICS_COVARIANCES:    5.53386940676013
    STATISTICS_MAXIMUM:        11
    STATISTICS_MEAN:           6.4740178066376
    STATISTICS_MINIMUM:        1
    ...                        ...
    STATISTICS_SKIPFACTORY:    1
    STATISTICS_STDDEV:         2.3524177748412
    STATISTICS_VALID_PERCENT:  41.95
    scale_factor:              1.0
    add_offset:                0.0
    _FillValue:                255</pre><div class="xr-wrap" style="display:none"><div class="xr-header"><div class="xr-obj-type">xarray.DataArray</div><div class="xr-array-name"></div><ul class="xr-dim-list"><li><span class="xr-has-index">band</span>: 1</li><li><span class="xr-has-index">y</span>: 23726</li><li><span class="xr-has-index">x</span>: 28690</li></ul></div><ul class="xr-sections"><li class="xr-section-item"><div class="xr-array-wrap"><input id="section-74344df0-6cb5-452e-b81b-75fea71d29c8" class="xr-array-in" type="checkbox" checked=""><label for="section-74344df0-6cb5-452e-b81b-75fea71d29c8" title="Show/hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-array-preview xr-preview"><span>255 255 255 255 255 255 255 255 ... 255 255 255 255 255 255 255 255</span></div><div class="xr-array-data"><pre>array([[[255, 255, 255, ..., 255, 255, 255],
        [255, 255, 255, ..., 255, 255, 255],
        [255, 255, 255, ..., 255, 255, 255],
        ...,
        [255, 255, 255, ..., 255, 255, 255],
        [255, 255, 255, ..., 255, 255, 255],
        [255, 255, 255, ..., 255, 255, 255]]], dtype=uint8)</pre></div></div></li><li class="xr-section-item"><input id="section-ec55b75c-e6f4-492d-9e9c-b0384890ae75" class="xr-section-summary-in" type="checkbox" checked=""><label for="section-ec55b75c-e6f4-492d-9e9c-b0384890ae75" class="xr-section-summary">Coordinates: <span>(4)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><ul class="xr-var-list"><li class="xr-var-item"><div class="xr-var-name"><span class="xr-has-index">x</span></div><div class="xr-var-dims">(x)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">-8.306e+05 -8.305e+05 ... 6.039e+05</div><input id="attrs-d6eb7ddf-180a-47bf-a2bf-852798837892" class="xr-var-attrs-in" type="checkbox"><label for="attrs-d6eb7ddf-180a-47bf-a2bf-852798837892" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-5f58c0a1-474e-45c3-8776-4a3596f23f4a" class="xr-var-data-in" type="checkbox"><label for="data-5f58c0a1-474e-45c3-8776-4a3596f23f4a" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>axis :</span></dt><dd>X</dd><dt><span>long_name :</span></dt><dd>x coordinate of projection</dd><dt><span>standard_name :</span></dt><dd>projection_x_coordinate</dd><dt><span>units :</span></dt><dd>metre</dd></dl></div><div class="xr-var-data"><pre>array([-830559.8693, -830509.8693, -830459.8693, ...,  603790.1307,
        603840.1307,  603890.1307])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span class="xr-has-index">y</span></div><div class="xr-var-dims">(y)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">1.303e+06 1.303e+06 ... 1.172e+05</div><input id="attrs-0e1213c9-fa2a-463c-8992-5bba549f430b" class="xr-var-attrs-in" type="checkbox"><label for="attrs-0e1213c9-fa2a-463c-8992-5bba549f430b" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-e1a351af-92d7-468d-837f-fca89dc5c8b2" class="xr-var-data-in" type="checkbox"><label for="data-e1a351af-92d7-468d-837f-fca89dc5c8b2" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>axis :</span></dt><dd>Y</dd><dt><span>long_name :</span></dt><dd>y coordinate of projection</dd><dt><span>standard_name :</span></dt><dd>projection_y_coordinate</dd><dt><span>units :</span></dt><dd>metre</dd></dl></div><div class="xr-var-data"><pre>array([1303477.2747, 1303427.2747, 1303377.2747, ...,  117327.2747,
        117277.2747,  117227.2747])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span class="xr-has-index">band</span></div><div class="xr-var-dims">(band)</div><div class="xr-var-dtype">int64</div><div class="xr-var-preview xr-preview">1</div><input id="attrs-9cd2bdc1-998e-4955-bba1-05215aa36036" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-9cd2bdc1-998e-4955-bba1-05215aa36036" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-06fdc15c-91f1-4921-939e-7e1b9c6de951" class="xr-var-data-in" type="checkbox"><label for="data-06fdc15c-91f1-4921-939e-7e1b9c6de951" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([1])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>spatial_ref</span></div><div class="xr-var-dims">()</div><div class="xr-var-dtype">int64</div><div class="xr-var-preview xr-preview">0</div><input id="attrs-a85160b9-7ee2-44e1-9f4f-b05542e6b38d" class="xr-var-attrs-in" type="checkbox"><label for="attrs-a85160b9-7ee2-44e1-9f4f-b05542e6b38d" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-7becced2-f0d3-4c83-a33f-150423a4d67d" class="xr-var-data-in" type="checkbox"><label for="data-7becced2-f0d3-4c83-a33f-150423a4d67d" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>crs_wkt :</span></dt><dd>PROJCS["NAD83 / Quebec Albers",GEOGCS["NAD83",DATUM["North_American_Datum_1983",SPHEROID["GRS 1980",6378137,298.257222101,AUTHORITY["EPSG","7019"]],AUTHORITY["EPSG","6269"]],PRIMEM["Greenwich",0,AUTHORITY["EPSG","8901"]],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]],AUTHORITY["EPSG","4269"]],PROJECTION["Albers_Conic_Equal_Area"],PARAMETER["latitude_of_center",44],PARAMETER["longitude_of_center",-68.5],PARAMETER["standard_parallel_1",60],PARAMETER["standard_parallel_2",46],PARAMETER["false_easting",0],PARAMETER["false_northing",0],UNIT["metre",1,AUTHORITY["EPSG","9001"]],AXIS["Easting",EAST],AXIS["Northing",NORTH],AUTHORITY["EPSG","6623"]]</dd><dt><span>semi_major_axis :</span></dt><dd>6378137.0</dd><dt><span>semi_minor_axis :</span></dt><dd>6356752.314140356</dd><dt><span>inverse_flattening :</span></dt><dd>298.257222101</dd><dt><span>reference_ellipsoid_name :</span></dt><dd>GRS 1980</dd><dt><span>longitude_of_prime_meridian :</span></dt><dd>0.0</dd><dt><span>prime_meridian_name :</span></dt><dd>Greenwich</dd><dt><span>geographic_crs_name :</span></dt><dd>NAD83</dd><dt><span>horizontal_datum_name :</span></dt><dd>North American Datum 1983</dd><dt><span>projected_crs_name :</span></dt><dd>NAD83 / Quebec Albers</dd><dt><span>grid_mapping_name :</span></dt><dd>albers_conical_equal_area</dd><dt><span>standard_parallel :</span></dt><dd>(60.0, 46.0)</dd><dt><span>latitude_of_projection_origin :</span></dt><dd>44.0</dd><dt><span>longitude_of_central_meridian :</span></dt><dd>-68.5</dd><dt><span>false_easting :</span></dt><dd>0.0</dd><dt><span>false_northing :</span></dt><dd>0.0</dd><dt><span>spatial_ref :</span></dt><dd>PROJCS["NAD83 / Quebec Albers",GEOGCS["NAD83",DATUM["North_American_Datum_1983",SPHEROID["GRS 1980",6378137,298.257222101,AUTHORITY["EPSG","7019"]],AUTHORITY["EPSG","6269"]],PRIMEM["Greenwich",0,AUTHORITY["EPSG","8901"]],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]],AUTHORITY["EPSG","4269"]],PROJECTION["Albers_Conic_Equal_Area"],PARAMETER["latitude_of_center",44],PARAMETER["longitude_of_center",-68.5],PARAMETER["standard_parallel_1",60],PARAMETER["standard_parallel_2",46],PARAMETER["false_easting",0],PARAMETER["false_northing",0],UNIT["metre",1,AUTHORITY["EPSG","9001"]],AXIS["Easting",EAST],AXIS["Northing",NORTH],AUTHORITY["EPSG","6623"]]</dd><dt><span>GeoTransform :</span></dt><dd>-830584.8693000015 50.00000000000006 0.0 1303502.274700009 0.0 -50.00000000000006</dd></dl></div><div class="xr-var-data"><pre>array(0)</pre></div></li></ul></div></li><li class="xr-section-item"><input id="section-e4e40826-9920-4f06-9988-cda37f1f0ef9" class="xr-section-summary-in" type="checkbox"><label for="section-e4e40826-9920-4f06-9988-cda37f1f0ef9" class="xr-section-summary">Indexes: <span>(3)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><ul class="xr-var-list"><li class="xr-var-item"><div class="xr-index-name"><div>x</div></div><div class="xr-index-preview">PandasIndex</div><div></div><input id="index-aded9ee0-5745-4b49-bfde-4756a6da196f" class="xr-index-data-in" type="checkbox"><label for="index-aded9ee0-5745-4b49-bfde-4756a6da196f" title="Show/Hide index repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-index-data"><pre>PandasIndex(Index([-830559.8693000015, -830509.8693000015, -830459.8693000015, -830409.8693000015, -830359.8693000015, -830309.8693000015, -830259.8693000015, -830209.8693000015, -830159.8693000015, -830109.8693000015,
       ...
        603440.1307000001,  603490.1307000001,  603540.1307000001,  603590.1307000001,  603640.1307000001,  603690.1307000001,  603740.1307000001,  603790.1307000001,  603840.1307000001,  603890.1307000001], dtype='float64', name='x', length=28690))</pre></div></li><li class="xr-var-item"><div class="xr-index-name"><div>y</div></div><div class="xr-index-preview">PandasIndex</div><div></div><input id="index-6cc6d340-2ad9-408b-b82e-97cb7720d9a6" class="xr-index-data-in" type="checkbox"><label for="index-6cc6d340-2ad9-408b-b82e-97cb7720d9a6" title="Show/Hide index repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-index-data"><pre>PandasIndex(Index([ 1303477.274700009,  1303427.274700009,  1303377.274700009,  1303327.274700009,  1303277.274700009,  1303227.274700009,  1303177.274700009,  1303127.274700009,  1303077.274700009,  1303027.274700009,
       ...
       117677.27470000763, 117627.27470000763, 117577.27470000763, 117527.27470000763, 117477.27470000763, 117427.27470000763, 117377.27470000763, 117327.27470000763, 117277.27470000763, 117227.27470000763], dtype='float64', name='y', length=23726))</pre></div></li><li class="xr-var-item"><div class="xr-index-name"><div>band</div></div><div class="xr-index-preview">PandasIndex</div><div></div><input id="index-8b00d666-5b15-4125-9df1-86504d0c618f" class="xr-index-data-in" type="checkbox"><label for="index-8b00d666-5b15-4125-9df1-86504d0c618f" title="Show/Hide index repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-index-data"><pre>PandasIndex(Index([1], dtype='int64', name='band'))</pre></div></li></ul></div></li><li class="xr-section-item"><input id="section-d88f8bfc-5776-4ada-887d-c21f492393ee" class="xr-section-summary-in" type="checkbox"><label for="section-d88f8bfc-5776-4ada-887d-c21f492393ee" class="xr-section-summary">Attributes: <span>(13)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><dl class="xr-attrs"><dt><span>AREA_OR_POINT :</span></dt><dd>Area</dd><dt><span>RepresentationType :</span></dt><dd>THEMATIC</dd><dt><span>STATISTICS_COVARIANCES :</span></dt><dd>5.53386940676013</dd><dt><span>STATISTICS_MAXIMUM :</span></dt><dd>11</dd><dt><span>STATISTICS_MEAN :</span></dt><dd>6.4740178066376</dd><dt><span>STATISTICS_MINIMUM :</span></dt><dd>1</dd><dt><span>STATISTICS_SKIPFACTORX :</span></dt><dd>1</dd><dt><span>STATISTICS_SKIPFACTORY :</span></dt><dd>1</dd><dt><span>STATISTICS_STDDEV :</span></dt><dd>2.3524177748412</dd><dt><span>STATISTICS_VALID_PERCENT :</span></dt><dd>41.95</dd><dt><span>scale_factor :</span></dt><dd>1.0</dd><dt><span>add_offset :</span></dt><dd>0.0</dd><dt><span>_FillValue :</span></dt><dd>255</dd></dl></div></li></ul></div></div>
</div>
</div>
<ul>
<li>Affichons le raster reprojeté et l’emprise de la ville de Québec :</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remplacer les '255' par '0'</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>xds.data[xds.data <span class="op">==</span> <span class="dv">255</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Étendue des données</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>bounds <span class="op">=</span> xds.rio.bounds()</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>extent <span class="op">=</span> [bounds[<span class="dv">0</span>], bounds[<span class="dv">2</span>], bounds[<span class="dv">1</span>], bounds[<span class="dv">3</span>]]</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Création d'une figure vide</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">12</span>))</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Affichage du raster (attribut 'data' de l'objet xds)</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>show(xds.data[<span class="dv">0</span>], ax<span class="op">=</span>ax, extent<span class="op">=</span>extent, cmap<span class="op">=</span><span class="st">"Set3"</span>)</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Affichage de la ville de Québec en rouge par dessus</span></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>extract.plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">'red'</span>, edgecolor<span class="op">=</span><span class="st">'red'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a><span class="co"># On enlève l'affichage des axes</span></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>ax</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="python_files/figure-html/demo-plot-raster-3.png" class="img-fluid" width="1536"></p>
</div>
</div>
<ul>
<li>Ouverture du fichier DBF qui contient les correspondances entre les codes et les noms des catégories d’utilisation des sols</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>categories <span class="op">=</span> pd.DataFrame(</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  gpd.read_file(lc_categories_fp, encoding<span class="op">=</span><span class="st">'utf-8'</span>)[[<span class="st">'ID'</span>, <span class="st">'CL_COUV'</span>, <span class="st">'Descriptio'</span>]])</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>categories.head(<span class="dv">11</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      ID CL_COUV                             Descriptio
0    1.0  010000                 Surfaces artificielles
1    2.0  020000                       Terres agricoles
2    3.0  060000             Milieux humides forestiers
3    4.0  070000  Milieux&nbsp;humides&nbsp;herbacés&nbsp;ou&nbsp;arbustifs
4    5.0  100000        Plans et cours d’eau intérieure
5    6.0  110101    Forêts de conifères à couvert fermé
6    7.0  110102     Forêts&nbsp;de&nbsp;feuillus&nbsp;à&nbsp;couvert&nbsp;fermé
7    8.0  110103          Forêts&nbsp;mixtes&nbsp;à&nbsp;couvert&nbsp;fermé
8    9.0  110200                Forêts à couvert ouvert
9   10.0  000000                         Pas de données
10  11.0  000001               En attente de traitement</code></pre>
</div>
</div>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On va convertir cette DataFrame en un dictionnaire pour l'utiliser</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="co"># comme un mapping ID -&gt; Description</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>categories <span class="op">=</span> {</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="bu">int</span>(k): v[<span class="st">'Descriptio'</span>]</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> k,v <span class="kw">in</span> categories[[<span class="st">'ID'</span>, <span class="st">'Descriptio'</span>]].set_index(<span class="st">'ID'</span>).to_dict(orient<span class="op">=</span><span class="st">'index'</span>).items()</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Bien qu'il y ait une catégorie 'Pas de données' (ID 10)</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a><span class="co"># certaines cellules ne comportent pas de valeur (nodata, ici avec la valeur 0)</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>categories[<span class="dv">0</span>] <span class="op">=</span> <span class="st">'Pas de données'</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>categories</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{1: 'Surfaces artificielles', 2: 'Terres agricoles', 3: 'Milieux humides forestiers', 4: 'Milieux\xa0humides\xa0herbacés\xa0ou\xa0arbustifs', 5: 'Plans et cours d’eau intérieure', 6: 'Forêts de conifères à couvert fermé', 7: 'Forêts\xa0de\xa0feuillus\xa0à\xa0couvert\xa0fermé', 8: 'Forêts\xa0mixtes\xa0à\xa0couvert\xa0fermé', 9: 'Forêts à couvert ouvert', 10: 'Pas de données', 11: 'En attente de traitement', 12: 'Surfaces artificielles vers terres agricoles', 13: 'Surfaces artificielles vers milieux humides forestiers', 14: 'Surfaces artificielles vers milieux\xa0humides\xa0herbacés\xa0ou\xa0arbustifs', 15: 'Surfaces artificielles vers plans et cours d’eau intérieure', 16: 'Surfaces artificielles vers forêts de conifères à couvert fermé', 17: 'Surfaces artificielles vers forêts\xa0de\xa0feuillus\xa0à\xa0couvert\xa0fermé', 18: 'Surfaces artificielles vers forêts\xa0mixtes\xa0à\xa0couvert\xa0fermé', 19: 'Surfaces artificielles vers forêts à couvert ouvert', 20: 'Surfaces artificielles vers pas de données', 21: 'Surfaces artificielles vers en attente de traitement', 22: 'Terres agricoles vers surfaces artificielles', 23: 'Terres agricoles vers milieux humides forestiers', 24: 'Terres agricoles vers milieux\xa0humides\xa0herbacés\xa0ou\xa0arbustifs', 25: 'Terres agricoles vers plans et cours d’eau intérieure', 26: 'Terres agricoles vers forêts de conifères à couvert fermé', 27: 'Terres agricoles vers forêts\xa0de\xa0feuillus\xa0à\xa0couvert\xa0fermé', 28: 'Terres agricoles vers forêts\xa0mixtes\xa0à\xa0couvert\xa0fermé', 29: 'Terres agricoles vers forêts à couvert ouvert', 30: 'Terres agricoles vers pas de données', 31: 'Terres agricoles vers en attente de traitement', 32: 'Milieux humides forestiers vers surfaces artificielles', 33: 'Milieux humides forestiers vers terres agricoles', 34: 'Milieux humides forestiers vers milieux\xa0humides\xa0herbacés\xa0ou\xa0arbustifs', 35: 'Milieux humides forestiers vers plans et cours d’eau intérieure', 36: 'Milieux humides forestiers vers forêts de conifères à couvert fermé', 37: 'Milieux humides forestiers vers forêts\xa0de\xa0feuillus\xa0à\xa0couvert\xa0fermé', 38: 'Milieux humides forestiers vers forêts\xa0mixtes\xa0à\xa0couvert\xa0fermé', 39: 'Milieux humides forestiers vers forêts à couvert ouvert', 40: 'Milieux humides forestiers vers pas de données', 41: 'Milieux humides forestiers vers en attente de traitement', 42: 'Milieux\xa0humides\xa0herbacés\xa0ou\xa0arbustifs vers surfaces artificielles', 43: 'Milieux\xa0humides\xa0herbacés\xa0ou\xa0arbustifs vers terres agricoles', 44: 'Milieux\xa0humides\xa0herbacés\xa0ou\xa0arbustifs vers milieux humides forestiers', 45: 'Milieux\xa0humides\xa0herbacés\xa0ou\xa0arbustifs vers plans et cours d’eau intérieure', 46: 'Milieux\xa0humides\xa0herbacés\xa0ou\xa0arbustifs vers forêts de conifères à couvert fermé', 47: 'Milieux\xa0humides\xa0herbacés\xa0ou\xa0arbustifs vers forêts\xa0de\xa0feuillus\xa0à\xa0couvert\xa0fermé', 48: 'Milieux\xa0humides\xa0herbacés\xa0ou\xa0arbustifs vers forêts\xa0mixtes\xa0à\xa0couvert\xa0fermé', 49: 'Milieux\xa0humides\xa0herbacés\xa0ou\xa0arbustifs vers forêts à couvert ouvert', 50: 'Milieux\xa0humides\xa0herbacés\xa0ou\xa0arbustifs vers pas de données', 51: 'Milieux\xa0humides\xa0herbacés\xa0ou\xa0arbustifs vers en attente de traitement', 52: 'Plans et cours d’eau intérieure vers surfaces artificielles', 53: 'Plans et cours d’eau intérieure vers terres agricoles', 54: 'Plans et cours d’eau intérieure vers milieux humides forestiers', 55: 'Plans et cours d’eau intérieure vers milieux\xa0humides\xa0herbacés\xa0ou\xa0arbustifs', 56: 'Plans et cours d’eau intérieure vers forêts de conifères à couvert fermé', 57: 'Plans et cours d’eau intérieure vers forêts\xa0de\xa0feuillus\xa0à\xa0couvert\xa0fermé', 58: 'Plans et cours d’eau intérieure vers forêts\xa0mixtes\xa0à\xa0couvert\xa0fermé', 59: 'Plans et cours d’eau intérieure vers forêts à couvert ouvert', 60: 'Plans et cours d’eau intérieure vers pas de données', 61: 'Plans et cours d’eau intérieure vers en attente de traitement', 62: 'Forêts de conifères à couvert fermé vers surfaces artificielles', 63: 'Forêts de conifères à couvert fermé vers terres agricoles', 64: 'Forêts de conifères à couvert fermé vers milieux humides forestiers', 65: 'Forêts de conifères à couvert fermé vers milieux\xa0humides\xa0herbacés\xa0ou\xa0arbustifs', 66: 'Forêts de conifères à couvert fermé vers plans et cours d’eau intérieure', 67: 'Forêts de conifères à couvert fermé vers forêts\xa0de\xa0feuillus\xa0à\xa0couvert\xa0fermé', 68: 'Forêts de conifères à couvert fermé vers forêts\xa0mixtes\xa0à\xa0couvert\xa0fermé', 69: 'Forêts de conifères à couvert fermé vers forêts à couvert ouvert', 70: 'Forêts de conifères à couvert fermé vers pas de données', 71: 'Forêts de conifères à couvert fermé vers en attente de traitement', 72: 'Forêts\xa0de\xa0feuillus\xa0à\xa0couvert\xa0fermé vers surfaces artificielles', 73: 'Forêts\xa0de\xa0feuillus\xa0à\xa0couvert\xa0fermé vers terres agricoles', 74: 'Forêts\xa0de\xa0feuillus\xa0à\xa0couvert\xa0fermé vers milieux humides forestiers', 75: 'Forêts\xa0de\xa0feuillus\xa0à\xa0couvert\xa0fermé vers milieux\xa0humides\xa0herbacés\xa0ou\xa0arbustifs', 76: 'Forêts\xa0de\xa0feuillus\xa0à\xa0couvert\xa0fermé vers plans et cours d’eau intérieure', 77: 'Forêts\xa0de\xa0feuillus\xa0à\xa0couvert\xa0fermé vers forêts de conifères à couvert fermé', 78: 'Forêts\xa0de\xa0feuillus\xa0à\xa0couvert\xa0fermé vers forêts\xa0mixtes\xa0à\xa0couvert\xa0fermé', 79: 'Forêts\xa0de\xa0feuillus\xa0à\xa0couvert\xa0fermé vers forêts à couvert ouvert', 80: 'Forêts\xa0de\xa0feuillus\xa0à\xa0couvert\xa0fermé vers pas de données', 81: 'Forêts\xa0de\xa0feuillus\xa0à\xa0couvert\xa0fermé vers en attente de traitement', 82: 'Forêts\xa0mixtes\xa0à\xa0couvert\xa0fermé vers surfaces artificielles', 83: 'Forêts\xa0mixtes\xa0à\xa0couvert\xa0fermé vers terres agricoles', 84: 'Forêts\xa0mixtes\xa0à\xa0couvert\xa0fermé vers milieux humides forestiers', 85: 'Forêts\xa0mixtes\xa0à\xa0couvert\xa0fermé vers milieux\xa0humides\xa0herbacés\xa0ou\xa0arbustifs', 86: 'Forêts\xa0mixtes\xa0à\xa0couvert\xa0fermé vers plans et cours d’eau intérieure', 87: 'Forêts\xa0mixtes\xa0à\xa0couvert\xa0fermé vers forêts de conifères à couvert fermé', 88: 'Forêts\xa0mixtes\xa0à\xa0couvert\xa0fermé vers forêts\xa0de\xa0feuillus\xa0à\xa0couvert\xa0fermé', 89: 'Forêts\xa0mixtes\xa0à\xa0couvert\xa0fermé vers forêts à couvert ouvert', 90: 'Forêts\xa0mixtes\xa0à\xa0couvert\xa0fermé vers pas de données', 91: 'Forêts\xa0mixtes\xa0à\xa0couvert\xa0fermé vers en attente de traitement', 92: 'Forêts à couvert ouvert vers surfaces artificielles', 93: 'Forêts à couvert ouvert vers terres agricoles', 94: 'Forêts à couvert ouvert vers milieux humides forestiers', 95: 'Forêts à couvert ouvert vers milieux\xa0humides\xa0herbacés\xa0ou\xa0arbustifs', 96: 'Forêts à couvert ouvert vers plans et cours d’eau intérieure', 97: 'Forêts à couvert ouvert vers forêts de conifères à couvert fermé', 98: 'Forêts à couvert ouvert vers forêts\xa0de\xa0feuillus\xa0à\xa0couvert\xa0fermé', 99: 'Forêts à couvert ouvert vers forêts\xa0mixtes\xa0à\xa0couvert\xa0fermé', 100: 'Forêts à couvert ouvert vers pas de données', 101: 'Forêts à couvert ouvert vers en attente de traitement', 102: 'Pas de données vers surfaces artificielles', 103: 'Pas de données vers terres agricoles', 104: 'Pas de données vers milieux humides forestiers', 105: 'Pas de données vers milieux\xa0humides\xa0herbacés\xa0ou\xa0arbustifs', 106: 'Pas de données vers plans et cours d’eau intérieure', 107: 'Pas de données vers forêts de conifères à couvert fermé', 108: 'Pas de données vers forêts\xa0de\xa0feuillus\xa0à\xa0couvert\xa0fermé', 109: 'Pas de données vers forêts\xa0mixtes\xa0à\xa0couvert\xa0fermé', 110: 'Pas de données vers forêts à couvert ouvert', 111: 'Pas de données vers en attente de traitement', 112: 'En attente de traitement vers surfaces artificielles', 113: 'En attente de traitement vers terres agricoles', 114: 'En attente de traitement vers milieux humides forestiers', 115: 'En attente de traitement vers milieux\xa0humides\xa0herbacés\xa0ou\xa0arbustifs', 116: 'En attente de traitement vers plans et cours d’eau intérieure', 117: 'En attente de traitement vers forêts de conifères à couvert fermé', 118: 'En attente de traitement vers forêts\xa0de\xa0feuillus\xa0à\xa0couvert\xa0fermé', 119: 'En attente de traitement vers forêts\xa0mixtes\xa0à\xa0couvert\xa0fermé', 120: 'En attente de traitement vers forêts à couvert ouvert', 121: 'En attente de traitement vers pas de données', 0: 'Pas de données'}</code></pre>
</div>
</div>
<ul>
<li>Calculer les statistiques zonales (combien de cellules de chaque type dans la sélection) :</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>stats <span class="op">=</span> zonal_stats(extract, xds.data[<span class="dv">0</span>], affine<span class="op">=</span>xds.rio.transform(), categorical<span class="op">=</span><span class="va">True</span>, nodata<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>stats</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[{1: 95228, 2: 25829, 3: 4574, 4: 778, 5: 5490, 6: 4124, 7: 43887, 8: 44969, 9: 62, 10: 47}]</code></pre>
</div>
</div>
<ul>
<li>Traçons un histogramme de ce résultat, en utilisant les noms appropriés des catégories d’utilisation des sols :</li>
</ul>
<div class="cell" data-output-location="slide">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Utilise les noms de catégories du DataFrame `categories`...</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> [categories[<span class="bu">int</span>(v)] <span class="cf">for</span> v <span class="kw">in</span> stats[<span class="dv">0</span>].keys()]</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ...et les valeurs que nous venons de calculer avec la fonction `zonal_stats`</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>height <span class="op">=</span> stats[<span class="dv">0</span>].values()</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">8</span>))</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>bar_container <span class="op">=</span> ax.bar(x, height)</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>ax.set_xticklabels(</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>    ax.get_xticklabels(),</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>    rotation<span class="op">=</span><span class="dv">45</span>,</span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>    horizontalalignment<span class="op">=</span><span class="st">'right'</span></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>ax</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="python_files/figure-html/unnamed-chunk-6-5.png" class="img-fluid" width="768"></p>
</div>
</div>
<ul>
<li>Dans quel type d’occupation du sol se trouvent les restaurants précédemment récupérés ?</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>geoms <span class="op">=</span> resto[<span class="st">'geometry'</span>].tolist()</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>resto[<span class="st">"lc"</span>] <span class="op">=</span> [categories[<span class="bu">int</span>(x)] <span class="cf">for</span> x <span class="kw">in</span> point_query(vectors<span class="op">=</span>geoms, raster<span class="op">=</span>xds.data[<span class="dv">0</span>], nodata<span class="op">=</span><span class="dv">0</span>, affine<span class="op">=</span>xds.rio.transform())]</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>resto.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      osm_id         name     cuisine                        geometry                      lc
0  291667452    Chez Cora          NA  POINT (-205284.124 320601.265)  Surfaces artificielles
1  295803248    Normandin          NA  POINT (-221931.609 321452.378)  Surfaces artificielles
2  345886369  Chez Victor      burger  POINT (-207712.728 315587.610)  Surfaces artificielles
3  386267989       Ly-Hai  vietnamese  POINT (-207895.478 315365.940)  Surfaces artificielles
4  393559700       Mike's     italian  POINT (-217665.483 319360.818)  Surfaces artificielles</code></pre>
</div>
</div>
<ul>
<li>Quels restaurants ne sont pas situés dans une zone artificialisée ?</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>selection <span class="op">=</span> resto[(resto.lc <span class="op">!=</span> <span class="st">'Surfaces artificielles'</span>) <span class="op">&amp;</span> (resto.lc <span class="op">!=</span> <span class="st">'Pas de données'</span>)]</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>selection</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          osm_id                        name                          cuisine                        geometry                                     lc
68    2395695353                  Yuzu sushi                            sushi  POINT (-222424.372 321631.681)             Milieux humides forestiers
197   3089591298                     Café 47                               NA  POINT (-211438.971 309903.333)             Milieux humides forestiers
209   3222747115                  Yuzu Sushi                               NA  POINT (-213715.133 318403.631)     Forêts&nbsp;de&nbsp;feuillus&nbsp;à&nbsp;couvert&nbsp;fermé
210   3224167888                   Le Subtil                               NA  POINT (-212550.597 319033.410)     Forêts&nbsp;de&nbsp;feuillus&nbsp;à&nbsp;couvert&nbsp;fermé
214   3257077054            Ben &amp; Florentine                               NA  POINT (-221125.085 321891.351)             Milieux humides forestiers
235   3801921158               Le Commandant                          italian  POINT (-218914.348 315176.377)          Forêts&nbsp;mixtes&nbsp;à&nbsp;couvert&nbsp;fermé
287   4726892021                        Pidz                            pizza  POINT (-229413.591 325273.771)        Plans et cours d’eau intérieure
295   5099196285         Le Bistro Évolution                               NA  POINT (-210863.848 307329.858)          Forêts&nbsp;mixtes&nbsp;à&nbsp;couvert&nbsp;fermé
323   5485394052  érablière du chemin du Roy  maple;ice_cream;quebec;canadian  POINT (-222402.680 308460.059)             Milieux humides forestiers
324   5485401715                   Quai 1636                  regional;french  POINT (-216802.399 309187.074)                       Terres agricoles
355   6643475285                     La cage                               NA  POINT (-203039.864 313768.119)  Milieux&nbsp;humides&nbsp;herbacés&nbsp;ou&nbsp;arbustifs
371   7816042184                 Chez Victor                               NA  POINT (-210673.674 307668.201)                       Terres agricoles
404  10878153356                      Pacini                          italian  POINT (-213819.005 318251.978)    Forêts de conifères à couvert fermé
405  10878153357                  Yuzu sushi                            sushi  POINT (-213801.047 318254.188)     Forêts&nbsp;de&nbsp;feuillus&nbsp;à&nbsp;couvert&nbsp;fermé
420    189982784              Resto-Pub Ryna                               NA  POINT (-211598.938 306756.046)     Forêts&nbsp;de&nbsp;feuillus&nbsp;à&nbsp;couvert&nbsp;fermé
467    998906150                 Benny &amp; Co.         chicken;barbecue;poutine  POINT (-213983.922 325706.559)                       Terres agricoles</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> extract.plot(color<span class="op">=</span><span class="va">None</span>, edgecolor<span class="op">=</span><span class="st">"black"</span>)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> selection.plot(ax<span class="op">=</span>ax, marker<span class="op">=</span><span class="st">'x'</span>, color<span class="op">=</span><span class="st">'red'</span>, markersize<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>ax</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="python_files/figure-html/unnamed-chunk-9-7.png" class="img-fluid" width="672"></p>
</div>
</div>
<!-- -->

</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb65" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Articulation de différents langages (R, JavaScript et Python) pour la géovisualisation avec Quarto"</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Atelier Sageo, Québec, Juin 2023"</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Timothée Giraud, Nicolas Lambert, Matthieu Viry, Ronan Ysebaert (UAR RIATE, CNRS, Université Paris Cité)"</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: sandstone</span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a><span class="co">    fontsize: 0.9em</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 2</span></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a><span class="co">    linkcolor: "#8631ad"</span></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span><span class="co"> </span></span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a><span class="co">  cache: false</span></span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a><span class="an">editor_options:</span><span class="co"> </span></span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a><span class="co">  chunk_output_type: console</span></span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a><span class="in">```{r reticulate-env}</span></span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reticulate)</span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true" tabindex="-1"></a><span class="fu">use_virtualenv</span>(<span class="st">"~/env-quarto"</span>)</span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-24"><a href="#cb65-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-25"><a href="#cb65-25" aria-hidden="true" tabindex="-1"></a><span class="in">```{python pandas-column-width-setup}</span></span>
<span id="cb65-26"><a href="#cb65-26" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb65-27"><a href="#cb65-27" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb65-28"><a href="#cb65-28" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.max_rows'</span>, <span class="dv">500</span>)</span>
<span id="cb65-29"><a href="#cb65-29" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.max_columns'</span>, <span class="dv">500</span>)</span>
<span id="cb65-30"><a href="#cb65-30" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.width'</span>, <span class="dv">1000</span>)</span>
<span id="cb65-31"><a href="#cb65-31" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-32"><a href="#cb65-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-33"><a href="#cb65-33" aria-hidden="true" tabindex="-1"></a><span class="fu"># Python</span></span>
<span id="cb65-34"><a href="#cb65-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-35"><a href="#cb65-35" aria-hidden="true" tabindex="-1"></a><span class="fu">## Le langage Python</span></span>
<span id="cb65-36"><a href="#cb65-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-37"><a href="#cb65-37" aria-hidden="true" tabindex="-1"></a>:::: columns</span>
<span id="cb65-38"><a href="#cb65-38" aria-hidden="true" tabindex="-1"></a>::: {.column width="70%"}</span>
<span id="cb65-39"><a href="#cb65-39" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Python** : un langage *polyvalent*, *interprété* et *multi-paradigme*</span>
<span id="cb65-40"><a href="#cb65-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-41"><a href="#cb65-41" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>De plus en plus utilisé pour la *science des données*</span>
<span id="cb65-42"><a href="#cb65-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-43"><a href="#cb65-43" aria-hidden="true" tabindex="-1"></a>:::{.fragment}</span>
<span id="cb65-44"><a href="#cb65-44" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Un écosystème robuste pour différents domaines d'application scientifiques</span>
<span id="cb65-45"><a href="#cb65-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-46"><a href="#cb65-46" aria-hidden="true" tabindex="-1"></a><span class="al">![](./fig/python-stack.png)</span></span>
<span id="cb65-47"><a href="#cb65-47" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-48"><a href="#cb65-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-49"><a href="#cb65-49" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-50"><a href="#cb65-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-51"><a href="#cb65-51" aria-hidden="true" tabindex="-1"></a>::: {.column width="30%"}</span>
<span id="cb65-52"><a href="#cb65-52" aria-hidden="true" tabindex="-1"></a><span class="al">![](./fig/logo-python.png)</span></span>
<span id="cb65-53"><a href="#cb65-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-54"><a href="#cb65-54" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-55"><a href="#cb65-55" aria-hidden="true" tabindex="-1"></a>::::</span>
<span id="cb65-56"><a href="#cb65-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-57"><a href="#cb65-57" aria-hidden="true" tabindex="-1"></a><span class="fu">## Écosystème pour le géospatial</span></span>
<span id="cb65-58"><a href="#cb65-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-59"><a href="#cb65-59" aria-hidden="true" tabindex="-1"></a><span class="fu">## Données vectorielles</span></span>
<span id="cb65-60"><a href="#cb65-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-61"><a href="#cb65-61" aria-hidden="true" tabindex="-1"></a>::: columns</span>
<span id="cb65-62"><a href="#cb65-62" aria-hidden="true" tabindex="-1"></a>::: {.column width="66%"}</span>
<span id="cb65-63"><a href="#cb65-63" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">**Bindings Python de GDAL/OGR**</span><span class="co">](https://gdal.org/api/python_bindings.html)</span></span>
<span id="cb65-64"><a href="#cb65-64" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">**Fiona**</span><span class="co">](https://fiona.readthedocs.io/en/stable/)</span> - I/O (*wrapper* de haut niveau autour d'OGR)</span>
<span id="cb65-65"><a href="#cb65-65" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">**Shapely**</span><span class="co">](https://shapely.readthedocs.io/)</span> (bindings Python de GEOS)</span>
<span id="cb65-66"><a href="#cb65-66" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">**Pyproj**</span><span class="co">](https://pyproj4.github.io/pyproj)</span> (bindings Python de <span class="co">[</span><span class="ot">PROJ</span><span class="co">](https://proj.org/)</span>)</span>
<span id="cb65-67"><a href="#cb65-67" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">**Geopandas**</span><span class="co">](https://geopandas.org/)</span> - Étend les <span class="in">`DataFrame`</span>s de <span class="co">[</span><span class="ot">pandas</span><span class="co">](https://pandas.pydata.org/)</span> pour ... (basé sur Fiona / Shapely / Pyproj)</span>
<span id="cb65-68"><a href="#cb65-68" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-69"><a href="#cb65-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-70"><a href="#cb65-70" aria-hidden="true" tabindex="-1"></a>::: {.column width="33%"}</span>
<span id="cb65-71"><a href="#cb65-71" aria-hidden="true" tabindex="-1"></a><span class="al">![](./fig/logo-pandas.svg)</span></span>
<span id="cb65-72"><a href="#cb65-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-73"><a href="#cb65-73" aria-hidden="true" tabindex="-1"></a><span class="al">![](./fig/logo_geopandas.svg)</span></span>
<span id="cb65-74"><a href="#cb65-74" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-75"><a href="#cb65-75" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-76"><a href="#cb65-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-77"><a href="#cb65-77" aria-hidden="true" tabindex="-1"></a><span class="fu">## Le package *GeoPandas*</span></span>
<span id="cb65-78"><a href="#cb65-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-79"><a href="#cb65-79" aria-hidden="true" tabindex="-1"></a>Un projet open source pour faciliter le travail avec des données géospatiales vectorielles en Python. GeoPandas étend Pandas pour permettre de disposer d'un type de colonne géométrique et pour permettre d'effectuer des opérations spatiales. Les opérations géométriques sont réalisées avec <span class="in">`shapely`</span>, les accès en lecture / écriture aux fichiers utilisent <span class="in">`fiona`</span> et la visualisation utilise <span class="in">`matplotlib`</span>.</span>
<span id="cb65-80"><a href="#cb65-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-81"><a href="#cb65-81" aria-hidden="true" tabindex="-1"></a><span class="al">![Format des GeoDataFrame](./fig/geopandas-table.png)</span></span>
<span id="cb65-82"><a href="#cb65-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-83"><a href="#cb65-83" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Utilisation :</span>
<span id="cb65-84"><a href="#cb65-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-85"><a href="#cb65-85" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset .custom-tab}</span>
<span id="cb65-86"><a href="#cb65-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-87"><a href="#cb65-87" aria-hidden="true" tabindex="-1"></a><span class="fu">### Import et lecture</span></span>
<span id="cb65-88"><a href="#cb65-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-89"><a href="#cb65-89" aria-hidden="true" tabindex="-1"></a><span class="in">```{python gpd-tuto-import-1}</span></span>
<span id="cb65-90"><a href="#cb65-90" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb65-91"><a href="#cb65-91" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geodatasets</span>
<span id="cb65-92"><a href="#cb65-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-93"><a href="#cb65-93" aria-hidden="true" tabindex="-1"></a>file_path <span class="op">=</span> geodatasets.get_path(<span class="st">"nybb"</span>)</span>
<span id="cb65-94"><a href="#cb65-94" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-95"><a href="#cb65-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-96"><a href="#cb65-96" aria-hidden="true" tabindex="-1"></a>Avec la fonction <span class="in">`read_file`</span> :</span>
<span id="cb65-97"><a href="#cb65-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-98"><a href="#cb65-98" aria-hidden="true" tabindex="-1"></a><span class="in">```{python gpd-tuto-import-2}</span></span>
<span id="cb65-99"><a href="#cb65-99" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb65-100"><a href="#cb65-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-101"><a href="#cb65-101" aria-hidden="true" tabindex="-1"></a>nybb <span class="op">=</span> gpd.read_file(file_path)</span>
<span id="cb65-102"><a href="#cb65-102" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-103"><a href="#cb65-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-104"><a href="#cb65-104" aria-hidden="true" tabindex="-1"></a><span class="fu">### Affichage</span></span>
<span id="cb65-105"><a href="#cb65-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-106"><a href="#cb65-106" aria-hidden="true" tabindex="-1"></a>Avec la méthode <span class="in">`plot`</span> des <span class="in">`GeoDataFrame`</span> :</span>
<span id="cb65-107"><a href="#cb65-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-108"><a href="#cb65-108" aria-hidden="true" tabindex="-1"></a><span class="in">```{python gpd-tuto-plot}</span></span>
<span id="cb65-109"><a href="#cb65-109" aria-hidden="true" tabindex="-1"></a>nybb.plot()</span>
<span id="cb65-110"><a href="#cb65-110" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-111"><a href="#cb65-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-112"><a href="#cb65-112" aria-hidden="true" tabindex="-1"></a><span class="fu">### SCR</span></span>
<span id="cb65-113"><a href="#cb65-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-114"><a href="#cb65-114" aria-hidden="true" tabindex="-1"></a>Affichage :</span>
<span id="cb65-115"><a href="#cb65-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-116"><a href="#cb65-116" aria-hidden="true" tabindex="-1"></a><span class="in">```{python gpd-tuto-crs}</span></span>
<span id="cb65-117"><a href="#cb65-117" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(nybb.crs)</span>
<span id="cb65-118"><a href="#cb65-118" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-119"><a href="#cb65-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-120"><a href="#cb65-120" aria-hidden="true" tabindex="-1"></a>Transformation :</span>
<span id="cb65-121"><a href="#cb65-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-122"><a href="#cb65-122" aria-hidden="true" tabindex="-1"></a><span class="in">```{python gpd-tuto-transformation}</span></span>
<span id="cb65-123"><a href="#cb65-123" aria-hidden="true" tabindex="-1"></a>nybb_geo <span class="op">=</span> nybb.to_crs(<span class="st">'EPSG:4326'</span>)</span>
<span id="cb65-124"><a href="#cb65-124" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-125"><a href="#cb65-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-126"><a href="#cb65-126" aria-hidden="true" tabindex="-1"></a><span class="fu">### Affichage avec fond de carte</span></span>
<span id="cb65-127"><a href="#cb65-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-128"><a href="#cb65-128" aria-hidden="true" tabindex="-1"></a>En utilisant la bibliothèque <span class="in">`contextily`</span> :</span>
<span id="cb65-129"><a href="#cb65-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-130"><a href="#cb65-130" aria-hidden="true" tabindex="-1"></a><span class="in">```{python gpd-tuto-contextily}</span></span>
<span id="cb65-131"><a href="#cb65-131" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> contextily <span class="im">as</span> cx</span>
<span id="cb65-132"><a href="#cb65-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-133"><a href="#cb65-133" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> nybb.to_crs(<span class="st">'EPSG:3857'</span>).plot()</span>
<span id="cb65-134"><a href="#cb65-134" aria-hidden="true" tabindex="-1"></a>cx.add_basemap(ax, source<span class="op">=</span><span class="st">'https://</span><span class="sc">{s}</span><span class="st">.tile.openstreetmap.fr/osmfr/</span><span class="sc">{z}</span><span class="st">/</span><span class="sc">{x}</span><span class="st">/</span><span class="sc">{y}</span><span class="st">.png'</span>)</span>
<span id="cb65-135"><a href="#cb65-135" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb65-136"><a href="#cb65-136" aria-hidden="true" tabindex="-1"></a>ax</span>
<span id="cb65-137"><a href="#cb65-137" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-138"><a href="#cb65-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-139"><a href="#cb65-139" aria-hidden="true" tabindex="-1"></a><span class="fu">### Centroide</span></span>
<span id="cb65-140"><a href="#cb65-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-141"><a href="#cb65-141" aria-hidden="true" tabindex="-1"></a>Simplement en utilisant l'attribut <span class="in">`centroid`</span> des <span class="in">`GeoDataFrame`</span> :</span>
<span id="cb65-142"><a href="#cb65-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-143"><a href="#cb65-143" aria-hidden="true" tabindex="-1"></a><span class="in">```{python gpd-tuto-centroid}</span></span>
<span id="cb65-144"><a href="#cb65-144" aria-hidden="true" tabindex="-1"></a>nybb.centroid.plot()</span>
<span id="cb65-145"><a href="#cb65-145" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-146"><a href="#cb65-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-147"><a href="#cb65-147" aria-hidden="true" tabindex="-1"></a><span class="fu">### Boundary</span></span>
<span id="cb65-148"><a href="#cb65-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-149"><a href="#cb65-149" aria-hidden="true" tabindex="-1"></a>Simplement en utilisant l'attribut <span class="in">`boundary`</span> des <span class="in">`GeoDataFrame`</span> :</span>
<span id="cb65-150"><a href="#cb65-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-151"><a href="#cb65-151" aria-hidden="true" tabindex="-1"></a><span class="in">```{python gpd-tuto-boundary}</span></span>
<span id="cb65-152"><a href="#cb65-152" aria-hidden="true" tabindex="-1"></a>nybb.boundary.plot()</span>
<span id="cb65-153"><a href="#cb65-153" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-154"><a href="#cb65-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-155"><a href="#cb65-155" aria-hidden="true" tabindex="-1"></a><span class="fu">### Zone tampon</span></span>
<span id="cb65-156"><a href="#cb65-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-157"><a href="#cb65-157" aria-hidden="true" tabindex="-1"></a>En utilisant la méthode <span class="in">`buffer`</span> des <span class="in">`GeoDataFrame`</span> :</span>
<span id="cb65-158"><a href="#cb65-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-159"><a href="#cb65-159" aria-hidden="true" tabindex="-1"></a><span class="in">```{python gpd-tuto-buffer}</span></span>
<span id="cb65-160"><a href="#cb65-160" aria-hidden="true" tabindex="-1"></a>buff_nybb <span class="op">=</span> nybb.<span class="bu">buffer</span>(<span class="dv">3000</span>)</span>
<span id="cb65-161"><a href="#cb65-161" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-162"><a href="#cb65-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-163"><a href="#cb65-163" aria-hidden="true" tabindex="-1"></a><span class="in">```{python gpd-tuto-buffer-2}</span></span>
<span id="cb65-164"><a href="#cb65-164" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> buff_nybb.plot(color<span class="op">=</span><span class="st">"red"</span>)</span>
<span id="cb65-165"><a href="#cb65-165" aria-hidden="true" tabindex="-1"></a>nybb.plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">"aliceblue"</span>)</span>
<span id="cb65-166"><a href="#cb65-166" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-167"><a href="#cb65-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-168"><a href="#cb65-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-169"><a href="#cb65-169" aria-hidden="true" tabindex="-1"></a><span class="fu">### Aggrégation</span></span>
<span id="cb65-170"><a href="#cb65-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-171"><a href="#cb65-171" aria-hidden="true" tabindex="-1"></a>En utilisant la méthode <span class="in">`dissolve`</span> des <span class="in">`GeoDataFrame`</span> :</span>
<span id="cb65-172"><a href="#cb65-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-173"><a href="#cb65-173" aria-hidden="true" tabindex="-1"></a><span class="in">```{python gpd-tuto-agg}</span></span>
<span id="cb65-174"><a href="#cb65-174" aria-hidden="true" tabindex="-1"></a><span class="co"># On peut utiliser dissolve(by="nom_colonne") si on veut aggréger selon les valeurs d'une colonne</span></span>
<span id="cb65-175"><a href="#cb65-175" aria-hidden="true" tabindex="-1"></a>agg <span class="op">=</span> nybb.dissolve()</span>
<span id="cb65-176"><a href="#cb65-176" aria-hidden="true" tabindex="-1"></a>agg.plot()</span>
<span id="cb65-177"><a href="#cb65-177" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-178"><a href="#cb65-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-179"><a href="#cb65-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-180"><a href="#cb65-180" aria-hidden="true" tabindex="-1"></a><span class="fu">### Intersection</span></span>
<span id="cb65-181"><a href="#cb65-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-182"><a href="#cb65-182" aria-hidden="true" tabindex="-1"></a>En utilisant la méthode <span class="in">`intersection`</span> des <span class="in">`GeoDataFrame`</span> :</span>
<span id="cb65-183"><a href="#cb65-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-184"><a href="#cb65-184" aria-hidden="true" tabindex="-1"></a><span class="in">```{python gpd-tuto-intersection}</span></span>
<span id="cb65-185"><a href="#cb65-185" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely <span class="im">import</span> wkt</span>
<span id="cb65-186"><a href="#cb65-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-187"><a href="#cb65-187" aria-hidden="true" tabindex="-1"></a>point <span class="op">=</span> wkt.loads(<span class="st">'Point(998769.1146889535 174169.7607268664)'</span>)</span>
<span id="cb65-188"><a href="#cb65-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-189"><a href="#cb65-189" aria-hidden="true" tabindex="-1"></a>intersecting <span class="op">=</span> nybb.intersection(point.<span class="bu">buffer</span>(<span class="dv">35000</span>))</span>
<span id="cb65-190"><a href="#cb65-190" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-191"><a href="#cb65-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-192"><a href="#cb65-192" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb65-193"><a href="#cb65-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-194"><a href="#cb65-194" aria-hidden="true" tabindex="-1"></a><span class="in">```{python gpd-tuto-intersectiob-2}</span></span>
<span id="cb65-195"><a href="#cb65-195" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> nybb.plot()</span>
<span id="cb65-196"><a href="#cb65-196" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> intersecting.plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">"red"</span>)</span>
<span id="cb65-197"><a href="#cb65-197" aria-hidden="true" tabindex="-1"></a>ax</span>
<span id="cb65-198"><a href="#cb65-198" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-199"><a href="#cb65-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-200"><a href="#cb65-200" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-201"><a href="#cb65-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-202"><a href="#cb65-202" aria-hidden="true" tabindex="-1"></a><span class="fu">## Données raster</span></span>
<span id="cb65-203"><a href="#cb65-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-204"><a href="#cb65-204" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">**Rasterio**</span><span class="co">](https://rasterio.readthedocs.io/)</span> :</span>
<span id="cb65-205"><a href="#cb65-205" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>lecture / écriture de raster (*wrapper* de haut niveau autour de GDAL)</span>
<span id="cb65-206"><a href="#cb65-206" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>données représentées sous forme d'<span class="in">`array`</span> NumPy</span>
<span id="cb65-207"><a href="#cb65-207" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>reprojection</span>
<span id="cb65-208"><a href="#cb65-208" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>_resampling_</span>
<span id="cb65-209"><a href="#cb65-209" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>_virtual files_</span>
<span id="cb65-210"><a href="#cb65-210" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>etc.</span>
<span id="cb65-211"><a href="#cb65-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-212"><a href="#cb65-212" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">**Rasterstats**</span><span class="co">](https://pythonhosted.org/rasterstats/)</span> :</span>
<span id="cb65-213"><a href="#cb65-213" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>résumer des données raster sur la base de géométries vectorielles</span>
<span id="cb65-214"><a href="#cb65-214" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>extraction de valeurs à un point précis</span>
<span id="cb65-215"><a href="#cb65-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-216"><a href="#cb65-216" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">**xarray**</span><span class="co">](https://docs.xarray.dev/en/stable/)</span> et <span class="co">[</span><span class="ot">**rioxarray**</span><span class="co">](https://corteva.github.io/rioxarray/)</span> :</span>
<span id="cb65-217"><a href="#cb65-217" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>*xarray* pour travailler avec des tableaux multidimensionnels étiquetés</span>
<span id="cb65-218"><a href="#cb65-218" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>*rioxarray* pour ouvrir des jeux des données raster avec *rasterio*, les stocker dans le format de *xarray*, et avoir accès à différentes fonctionnalités de *rasterio*</span>
<span id="cb65-219"><a href="#cb65-219" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>moins "rustique" que d'utiliser rasterio seul / dépend de l'usage souhaité</span>
<span id="cb65-220"><a href="#cb65-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-221"><a href="#cb65-221" aria-hidden="true" tabindex="-1"></a><span class="fu">## Le package *Rasterio*</span></span>
<span id="cb65-222"><a href="#cb65-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-223"><a href="#cb65-223" aria-hidden="true" tabindex="-1"></a>Exemple d'utilisation :</span>
<span id="cb65-224"><a href="#cb65-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-225"><a href="#cb65-225" aria-hidden="true" tabindex="-1"></a><span class="in">```{python example-rio-1}</span></span>
<span id="cb65-226"><a href="#cb65-226" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterio <span class="im">as</span> rio</span>
<span id="cb65-227"><a href="#cb65-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-228"><a href="#cb65-228" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rio.<span class="bu">open</span>(<span class="st">'data/MODIS_ARRAY.nc'</span>) <span class="im">as</span> f:</span>
<span id="cb65-229"><a href="#cb65-229" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Métadonnées :</span></span>
<span id="cb65-230"><a href="#cb65-230" aria-hidden="true" tabindex="-1"></a>    metadata <span class="op">=</span> f.meta</span>
<span id="cb65-231"><a href="#cb65-231" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Lire toutes les bandes :</span></span>
<span id="cb65-232"><a href="#cb65-232" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> f.read()</span>
<span id="cb65-233"><a href="#cb65-233" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ou f.read(1) pour lire seulement la première bande</span></span>
<span id="cb65-234"><a href="#cb65-234" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-235"><a href="#cb65-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-236"><a href="#cb65-236" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Un dictionnaire de méta-données + un tableau NumPy contenant la (ou les) bande(s) :</span>
<span id="cb65-237"><a href="#cb65-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-238"><a href="#cb65-238" aria-hidden="true" tabindex="-1"></a><span class="in">```{python example-rio-2}</span></span>
<span id="cb65-239"><a href="#cb65-239" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(metadata)</span>
<span id="cb65-240"><a href="#cb65-240" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(data)</span>
<span id="cb65-241"><a href="#cb65-241" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-242"><a href="#cb65-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-243"><a href="#cb65-243" aria-hidden="true" tabindex="-1"></a><span class="fu">## Les package *xarray* et *rioxarray*</span></span>
<span id="cb65-244"><a href="#cb65-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-245"><a href="#cb65-245" aria-hidden="true" tabindex="-1"></a>Exemple d'utilisation :</span>
<span id="cb65-246"><a href="#cb65-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-247"><a href="#cb65-247" aria-hidden="true" tabindex="-1"></a><span class="in">```{python example-rioxarray-1}</span></span>
<span id="cb65-248"><a href="#cb65-248" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rioxarray</span>
<span id="cb65-249"><a href="#cb65-249" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xarray</span>
<span id="cb65-250"><a href="#cb65-250" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb65-251"><a href="#cb65-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-252"><a href="#cb65-252" aria-hidden="true" tabindex="-1"></a>xds <span class="op">=</span> xarray.open_dataarray(<span class="st">"./data/MODIS_ARRAY.nc"</span>)</span>
<span id="cb65-253"><a href="#cb65-253" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-254"><a href="#cb65-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-255"><a href="#cb65-255" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Un objet de type <span class="in">`xarray.DataArray`</span> ou <span class="in">`xarray.Dataset`</span> qui contient les différentes méta-données et les données :</span>
<span id="cb65-256"><a href="#cb65-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-257"><a href="#cb65-257" aria-hidden="true" tabindex="-1"></a><span class="in">```{python example-rioxarray-2}</span></span>
<span id="cb65-258"><a href="#cb65-258" aria-hidden="true" tabindex="-1"></a>xds</span>
<span id="cb65-259"><a href="#cb65-259" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-260"><a href="#cb65-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-261"><a href="#cb65-261" aria-hidden="true" tabindex="-1"></a><span class="in">```{python example-rioxarray-3}</span></span>
<span id="cb65-262"><a href="#cb65-262" aria-hidden="true" tabindex="-1"></a><span class="co"># Interpolate missing data:</span></span>
<span id="cb65-263"><a href="#cb65-263" aria-hidden="true" tabindex="-1"></a>filled <span class="op">=</span> xds.rio.interpolate_na()</span>
<span id="cb65-264"><a href="#cb65-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-265"><a href="#cb65-265" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">5</span>))</span>
<span id="cb65-266"><a href="#cb65-266" aria-hidden="true" tabindex="-1"></a>ax1, ax2 <span class="op">=</span> (fig.add_subplot(<span class="dv">131</span>), fig.add_subplot(<span class="dv">133</span>))</span>
<span id="cb65-267"><a href="#cb65-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-268"><a href="#cb65-268" aria-hidden="true" tabindex="-1"></a>xds.isel(x<span class="op">=</span><span class="bu">slice</span>(<span class="dv">0</span>, <span class="dv">20</span>), y<span class="op">=</span><span class="bu">slice</span>(<span class="dv">0</span>, <span class="dv">20</span>)).plot(ax<span class="op">=</span>ax1)</span>
<span id="cb65-269"><a href="#cb65-269" aria-hidden="true" tabindex="-1"></a>filled.isel(x<span class="op">=</span><span class="bu">slice</span>(<span class="dv">0</span>, <span class="dv">20</span>), y<span class="op">=</span><span class="bu">slice</span>(<span class="dv">0</span>, <span class="dv">20</span>)).plot(ax<span class="op">=</span>ax2)</span>
<span id="cb65-270"><a href="#cb65-270" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-271"><a href="#cb65-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-272"><a href="#cb65-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-273"><a href="#cb65-273" aria-hidden="true" tabindex="-1"></a><span class="fu">## Analyse spatiale</span></span>
<span id="cb65-274"><a href="#cb65-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-275"><a href="#cb65-275" aria-hidden="true" tabindex="-1"></a>:::: {.columns}</span>
<span id="cb65-276"><a href="#cb65-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-277"><a href="#cb65-277" aria-hidden="true" tabindex="-1"></a>::: {.column width="80%"}</span>
<span id="cb65-278"><a href="#cb65-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-279"><a href="#cb65-279" aria-hidden="true" tabindex="-1"></a>Écosystème de bibliothèques pour l'analyse spatiale <span class="co">[</span><span class="ot">PySAL</span><span class="co">](https://pysal.org/)</span> (Python Spatial Analysis Library) :</span>
<span id="cb65-280"><a href="#cb65-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-281"><a href="#cb65-281" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Explorer**:</span>
<span id="cb65-282"><a href="#cb65-282" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Analyse exploratoire des données spatiales (package <span class="co">[</span><span class="ot">esda</span><span class="co">](https://pysal.org/esda/)</span>)</span>
<span id="cb65-283"><a href="#cb65-283" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Analyse de la dynamique des données spatiales longitudinales (package <span class="co">[</span><span class="ot">giddy</span><span class="co">](https://pysal.org/giddy/)</span>)</span>
<span id="cb65-284"><a href="#cb65-284" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Mesure des inégalités dans l'espace et dans le temps (package <span class="co">[</span><span class="ot">inequality</span><span class="co">](https://inequality.readthedocs.io/en/latest/)</span>)</span>
<span id="cb65-285"><a href="#cb65-285" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Analyse statistique de motifs ponctuels planaires (package <span class="co">[</span><span class="ot">pointpats</span><span class="co">](https://pysal.org/pointpats/)</span>)</span>
<span id="cb65-286"><a href="#cb65-286" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Mesure de la ségrégation dans le temps et dans l'espace (package <span class="co">[</span><span class="ot">segregation</span><span class="co">](https://pysal.org/segregation/)</span>)</span>
<span id="cb65-287"><a href="#cb65-287" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Morphométrie urbaine (package <span class="co">[</span><span class="ot">momepy</span><span class="co">](https://docs.momepy.org/en/stable/)</span>)</span>
<span id="cb65-288"><a href="#cb65-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-289"><a href="#cb65-289" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Modéliser**:</span>
<span id="cb65-290"><a href="#cb65-290" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Régression géographiquement pondérée à plusieurs échelles (package <span class="co">[</span><span class="ot">mgwr</span><span class="co">](https://mgwr.readthedocs.io/en/latest/)</span>)</span>
<span id="cb65-291"><a href="#cb65-291" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Modèles linéaires généralisés épars (package <span class="co">[</span><span class="ot">spglm</span><span class="co">](https://spglm.readthedocs.io/en/latest/)</span>)</span>
<span id="cb65-292"><a href="#cb65-292" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Modèles d'interaction spatiale (package <span class="co">[</span><span class="ot">spint</span><span class="co">](https://spint.readthedocs.io/en/latest/)</span>)</span>
<span id="cb65-293"><a href="#cb65-293" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Modèles de régression spatiale (package <span class="co">[</span><span class="ot">spreg</span><span class="co">](https://spreg.readthedocs.io/en/latest/)</span>)</span>
<span id="cb65-294"><a href="#cb65-294" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Modèles de composantes de variance à corrélation spatiale à plusieurs niveaux (package <span class="co">[</span><span class="ot">spvcm</span><span class="co">](https://github.com/pysal/spvcm)</span>)</span>
<span id="cb65-295"><a href="#cb65-295" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>*Areal interpolation* et cartographie dasymétrique (package <span class="co">[</span><span class="ot">tobler</span><span class="co">](https://pysal.org/tobler/)</span>)</span>
<span id="cb65-296"><a href="#cb65-296" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Accessibilité spatiale (package <span class="co">[</span><span class="ot">access</span><span class="co">](https://pysal.org/access/)</span>)</span>
<span id="cb65-297"><a href="#cb65-297" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Optimisation spatiale (package <span class="co">[</span><span class="ot">spopt</span><span class="co">](https://pysal.org/spopt/)</span>)</span>
<span id="cb65-298"><a href="#cb65-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-299"><a href="#cb65-299" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-300"><a href="#cb65-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-301"><a href="#cb65-301" aria-hidden="true" tabindex="-1"></a>::: {.column width="20%"}</span>
<span id="cb65-302"><a href="#cb65-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-303"><a href="#cb65-303" aria-hidden="true" tabindex="-1"></a><span class="al">![](./fig/logo-pysal.png)</span></span>
<span id="cb65-304"><a href="#cb65-304" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-305"><a href="#cb65-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-306"><a href="#cb65-306" aria-hidden="true" tabindex="-1"></a>::::</span>
<span id="cb65-307"><a href="#cb65-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-308"><a href="#cb65-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-309"><a href="#cb65-309" aria-hidden="true" tabindex="-1"></a><span class="fu">## Autres packages utiles ...</span></span>
<span id="cb65-310"><a href="#cb65-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-311"><a href="#cb65-311" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Binding Python pour <span class="co">[</span><span class="ot">GRASS</span><span class="co">](https://grass.osgeo.org/grass82/manuals/libpython/index.html)</span> + Intégration dans les notebooks Jupyter</span>
<span id="cb65-312"><a href="#cb65-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-313"><a href="#cb65-313" aria-hidden="true" tabindex="-1"></a><span class="al">![Source: &lt;https://grass.osgeo.org/news/2022_06_05_results_student_grant_caitlin/&gt;](./fig/grass_jupyter_combo_vis.png)</span></span>
<span id="cb65-314"><a href="#cb65-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-315"><a href="#cb65-315" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Iris</span><span class="co">](https://scitools-iris.readthedocs.io/en/stable/)</span></span>
<span id="cb65-316"><a href="#cb65-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-317"><a href="#cb65-317" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Pour la cartographie : <span class="co">[</span><span class="ot">cartopy</span><span class="co">](https://scitools.org.uk/cartopy/docs/latest/)</span> ; <span class="co">[</span><span class="ot">geoviews</span><span class="co">](https://geoviews.org/)</span> et <span class="co">[</span><span class="ot">geoplot</span><span class="co">](https://residentmario.github.io/geoplot/)</span> basés sur *cartopy* ; <span class="co">[</span><span class="ot">PyGMT</span><span class="co">](https://www.pygmt.org/latest/)</span> (selon les usages - pas de solution aussi aboutie que <span class="in">`mapsf`</span> pour les cartes réalisées en SHS).</span>
<span id="cb65-318"><a href="#cb65-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-319"><a href="#cb65-319" aria-hidden="true" tabindex="-1"></a><span class="al">![](./fig/cartopy.png)</span></span>
<span id="cb65-320"><a href="#cb65-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-321"><a href="#cb65-321" aria-hidden="true" tabindex="-1"></a><span class="fu">## Ressources Python Géospatial</span></span>
<span id="cb65-322"><a href="#cb65-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-323"><a href="#cb65-323" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">https://py.geocompx.org/</span><span class="co">](https://py.geocompx.org/)</span></span>
<span id="cb65-324"><a href="#cb65-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-325"><a href="#cb65-325" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">https://automating-gis-processes.github.io</span><span class="co">](https://automating-gis-processes.github.io)</span></span>
<span id="cb65-326"><a href="#cb65-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-327"><a href="#cb65-327" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">https://www.earthdatascience.org/courses/use-data-open-source-python/</span><span class="co">](https://www.earthdatascience.org/courses/use-data-open-source-python/)</span></span>
<span id="cb65-328"><a href="#cb65-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-329"><a href="#cb65-329" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">https://geographicdata.science/book/intro.html</span><span class="co">](https://geographicdata.science/book/intro.html)</span></span>
<span id="cb65-330"><a href="#cb65-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-331"><a href="#cb65-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-332"><a href="#cb65-332" aria-hidden="true" tabindex="-1"></a><span class="fu">## Interaction R ⇄ Python dans Quarto</span></span>
<span id="cb65-333"><a href="#cb65-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-334"><a href="#cb65-334" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb65-335"><a href="#cb65-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-336"><a href="#cb65-336" aria-hidden="true" tabindex="-1"></a><span class="fu">### R → Python</span></span>
<span id="cb65-337"><a href="#cb65-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-338"><a href="#cb65-338" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Définition de variables dans un chunk R :</span>
<span id="cb65-339"><a href="#cb65-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-340"><a href="#cb65-340" aria-hidden="true" tabindex="-1"></a><span class="in">```{r example-r-1}</span></span>
<span id="cb65-341"><a href="#cb65-341" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">42</span></span>
<span id="cb65-342"><a href="#cb65-342" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb65-343"><a href="#cb65-343" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">13</span>, <span class="dv">14</span>)</span>
<span id="cb65-344"><a href="#cb65-344" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-345"><a href="#cb65-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-346"><a href="#cb65-346" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Récupération depuis un chunk Python :</span>
<span id="cb65-347"><a href="#cb65-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-348"><a href="#cb65-348" aria-hidden="true" tabindex="-1"></a>*en utilisant la variable `r`, un point, et le nom de la variable R à récupérer*</span>
<span id="cb65-349"><a href="#cb65-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-350"><a href="#cb65-350" aria-hidden="true" tabindex="-1"></a><span class="in">```{python example-python-1}</span></span>
<span id="cb65-351"><a href="#cb65-351" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(r.a)</span>
<span id="cb65-352"><a href="#cb65-352" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(r.b)</span>
<span id="cb65-353"><a href="#cb65-353" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(r.c)</span>
<span id="cb65-354"><a href="#cb65-354" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-355"><a href="#cb65-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-356"><a href="#cb65-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-357"><a href="#cb65-357" aria-hidden="true" tabindex="-1"></a><span class="fu">### Python → R</span></span>
<span id="cb65-358"><a href="#cb65-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-359"><a href="#cb65-359" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Définition de variables dans un chunk Python :</span>
<span id="cb65-360"><a href="#cb65-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-361"><a href="#cb65-361" aria-hidden="true" tabindex="-1"></a><span class="in">```{python example-python-2}</span></span>
<span id="cb65-362"><a href="#cb65-362" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> <span class="dv">42</span></span>
<span id="cb65-363"><a href="#cb65-363" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>]</span>
<span id="cb65-364"><a href="#cb65-364" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-365"><a href="#cb65-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-366"><a href="#cb65-366" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Récupération depuis un chunk R :</span>
<span id="cb65-367"><a href="#cb65-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-368"><a href="#cb65-368" aria-hidden="true" tabindex="-1"></a>*en utilisant la variable `py`, un dollar `$`, et le nom de la variable Python à récupérer*</span>
<span id="cb65-369"><a href="#cb65-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-370"><a href="#cb65-370" aria-hidden="true" tabindex="-1"></a><span class="in">```{r example-r-2}</span></span>
<span id="cb65-371"><a href="#cb65-371" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(py<span class="sc">$</span>a)</span>
<span id="cb65-372"><a href="#cb65-372" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(py<span class="sc">$</span>b)</span>
<span id="cb65-373"><a href="#cb65-373" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-374"><a href="#cb65-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-375"><a href="#cb65-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-376"><a href="#cb65-376" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-377"><a href="#cb65-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-378"><a href="#cb65-378" aria-hidden="true" tabindex="-1"></a><span class="fu">## Interaction R ⇄ Python dans Quarto (suite)</span></span>
<span id="cb65-379"><a href="#cb65-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-380"><a href="#cb65-380" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Il est possible d'échanger des types plus complexes (<span class="in">`data.frame`</span> ⇄ <span class="in">`DataFrame`</span> pandas, tableau numpy, etc.)</span>
<span id="cb65-381"><a href="#cb65-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-382"><a href="#cb65-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-383"><a href="#cb65-383" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb65-384"><a href="#cb65-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-385"><a href="#cb65-385" aria-hidden="true" tabindex="-1"></a><span class="fu">### R → Python</span></span>
<span id="cb65-386"><a href="#cb65-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-387"><a href="#cb65-387" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Depuis un chunk R :</span>
<span id="cb65-388"><a href="#cb65-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-389"><a href="#cb65-389" aria-hidden="true" tabindex="-1"></a><span class="in">```{r example-r-3}</span></span>
<span id="cb65-390"><a href="#cb65-390" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb65-391"><a href="#cb65-391" aria-hidden="true" tabindex="-1"></a>   <span class="at">emp_id =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>),</span>
<span id="cb65-392"><a href="#cb65-392" aria-hidden="true" tabindex="-1"></a>   <span class="at">emp_name =</span> <span class="fu">c</span>(<span class="st">"Rick"</span>,<span class="st">"Dan"</span>,<span class="st">"Michelle"</span>,<span class="st">"Ryan"</span>,<span class="st">"Jane"</span>),</span>
<span id="cb65-393"><a href="#cb65-393" aria-hidden="true" tabindex="-1"></a>   <span class="at">salary =</span> <span class="fu">c</span>(<span class="fl">623.3</span>,<span class="fl">515.2</span>,<span class="fl">611.0</span>,<span class="fl">729.0</span>,<span class="fl">843.25</span>),</span>
<span id="cb65-394"><a href="#cb65-394" aria-hidden="true" tabindex="-1"></a>   <span class="at">start_date =</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="st">"2012-01-01"</span>, <span class="st">"2013-09-23"</span>, <span class="st">"2014-11-15"</span>, <span class="st">"2014-05-11"</span>, <span class="st">"2015-03-27"</span>)),</span>
<span id="cb65-395"><a href="#cb65-395" aria-hidden="true" tabindex="-1"></a>   <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb65-396"><a href="#cb65-396" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb65-397"><a href="#cb65-397" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-398"><a href="#cb65-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-399"><a href="#cb65-399" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Récupération depuis un chunk Python :</span>
<span id="cb65-400"><a href="#cb65-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-401"><a href="#cb65-401" aria-hidden="true" tabindex="-1"></a><span class="in">```{python example-python-3}</span></span>
<span id="cb65-402"><a href="#cb65-402" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> r.df</span>
<span id="cb65-403"><a href="#cb65-403" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.head())</span>
<span id="cb65-404"><a href="#cb65-404" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-405"><a href="#cb65-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-406"><a href="#cb65-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-407"><a href="#cb65-407" aria-hidden="true" tabindex="-1"></a><span class="fu">### Python → R</span></span>
<span id="cb65-408"><a href="#cb65-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-409"><a href="#cb65-409" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Depuis un chunk Python :</span>
<span id="cb65-410"><a href="#cb65-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-411"><a href="#cb65-411" aria-hidden="true" tabindex="-1"></a><span class="in">```{python example-python-4}</span></span>
<span id="cb65-412"><a href="#cb65-412" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb65-413"><a href="#cb65-413" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb65-414"><a href="#cb65-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-415"><a href="#cb65-415" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> pd.DataFrame({</span>
<span id="cb65-416"><a href="#cb65-416" aria-hidden="true" tabindex="-1"></a>  <span class="st">"emp_id"</span>: <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">5</span>)),</span>
<span id="cb65-417"><a href="#cb65-417" aria-hidden="true" tabindex="-1"></a>  <span class="st">"emp_name"</span>: [<span class="st">"Rick"</span>, <span class="st">"Dan"</span>, <span class="st">"Michelle"</span>, <span class="st">"Ryan"</span>, <span class="st">"Jane"</span>],</span>
<span id="cb65-418"><a href="#cb65-418" aria-hidden="true" tabindex="-1"></a>  <span class="st">"salary"</span>: [<span class="fl">623.3</span>, <span class="fl">515.2</span>, <span class="fl">611.0</span>, <span class="fl">729.0</span>, <span class="fl">843.25</span>],</span>
<span id="cb65-419"><a href="#cb65-419" aria-hidden="true" tabindex="-1"></a>  <span class="st">"start_date"</span>: pd.to_datetime([<span class="st">"2012-01-01"</span>, <span class="st">"2013-09-23"</span>, <span class="st">"2014-11-15"</span>, <span class="st">"2014-05-11"</span>, <span class="st">"2015-03-27"</span>]),</span>
<span id="cb65-420"><a href="#cb65-420" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb65-421"><a href="#cb65-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-422"><a href="#cb65-422" aria-hidden="true" tabindex="-1"></a>arr <span class="op">=</span> np.array([[<span class="dv">12</span>, <span class="dv">47</span>], [<span class="dv">34</span>, <span class="dv">90</span>], [<span class="dv">23</span>, <span class="dv">19</span>]])</span>
<span id="cb65-423"><a href="#cb65-423" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-424"><a href="#cb65-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-425"><a href="#cb65-425" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Utilisation depuis un chunk R :</span>
<span id="cb65-426"><a href="#cb65-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-427"><a href="#cb65-427" aria-hidden="true" tabindex="-1"></a><span class="in">```{r example-r-4}</span></span>
<span id="cb65-428"><a href="#cb65-428" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(py<span class="sc">$</span>df2)</span>
<span id="cb65-429"><a href="#cb65-429" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(py<span class="sc">$</span>arr)</span>
<span id="cb65-430"><a href="#cb65-430" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-431"><a href="#cb65-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-432"><a href="#cb65-432" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb65-433"><a href="#cb65-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-434"><a href="#cb65-434" aria-hidden="true" tabindex="-1"></a><span class="fu">## Interaction R ⇄ Python dans Quarto (suite)</span></span>
<span id="cb65-435"><a href="#cb65-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-436"><a href="#cb65-436" aria-hidden="true" tabindex="-1"></a>Et pour les objets spatiaux ? (*sf* / *geopandas*)</span>
<span id="cb65-437"><a href="#cb65-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-438"><a href="#cb65-438" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Si la conversion <span class="in">`data.frame`</span> ⇄ <span class="in">`DataFrame`</span> est transparente, il n'en est pas de même pour les dataframe avec une composante spatiale (perte de la dimension spatiale / colonne <span class="in">`geometry`</span> contient désormais ...)</span>
<span id="cb65-439"><a href="#cb65-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-440"><a href="#cb65-440" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>L'écriture d'une petite function permet de résoudre ça :</span>
<span id="cb65-441"><a href="#cb65-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-442"><a href="#cb65-442" aria-hidden="true" tabindex="-1"></a><span class="in">```{r import}</span></span>
<span id="cb65-443"><a href="#cb65-443" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb65-444"><a href="#cb65-444" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb65-445"><a href="#cb65-445" aria-hidden="true" tabindex="-1"></a><span class="co"># Import des données</span></span>
<span id="cb65-446"><a href="#cb65-446" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb65-447"><a href="#cb65-447" aria-hidden="true" tabindex="-1"></a>mun_raw <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"geom/munic.geojson"</span>, <span class="at">quiet=</span> <span class="cn">TRUE</span>)</span>
<span id="cb65-448"><a href="#cb65-448" aria-hidden="true" tabindex="-1"></a>mrc_raw <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"geom/mrc.geojson"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb65-449"><a href="#cb65-449" aria-hidden="true" tabindex="-1"></a><span class="co"># Projection NAD83 / Quebec Albers</span></span>
<span id="cb65-450"><a href="#cb65-450" aria-hidden="true" tabindex="-1"></a>crs <span class="ot">&lt;-</span> <span class="st">"EPSG:6623"</span></span>
<span id="cb65-451"><a href="#cb65-451" aria-hidden="true" tabindex="-1"></a>mun <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(mun_raw, crs)</span>
<span id="cb65-452"><a href="#cb65-452" aria-hidden="true" tabindex="-1"></a>mrc <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(mrc_raw, crs)</span>
<span id="cb65-453"><a href="#cb65-453" aria-hidden="true" tabindex="-1"></a><span class="co"># Création d'une couche des régions</span></span>
<span id="cb65-454"><a href="#cb65-454" aria-hidden="true" tabindex="-1"></a>reg <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(<span class="at">x =</span> mrc[,<span class="st">'MUS_NM_REG'</span>], </span>
<span id="cb65-455"><a href="#cb65-455" aria-hidden="true" tabindex="-1"></a>                 <span class="at">by =</span> <span class="fu">list</span>(<span class="at">REG =</span> mrc<span class="sc">$</span>MUS_NM_REG), </span>
<span id="cb65-456"><a href="#cb65-456" aria-hidden="true" tabindex="-1"></a>                 <span class="at">FUN =</span> head, <span class="dv">1</span>)</span>
<span id="cb65-457"><a href="#cb65-457" aria-hidden="true" tabindex="-1"></a>resto_raw <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">'geom/resto.geojson'</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb65-458"><a href="#cb65-458" aria-hidden="true" tabindex="-1"></a>resto <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(resto_raw, crs)</span>
<span id="cb65-459"><a href="#cb65-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-460"><a href="#cb65-460" aria-hidden="true" tabindex="-1"></a>sel <span class="ot">&lt;-</span> <span class="st">"Québec"</span></span>
<span id="cb65-461"><a href="#cb65-461" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-462"><a href="#cb65-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-465"><a href="#cb65-465" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb65-466"><a href="#cb65-466" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.geometry <span class="im">import</span> shape</span>
<span id="cb65-467"><a href="#cb65-467" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb65-468"><a href="#cb65-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-469"><a href="#cb65-469" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> restore_geodataframe(df, crs, geom_type):</span>
<span id="cb65-470"><a href="#cb65-470" aria-hidden="true" tabindex="-1"></a>  geom <span class="op">=</span> df.geometry.<span class="bu">apply</span>(<span class="kw">lambda</span> coords: shape({ <span class="st">"type"</span>: geom_type, <span class="st">"coordinates"</span>: coords }))</span>
<span id="cb65-471"><a href="#cb65-471" aria-hidden="true" tabindex="-1"></a>  gdf <span class="op">=</span> gpd.GeoDataFrame(df.drop([<span class="st">'geometry'</span>], axis<span class="op">=</span><span class="dv">1</span>), geometry<span class="op">=</span>geom)</span>
<span id="cb65-472"><a href="#cb65-472" aria-hidden="true" tabindex="-1"></a>  gdf.set_crs(crs, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb65-473"><a href="#cb65-473" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> gdf</span>
<span id="cb65-474"><a href="#cb65-474" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-475"><a href="#cb65-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-476"><a href="#cb65-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-477"><a href="#cb65-477" aria-hidden="true" tabindex="-1"></a>Ainsi, les objets <span class="in">`sf`</span> pourront être convertis en <span class="in">`GeoDataFrame`</span> ainsi :</span>
<span id="cb65-478"><a href="#cb65-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-481"><a href="#cb65-481" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb65-482"><a href="#cb65-482" aria-hidden="true" tabindex="-1"></a>mrc <span class="op">=</span> restore_geodataframe(r.mrc, r.crs, <span class="st">"MultiPolygon"</span>)</span>
<span id="cb65-483"><a href="#cb65-483" aria-hidden="true" tabindex="-1"></a>mrc.head()</span>
<span id="cb65-484"><a href="#cb65-484" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-485"><a href="#cb65-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-488"><a href="#cb65-488" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb65-489"><a href="#cb65-489" aria-hidden="true" tabindex="-1"></a>resto <span class="op">=</span> restore_geodataframe(r.resto, r.crs, <span class="st">"Point"</span>)</span>
<span id="cb65-490"><a href="#cb65-490" aria-hidden="true" tabindex="-1"></a>resto.head()</span>
<span id="cb65-491"><a href="#cb65-491" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-492"><a href="#cb65-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-493"><a href="#cb65-493" aria-hidden="true" tabindex="-1"></a><span class="fu">## Python, Quarto et interactivité</span></span>
<span id="cb65-494"><a href="#cb65-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-495"><a href="#cb65-495" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Utilisation des widgets Jupyter possible (seulement is utilisation de l'engin de rendu <span class="in">`jupyter`</span>, pas avec <span class="in">`knitr`</span> - i.e. l'inverse des *htmlwidgets* en R qui ne fonctionne que si <span class="in">`knitr`</span> est utilisé)</span>
<span id="cb65-496"><a href="#cb65-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-497"><a href="#cb65-497" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Exemple :</span>
<span id="cb65-498"><a href="#cb65-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-499"><a href="#cb65-499" aria-hidden="true" tabindex="-1"></a><span class="al">![](./fig/example-quarto-jupyter-widgets.jpg)</span></span>
<span id="cb65-500"><a href="#cb65-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-501"><a href="#cb65-501" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Documentation : <span class="co">[</span><span class="ot">https://quarto.org/docs/interactive/widgets/jupyter.html</span><span class="co">](https://quarto.org/docs/interactive/widgets/jupyter.html)</span></span>
<span id="cb65-502"><a href="#cb65-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-503"><a href="#cb65-503" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exemples d'analyse sur les données du Québec</span></span>
<span id="cb65-504"><a href="#cb65-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-505"><a href="#cb65-505" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Les imports nécessaires :</span>
<span id="cb65-506"><a href="#cb65-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-507"><a href="#cb65-507" aria-hidden="true" tabindex="-1"></a><span class="in">```{python demo-import}</span></span>
<span id="cb65-508"><a href="#cb65-508" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb65-509"><a href="#cb65-509" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterio <span class="im">as</span> rio</span>
<span id="cb65-510"><a href="#cb65-510" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb65-511"><a href="#cb65-511" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb65-512"><a href="#cb65-512" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rioxarray</span>
<span id="cb65-513"><a href="#cb65-513" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xarray</span>
<span id="cb65-514"><a href="#cb65-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-515"><a href="#cb65-515" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.warp <span class="im">import</span> calculate_default_transform, reproject, Resampling</span>
<span id="cb65-516"><a href="#cb65-516" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot <span class="im">as</span> plt</span>
<span id="cb65-517"><a href="#cb65-517" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.plot <span class="im">import</span> show</span>
<span id="cb65-518"><a href="#cb65-518" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.mask <span class="im">import</span> mask</span>
<span id="cb65-519"><a href="#cb65-519" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterstats <span class="im">import</span> zonal_stats, point_query</span>
<span id="cb65-520"><a href="#cb65-520" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-521"><a href="#cb65-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-522"><a href="#cb65-522" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>On récupère les jeux de données et quelques autres infos (SRC, etc.) depuis l'environnement R :</span>
<span id="cb65-523"><a href="#cb65-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-524"><a href="#cb65-524" aria-hidden="true" tabindex="-1"></a><span class="in">```{python demo-vector-dataset-opening}</span></span>
<span id="cb65-525"><a href="#cb65-525" aria-hidden="true" tabindex="-1"></a><span class="co"># Le SCR des données</span></span>
<span id="cb65-526"><a href="#cb65-526" aria-hidden="true" tabindex="-1"></a>dst_crs <span class="op">=</span> r.crs</span>
<span id="cb65-527"><a href="#cb65-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-528"><a href="#cb65-528" aria-hidden="true" tabindex="-1"></a><span class="co"># On récupère le jeu de données "mrc" et le jeu de données "resto"</span></span>
<span id="cb65-529"><a href="#cb65-529" aria-hidden="true" tabindex="-1"></a>mrc <span class="op">=</span> restore_geodataframe(r.mrc, dst_crs, <span class="st">"MultiPolygon"</span>)</span>
<span id="cb65-530"><a href="#cb65-530" aria-hidden="true" tabindex="-1"></a>resto <span class="op">=</span> restore_geodataframe(r.resto, dst_crs, <span class="st">"Point"</span>)</span>
<span id="cb65-531"><a href="#cb65-531" aria-hidden="true" tabindex="-1"></a>reg <span class="op">=</span> mrc.dissolve(by<span class="op">=</span><span class="st">"MUS_NM_REG"</span>)</span>
<span id="cb65-532"><a href="#cb65-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-533"><a href="#cb65-533" aria-hidden="true" tabindex="-1"></a>sel <span class="op">=</span> r.sel <span class="co"># Québec</span></span>
<span id="cb65-534"><a href="#cb65-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-535"><a href="#cb65-535" aria-hidden="true" tabindex="-1"></a><span class="co"># Chemin du jeu de données raster</span></span>
<span id="cb65-536"><a href="#cb65-536" aria-hidden="true" tabindex="-1"></a><span class="co"># et du fichier contenant les descriptions des catégories</span></span>
<span id="cb65-537"><a href="#cb65-537" aria-hidden="true" tabindex="-1"></a>lc_fp <span class="op">=</span> <span class="st">'../../Téléchargements/T01_PROVINCE.tif'</span></span>
<span id="cb65-538"><a href="#cb65-538" aria-hidden="true" tabindex="-1"></a>lc_categories_fp <span class="op">=</span> <span class="st">'../../Téléchargements/correspondance_raster_CL_COUV.dbf'</span></span>
<span id="cb65-539"><a href="#cb65-539" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-540"><a href="#cb65-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-541"><a href="#cb65-541" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>On extrait les entités correspondantes et on les affiche, relativement au reste de la province :</span>
<span id="cb65-542"><a href="#cb65-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-543"><a href="#cb65-543" aria-hidden="true" tabindex="-1"></a><span class="in">```{python demo-first-plot}</span></span>
<span id="cb65-544"><a href="#cb65-544" aria-hidden="true" tabindex="-1"></a>extract <span class="op">=</span> mrc[mrc.MUS_NM_MRC <span class="op">==</span> sel]</span>
<span id="cb65-545"><a href="#cb65-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-546"><a href="#cb65-546" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> mrc.plot(color<span class="op">=</span><span class="st">"lightblue"</span>, edgecolor<span class="op">=</span><span class="st">"grey"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">12</span>))</span>
<span id="cb65-547"><a href="#cb65-547" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> reg.plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="va">None</span>, edgecolor<span class="op">=</span><span class="st">"orange"</span>, alpha<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb65-548"><a href="#cb65-548" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> extract.plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">"red"</span>)</span>
<span id="cb65-549"><a href="#cb65-549" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb65-550"><a href="#cb65-550" aria-hidden="true" tabindex="-1"></a>ax</span>
<span id="cb65-551"><a href="#cb65-551" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-552"><a href="#cb65-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-553"><a href="#cb65-553" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Ouverture et reprojection d'un jeu de données raster (avec *rioxarray*) :</span>
<span id="cb65-554"><a href="#cb65-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-555"><a href="#cb65-555" aria-hidden="true" tabindex="-1"></a><span class="in">```{python demo-open-raster}</span></span>
<span id="cb65-556"><a href="#cb65-556" aria-hidden="true" tabindex="-1"></a>xds <span class="op">=</span> rioxarray.open_rasterio(lc_fp)</span>
<span id="cb65-557"><a href="#cb65-557" aria-hidden="true" tabindex="-1"></a>xds <span class="op">=</span> xds.rio.reproject(dst_crs)</span>
<span id="cb65-558"><a href="#cb65-558" aria-hidden="true" tabindex="-1"></a>xds</span>
<span id="cb65-559"><a href="#cb65-559" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-560"><a href="#cb65-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-561"><a href="#cb65-561" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Affichons le raster reprojeté et l'emprise de la ville de Québec :</span>
<span id="cb65-562"><a href="#cb65-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-563"><a href="#cb65-563" aria-hidden="true" tabindex="-1"></a><span class="in">```{python demo-plot-raster}</span></span>
<span id="cb65-564"><a href="#cb65-564" aria-hidden="true" tabindex="-1"></a><span class="co"># Remplacer les '255' par '0'</span></span>
<span id="cb65-565"><a href="#cb65-565" aria-hidden="true" tabindex="-1"></a>xds.data[xds.data <span class="op">==</span> <span class="dv">255</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb65-566"><a href="#cb65-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-567"><a href="#cb65-567" aria-hidden="true" tabindex="-1"></a><span class="co"># Étendue des données</span></span>
<span id="cb65-568"><a href="#cb65-568" aria-hidden="true" tabindex="-1"></a>bounds <span class="op">=</span> xds.rio.bounds()</span>
<span id="cb65-569"><a href="#cb65-569" aria-hidden="true" tabindex="-1"></a>extent <span class="op">=</span> [bounds[<span class="dv">0</span>], bounds[<span class="dv">2</span>], bounds[<span class="dv">1</span>], bounds[<span class="dv">3</span>]]</span>
<span id="cb65-570"><a href="#cb65-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-571"><a href="#cb65-571" aria-hidden="true" tabindex="-1"></a><span class="co"># Création d'une figure vide</span></span>
<span id="cb65-572"><a href="#cb65-572" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">12</span>))</span>
<span id="cb65-573"><a href="#cb65-573" aria-hidden="true" tabindex="-1"></a><span class="co"># Affichage du raster (attribut 'data' de l'objet xds)</span></span>
<span id="cb65-574"><a href="#cb65-574" aria-hidden="true" tabindex="-1"></a>show(xds.data[<span class="dv">0</span>], ax<span class="op">=</span>ax, extent<span class="op">=</span>extent, cmap<span class="op">=</span><span class="st">"Set3"</span>)</span>
<span id="cb65-575"><a href="#cb65-575" aria-hidden="true" tabindex="-1"></a><span class="co"># Affichage de la ville de Québec en rouge par dessus</span></span>
<span id="cb65-576"><a href="#cb65-576" aria-hidden="true" tabindex="-1"></a>extract.plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">'red'</span>, edgecolor<span class="op">=</span><span class="st">'red'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb65-577"><a href="#cb65-577" aria-hidden="true" tabindex="-1"></a><span class="co"># On enlève l'affichage des axes</span></span>
<span id="cb65-578"><a href="#cb65-578" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb65-579"><a href="#cb65-579" aria-hidden="true" tabindex="-1"></a>ax</span>
<span id="cb65-580"><a href="#cb65-580" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-581"><a href="#cb65-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-582"><a href="#cb65-582" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Ouverture du fichier DBF qui contient les correspondances entre les codes et les noms des catégories d'utilisation des sols</span>
<span id="cb65-583"><a href="#cb65-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-584"><a href="#cb65-584" aria-hidden="true" tabindex="-1"></a><span class="in">```{python demo-open-dbf}</span></span>
<span id="cb65-585"><a href="#cb65-585" aria-hidden="true" tabindex="-1"></a>categories <span class="op">=</span> pd.DataFrame(</span>
<span id="cb65-586"><a href="#cb65-586" aria-hidden="true" tabindex="-1"></a>  gpd.read_file(lc_categories_fp, encoding<span class="op">=</span><span class="st">'utf-8'</span>)[[<span class="st">'ID'</span>, <span class="st">'CL_COUV'</span>, <span class="st">'Descriptio'</span>]])</span>
<span id="cb65-587"><a href="#cb65-587" aria-hidden="true" tabindex="-1"></a>categories.head(<span class="dv">11</span>)</span>
<span id="cb65-588"><a href="#cb65-588" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-589"><a href="#cb65-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-590"><a href="#cb65-590" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb65-591"><a href="#cb65-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-594"><a href="#cb65-594" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb65-595"><a href="#cb65-595" aria-hidden="true" tabindex="-1"></a><span class="co"># On va convertir cette DataFrame en un dictionnaire pour l'utiliser</span></span>
<span id="cb65-596"><a href="#cb65-596" aria-hidden="true" tabindex="-1"></a><span class="co"># comme un mapping ID -&gt; Description</span></span>
<span id="cb65-597"><a href="#cb65-597" aria-hidden="true" tabindex="-1"></a>categories <span class="op">=</span> {</span>
<span id="cb65-598"><a href="#cb65-598" aria-hidden="true" tabindex="-1"></a>  <span class="bu">int</span>(k): v[<span class="st">'Descriptio'</span>]</span>
<span id="cb65-599"><a href="#cb65-599" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> k,v <span class="kw">in</span> categories[[<span class="st">'ID'</span>, <span class="st">'Descriptio'</span>]].set_index(<span class="st">'ID'</span>).to_dict(orient<span class="op">=</span><span class="st">'index'</span>).items()</span>
<span id="cb65-600"><a href="#cb65-600" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb65-601"><a href="#cb65-601" aria-hidden="true" tabindex="-1"></a><span class="co"># Bien qu'il y ait une catégorie 'Pas de données' (ID 10)</span></span>
<span id="cb65-602"><a href="#cb65-602" aria-hidden="true" tabindex="-1"></a><span class="co"># certaines cellules ne comportent pas de valeur (nodata, ici avec la valeur 0)</span></span>
<span id="cb65-603"><a href="#cb65-603" aria-hidden="true" tabindex="-1"></a>categories[<span class="dv">0</span>] <span class="op">=</span> <span class="st">'Pas de données'</span></span>
<span id="cb65-604"><a href="#cb65-604" aria-hidden="true" tabindex="-1"></a>categories</span>
<span id="cb65-605"><a href="#cb65-605" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-606"><a href="#cb65-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-607"><a href="#cb65-607" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Calculer les statistiques zonales (combien de cellules de chaque type dans la sélection) :</span>
<span id="cb65-608"><a href="#cb65-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-611"><a href="#cb65-611" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb65-612"><a href="#cb65-612" aria-hidden="true" tabindex="-1"></a>stats <span class="op">=</span> zonal_stats(extract, xds.data[<span class="dv">0</span>], affine<span class="op">=</span>xds.rio.transform(), categorical<span class="op">=</span><span class="va">True</span>, nodata<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb65-613"><a href="#cb65-613" aria-hidden="true" tabindex="-1"></a>stats</span>
<span id="cb65-614"><a href="#cb65-614" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-615"><a href="#cb65-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-616"><a href="#cb65-616" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Traçons un histogramme de ce résultat, en utilisant les noms appropriés des catégories d'utilisation des sols :</span>
<span id="cb65-617"><a href="#cb65-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-620"><a href="#cb65-620" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb65-621"><a href="#cb65-621" aria-hidden="true" tabindex="-1"></a><span class="co">#| output-location: slide </span></span>
<span id="cb65-622"><a href="#cb65-622" aria-hidden="true" tabindex="-1"></a><span class="co"># Utilise les noms de catégories du DataFrame `categories`...</span></span>
<span id="cb65-623"><a href="#cb65-623" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> [categories[<span class="bu">int</span>(v)] <span class="cf">for</span> v <span class="kw">in</span> stats[<span class="dv">0</span>].keys()]</span>
<span id="cb65-624"><a href="#cb65-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-625"><a href="#cb65-625" aria-hidden="true" tabindex="-1"></a><span class="co"># ...et les valeurs que nous venons de calculer avec la fonction `zonal_stats`</span></span>
<span id="cb65-626"><a href="#cb65-626" aria-hidden="true" tabindex="-1"></a>height <span class="op">=</span> stats[<span class="dv">0</span>].values()</span>
<span id="cb65-627"><a href="#cb65-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-628"><a href="#cb65-628" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">8</span>))</span>
<span id="cb65-629"><a href="#cb65-629" aria-hidden="true" tabindex="-1"></a>bar_container <span class="op">=</span> ax.bar(x, height)</span>
<span id="cb65-630"><a href="#cb65-630" aria-hidden="true" tabindex="-1"></a>ax.set_xticklabels(</span>
<span id="cb65-631"><a href="#cb65-631" aria-hidden="true" tabindex="-1"></a>    ax.get_xticklabels(),</span>
<span id="cb65-632"><a href="#cb65-632" aria-hidden="true" tabindex="-1"></a>    rotation<span class="op">=</span><span class="dv">45</span>,</span>
<span id="cb65-633"><a href="#cb65-633" aria-hidden="true" tabindex="-1"></a>    horizontalalignment<span class="op">=</span><span class="st">'right'</span></span>
<span id="cb65-634"><a href="#cb65-634" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb65-635"><a href="#cb65-635" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span>
<span id="cb65-636"><a href="#cb65-636" aria-hidden="true" tabindex="-1"></a>ax</span>
<span id="cb65-637"><a href="#cb65-637" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-638"><a href="#cb65-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-639"><a href="#cb65-639" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Dans quel type d'occupation du sol se trouvent les restaurants précédemment récupérés ?</span>
<span id="cb65-640"><a href="#cb65-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-643"><a href="#cb65-643" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb65-644"><a href="#cb65-644" aria-hidden="true" tabindex="-1"></a>geoms <span class="op">=</span> resto[<span class="st">'geometry'</span>].tolist()</span>
<span id="cb65-645"><a href="#cb65-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-646"><a href="#cb65-646" aria-hidden="true" tabindex="-1"></a>resto[<span class="st">"lc"</span>] <span class="op">=</span> [categories[<span class="bu">int</span>(x)] <span class="cf">for</span> x <span class="kw">in</span> point_query(vectors<span class="op">=</span>geoms, raster<span class="op">=</span>xds.data[<span class="dv">0</span>], nodata<span class="op">=</span><span class="dv">0</span>, affine<span class="op">=</span>xds.rio.transform())]</span>
<span id="cb65-647"><a href="#cb65-647" aria-hidden="true" tabindex="-1"></a>resto.head()</span>
<span id="cb65-648"><a href="#cb65-648" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-649"><a href="#cb65-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-650"><a href="#cb65-650" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Quels restaurants ne sont pas situés dans une zone artificialisée ?</span>
<span id="cb65-651"><a href="#cb65-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-654"><a href="#cb65-654" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb65-655"><a href="#cb65-655" aria-hidden="true" tabindex="-1"></a>selection <span class="op">=</span> resto[(resto.lc <span class="op">!=</span> <span class="st">'Surfaces artificielles'</span>) <span class="op">&amp;</span> (resto.lc <span class="op">!=</span> <span class="st">'Pas de données'</span>)]</span>
<span id="cb65-656"><a href="#cb65-656" aria-hidden="true" tabindex="-1"></a>selection</span>
<span id="cb65-657"><a href="#cb65-657" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb65-658"><a href="#cb65-658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-659"><a href="#cb65-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-662"><a href="#cb65-662" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb65-663"><a href="#cb65-663" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> extract.plot(color<span class="op">=</span><span class="va">None</span>, edgecolor<span class="op">=</span><span class="st">"black"</span>)</span>
<span id="cb65-664"><a href="#cb65-664" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> selection.plot(ax<span class="op">=</span>ax, marker<span class="op">=</span><span class="st">'x'</span>, color<span class="op">=</span><span class="st">'red'</span>, markersize<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb65-665"><a href="#cb65-665" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb65-666"><a href="#cb65-666" aria-hidden="true" tabindex="-1"></a>ax</span>
<span id="cb65-667"><a href="#cb65-667" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>